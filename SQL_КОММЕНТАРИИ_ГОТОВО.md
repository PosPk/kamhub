# ‚úÖ SQL –°–•–ï–ú–´ –° –ü–û–î–†–û–ë–ù–´–ú–ò –ö–û–ú–ú–ï–ù–¢–ê–†–ò–Ø–ú–ò

## üéØ –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

### 1. –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (`schema.sql`)
‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ç–∞–±–ª–∏—Ü–∞–º:
- **users** - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã (4 —Ä–æ–ª–∏: —Ç—É—Ä–∏—Å—Ç, –æ–ø–µ—Ä–∞—Ç–æ—Ä, –≥–∏–¥, –ø–æ—Å—Ç–∞–≤—â–∏–∫)
- **partners** - –ü–∞—Ä—Ç–Ω–µ—Ä—ã –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏ —É—Å–ª—É–≥ (8 –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- **tours** - –¢—É—Ä—ã –∏ —ç–∫—Å–∫—É—Ä—Å–∏–∏ –ø–æ –ö–∞–º—á–∞—Ç–∫–µ
- **assets** - –ú–µ–¥–∏–∞—Ñ–∞–π–ª—ã —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π –ø–æ SHA256
- **bookings** - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—É—Ä–æ–≤ —Å–æ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- **reviews** - –û—Ç–∑—ã–≤—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- **eco_points** - –≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
- **user_eco_points** - –°–∏—Å—Ç–µ–º–∞ –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–∏ —ç–∫–æ-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
- **chat_sessions** - AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
- **chat_messages** - –ò—Å—Ç–æ—Ä–∏—è –æ–±—â–µ–Ω–∏—è —Å AI
- **audit_logs** - –ñ—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### 2. –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤ (`transfer_schema.sql`)
‚úÖ –ü–æ–¥—Ä–æ–±–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ç–∞–±–ª–∏—Ü–∞–º:
- **transfer_routes** - –ú–∞—Ä—à—Ä—É—Ç—ã —Å PostGIS –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
- **transfer_vehicles** - –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–Ω—ã–µ —Å—Ä–µ–¥—Å—Ç–≤–∞ (5 –∫–ª–∞—Å—Å–æ–≤: economy ‚Üí bus)
- **transfer_drivers** - –í–æ–¥–∏—Ç–µ–ª–∏ —Å —Ä–µ–π—Ç–∏–Ω–≥–∞–º–∏ –∏ –º—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å—é
- **transfer_schedules** - –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —Ä–µ–π—Å–æ–≤ —Å —Ü–µ–Ω–∞–º–∏
- **transfer_bookings** - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ–º
- **transfer_stops** - –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
- **transfer_reviews** - –û—Ç–∑—ã–≤—ã –æ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞—Ö
- **transfer_notifications** - –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### 3. –°–∏—Å—Ç–µ–º–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (`operators_schema.sql`)
‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞:
- **operators** - –¢—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –∏ –≤–ª–∞–¥–µ–ª—å—Ü—ã —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏: tour (—Ç—É—Ä—ã), transfer (—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã), both (–æ–±–∞)
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è, —Ä–µ–π—Ç–∏–Ω–≥–∏, –ª–∏—Ü–µ–Ω–∑–∏–∏, –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ —Ä–µ–∫–≤–∏–∑–∏—Ç—ã

### 4. –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (`loyalty_schema.sql`)
‚úÖ –£–∂–µ –∏–º–µ–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:
- **loyalty_transactions** - –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–∞–ª–ª–æ–≤ (earn, redeem, expire, refund)
- **promo_codes** - –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ —Å–∫–∏–¥–∫–∏
- **promo_code_usage** - –ò—Å—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- **referrals** - –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
- **loyalty_levels** - –£—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ (–ù–æ–≤–∏—á–æ–∫ ‚Üí –ü–ª–∞—Ç–∏–Ω–∞)

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

| –§–∞–π–ª | –¢–∞–±–ª–∏—Ü | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ | –°—Ç–∞—Ç—É—Å |
|------|--------|--------------|--------|
| schema.sql | 19 | 150+ | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ |
| transfer_schema.sql | 8 | 60+ | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ |
| operators_schema.sql | 1 | 15+ | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ |
| loyalty_schema.sql | 5 | 20+ | ‚úÖ –£–∂–µ –±—ã–ª–æ |

**–í—Å–µ–≥–æ:** 33 —Ç–∞–±–ª–∏—Ü—ã, 245+ –ø–æ–¥—Ä–æ–±–Ω—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

## üé® –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤

–ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Ç–µ–ø–µ—Ä—å –∏–º–µ–µ—Ç:

1. **–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è:**
   ```sql
   -- ============================================
   -- –¢–ê–ë–õ–ò–¶–ê: –∏–º—è - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
   -- ============================================
   -- –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
   -- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–∞–±–æ—Ç—ã
   -- ============================================
   ```

2. **Inline –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –∫–∞–∂–¥–æ–º—É –ø–æ–ª—é:**
   ```sql
   field_name TYPE,  -- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—è
   ```

3. **COMMENT ON TABLE –∏ COLUMN:**
   ```sql
   COMMENT ON TABLE table_name IS '–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã';
   COMMENT ON COLUMN table.field IS '–î–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø–æ–ª—è';
   ```

## üîë –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏
- **PostgreSQL 14+** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏ `uuid-ossp` –∏ `postgis`
- **UUID** –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
- **JSONB** –¥–ª—è –≥–∏–±–∫–∏—Ö —Å—Ç—Ä—É–∫—Ç—É—Ä –¥–∞–Ω–Ω—ã—Ö
- **PostGIS POINT** –¥–ª—è –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
- **–¢—Ä–∏–≥–≥–µ—Ä—ã** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Å—á–µ—Ç —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ (—Ç—Ä–∏–≥–≥–µ—Ä—ã)
- –ì–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏—è —ç–∫–æ-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–µ–π
- –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
- –°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏ —Å —É—Ä–æ–≤–Ω—è–º–∏
- AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- –ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
- –•—Ä–∞–Ω–µ–Ω–∏–µ IP –∞–¥—Ä–µ—Å–æ–≤ –∏ User-Agent
- –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
- –ú–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–∑—ã–≤–æ–≤

## üöÄ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

–í—Å–µ —Å—Ö–µ–º—ã –≥–æ—Ç–æ–≤—ã –∫:
1. ‚úÖ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –Ω–∞ production
2. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Prisma/TypeORM
3. ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å Next.js API routes
4. ‚úÖ –†–∞–±–æ—Ç–µ —Å PostGIS –¥–ª—è –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
5. ‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é –∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

## üìù –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤:
```sql
SELECT * FROM transfer_full_info 
WHERE from_location = '–ê—ç—Ä–æ–ø–æ—Ä—Ç –ï–ª–∏–∑–æ–≤–æ'
  AND available_seats >= 2
ORDER BY departure_time;
```

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –æ–ø–µ—Ä–∞—Ç–æ—Ä—É:
```sql
SELECT * FROM operator_transfer_stats 
WHERE operator_id = '550e8400-e29b-41d4-a716-446655440000';
```

### –ë–∞–ª–∞–Ω—Å –±–∞–ª–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
```sql
SELECT * FROM user_loyalty_stats 
WHERE user_id = 'user-uuid';
```

## üéâ –ò—Ç–æ–≥

SQL —Å—Ö–µ–º—ã Kamchatour Hub —Ç–µ–ø–µ—Ä—å –∏–º–µ—é—Ç **–ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –Ω–∞ —É—Ä–æ–≤–Ω–µ enterprise-–ø—Ä–æ–µ–∫—Ç–æ–≤!

–ö–∞–∂–¥—ã–π —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –∏ DBA –º–æ–∂–µ—Ç –ª–µ–≥–∫–æ –ø–æ–Ω—è—Ç—å:
- üéØ –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã
- üìä –°—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
- üîó –°–≤—è–∑–∏ –º–µ–∂–¥—É —Ç–∞–±–ª–∏—Ü–∞–º–∏
- ‚öôÔ∏è –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
- üîç –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã

---

**–î–∞—Ç–∞:** 2025-11-05  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** üü¢ Production Ready
