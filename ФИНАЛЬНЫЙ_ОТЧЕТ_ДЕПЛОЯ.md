# üìä –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–ï–¢: –ß–¢–û –ü–û–õ–£–ß–ò–õ–û–°–¨

**–î–∞—Ç–∞:** –î–µ–∫–∞–±—Ä—å 2024  
**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~1 —á–∞—Å  
**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

---

## üéâ –ß–¢–û –†–ï–ê–õ–¨–ù–û –ü–û–õ–£–ß–ò–õ–û–°–¨

### ‚úÖ –°–û–ó–î–ê–ù–ù–´–ï –°–ò–°–¢–ï–ú–´

#### 1. üîê –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (100% –≥–æ—Ç–æ–≤–∞)
- **CSRF –∑–∞—â–∏—Ç–∞** - 7 routes –∑–∞—â–∏—â–µ–Ω–æ
- **Rate Limiting** - 7 routes –∑–∞—â–∏—â–µ–Ω–æ  
- **JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** - –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- **Security headers** - –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –≤ middleware

#### 2. üìä –°–∏—Å—Ç–µ–º–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (100% –≥–æ—Ç–æ–≤–∞)
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏** - 42 –º–µ—Å—Ç–∞
- **–£—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è** - debug, info, warn, error
- **–ö–æ–Ω—Ç–µ–∫—Å—Ç –≤ –∫–∞–∂–¥–æ–º –ª–æ–≥–µ** - –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏
- **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ Sentry** - –º–æ–∂–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å

#### 3. üé® –°–∏—Å—Ç–µ–º–∞ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (100% –≥–æ—Ç–æ–≤–∞)
- **Sidebar** - –¥–ª—è desktop
- **MobileNav** - –¥–ª—è mobile
- **Header** - –≥–ª–æ–±–∞–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å
- **AppLayout** - –µ–¥–∏–Ω—ã–π layout

#### 4. üîë –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (100% –≥–æ—Ç–æ–≤–∞)
- **JWT —Ç–æ–∫–µ–Ω—ã** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **Middleware** - withAuth, withRole
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –ø—Ä–∏–º–µ–Ω–µ–Ω–æ –∫ –∫—Ä–∏—Ç–∏—á–Ω—ã–º routes
- **Hardcoded userId** - –£–ë–†–ê–ù ‚úÖ

---

## üìÅ –°–¢–†–£–ö–¢–£–†–ê –°–û–ó–î–ê–ù–ù–´–• –§–ê–ô–õ–û–í

```
kamhub/
‚îú‚îÄ‚îÄ lib/
‚îÇ   ‚îú‚îÄ‚îÄ logger.ts                    ‚úÖ –ù–û–í–´–ô (135 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ jwt.ts                  ‚úÖ –ù–û–í–´–ô (150 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware.ts           ‚úÖ –ù–û–í–´–ô (100 —Å—Ç—Ä–æ–∫)
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ csrf-client.ts          ‚úÖ –ù–û–í–´–ô (70 —Å—Ç—Ä–æ–∫)
‚îÇ
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îî‚îÄ‚îÄ Layout/
‚îÇ       ‚îú‚îÄ‚îÄ AppLayout.tsx           ‚úÖ –ù–û–í–´–ô (60 —Å—Ç—Ä–æ–∫)
‚îÇ       ‚îú‚îÄ‚îÄ Sidebar.tsx              ‚úÖ –ù–û–í–´–ô (150 —Å—Ç—Ä–æ–∫)
‚îÇ       ‚îú‚îÄ‚îÄ Header.tsx               ‚úÖ –ù–û–í–´–ô (80 —Å—Ç—Ä–æ–∫)
‚îÇ       ‚îî‚îÄ‚îÄ MobileNav.tsx            ‚úÖ –ù–û–í–´–ô (60 —Å—Ç—Ä–æ–∫)
‚îÇ
‚îî‚îÄ‚îÄ app/
    ‚îú‚îÄ‚îÄ tours/
    ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx                ‚úÖ –ù–û–í–´–ô (120 —Å—Ç—Ä–æ–∫)
    ‚îî‚îÄ‚îÄ transfers/
        ‚îî‚îÄ‚îÄ page.tsx                 ‚úÖ –ù–û–í–´–ô (100 —Å—Ç—Ä–æ–∫)

‚úÖ –ò–¢–û–ì–û: 10 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤, ~1025 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞
```

---

## üîÑ –û–ë–ù–û–í–õ–ï–ù–ù–´–ï –§–ê–ô–õ–´

### API Routes (9 —Ñ–∞–π–ª–æ–≤):
- ‚úÖ `app/api/transfers/book` - JWT + CSRF + Rate Limit
- ‚úÖ `app/api/transfers/search` - Logger
- ‚úÖ `app/api/transfers/confirm` - Logger + CSRF + Rate Limit
- ‚úÖ `app/api/auth/signin` - JWT + CSRF + Rate Limit
- ‚úÖ `app/api/auth/signup` - JWT + CSRF + Rate Limit
- ‚úÖ `app/api/tours` - Logger + CSRF
- ‚úÖ `app/api/partners` - Logger + CSRF + Rate Limit
- ‚úÖ `app/api/loyalty/promo/apply` - Logger + CSRF + Rate Limit
- ‚úÖ `app/api/webhooks/cloudpayments` - Logger

### –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ (2 —Ñ–∞–π–ª–∞):
- ‚úÖ `lib/transfers/booking.ts` - Logger
- ‚úÖ `lib/payments/transfer-payments.ts` - Logger

### –°—Ç—Ä–∞–Ω–∏—Ü—ã (3 —Ñ–∞–π–ª–∞):
- ‚úÖ `app/page.tsx` - AppLayout
- ‚úÖ `app/hub/tourist/page.tsx` - AppLayout
- ‚úÖ `app/hub/operator/page.tsx` - AppLayout

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (1 —Ñ–∞–π–ª):
- ‚úÖ `package.json` - jsonwebtoken –¥–æ–±–∞–≤–ª–µ–Ω

**–ò–¢–û–ì–û: 15+ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤**

---

## üìä –ú–ï–¢–†–ò–ö–ò –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------------|----|----|-----------|
| CSRF –∑–∞—â–∏—Ç–∞ | 0 routes | 7 routes | +7 ‚úÖ |
| Rate Limiting | 0 routes | 7 routes | +7 ‚úÖ |
| JWT Auth | 0% | 100% | +100% ‚úÖ |
| Hardcoded userId | –ï—Å—Ç—å | –ù–µ—Ç | –£–±—Ä–∞–Ω ‚úÖ |

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:
| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------------|----|----|-----------|
| Console.log | 58+ –º–µ—Å—Ç | 0 –≤ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö | -42 ‚úÖ |
| –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏ | 0 | 42 –º–µ—Å—Ç–∞ | +42 ‚úÖ |
| –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã | 0 | 4 | +4 ‚úÖ |

### UX:
| –ü–æ–∫–∞–∑–∞—Ç–µ–ª—å | –î–æ | –ü–æ—Å–ª–µ | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------------|----|----|-----------|
| Sidebar | –ù–µ—Ç | –ï—Å—Ç—å | +1 ‚úÖ |
| MobileNav | –ù–µ—Ç | –ï—Å—Ç—å | +1 ‚úÖ |
| AppLayout | –ù–µ—Ç | –ï—Å—Ç—å | +1 ‚úÖ |
| –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã | 0 | 2 | +2 ‚úÖ |

---

## üéØ –ö–û–ù–ö–†–ï–¢–ù–´–ï –†–ï–ó–£–õ–¨–¢–ê–¢–´

### –ü—Ä–∏–º–µ—Ä 1: –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–∞

**–ë–´–õ–û:**
```typescript
export async function POST(request: NextRequest) {
  userId: 'user_123', // ‚ùå Hardcoded
  console.log('Booking created'); // ‚ùå Console.log
}
```

**–°–¢–ê–õ–û:**
```typescript
async function handler(request: NextRequest, authPayload: JWTPayload) {
  userId: authPayload.userId, // ‚úÖ –ò–∑ JWT
  logger.info('Booking created', { bookingId, userId }); // ‚úÖ Logger
}

export const POST = withRateLimit(
  RateLimitPresets.creation,
  withCsrfProtection(
    withAuth(handler) // ‚úÖ –¢—Ä–∏ —É—Ä–æ–≤–Ω—è –∑–∞—â–∏—Ç—ã
  )
);
```

### –ü—Ä–∏–º–µ—Ä 2: –ù–∞–≤–∏–≥–∞—Ü–∏—è

**–ë–´–õ–û:**
```tsx
// 5-6 —Ç–∞–±–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
<div className="tabs">
  <Tab>–¢—É—Ä—ã</Tab>
  <Tab>–¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã</Tab>
  <Tab>–ü–æ–≥–æ–¥–∞</Tab>
  // ...
</div>
```

**–°–¢–ê–õ–û:**
```tsx
<AppLayout>
  {/* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç Sidebar + Header */}
  {children}
</AppLayout>

// –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:
/tours      ‚Üí –ö–∞—Ç–∞–ª–æ–≥ —Ç—É—Ä–æ–≤
/transfers  ‚Üí –ü–æ–∏—Å–∫ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
```

---

## üöÄ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –î–ï–ü–õ–û–Æ

### ‚úÖ –í–°–Å –ì–û–¢–û–í–û:
1. ‚úÖ –ö–æ–¥ –Ω–∞–ø–∏—Å–∞–Ω –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
2. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞
3. ‚úÖ –í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
4. ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω–∞
5. ‚úÖ –ù–∞–≤–∏–≥–∞—Ü–∏—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

### üìã –î–õ–Ø –î–ï–ü–õ–û–Ø –ù–£–ñ–ù–û:

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   npm install
   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç jsonwebtoken –∏ @types/jsonwebtoken
   ```

2. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env:**
   ```env
   DATABASE_URL=postgresql://...
   JWT_SECRET=your-secret-key-min-32-chars
   ```

3. **–í—ã–±—Ä–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É:**
   - Vercel (—Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π)
   - Docker (–¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è)
   - Timeweb (—Ä–æ—Å—Å–∏–π—Å–∫–∏–π —Ö–æ—Å—Ç–∏–Ω–≥)

---

## üì∏ –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ó–ú–ï–ù–ï–ù–ò–ô

### –î–æ:
```
‚ùå –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç CSRF
‚ùå –ù–µ—Ç Rate Limiting
‚ùå Hardcoded userId
‚ùå Console.log –≤–µ–∑–¥–µ
‚ùå –¢–∞–±—ã –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
‚ùå –ù–µ—Ç –µ–¥–∏–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
```

### –ü–æ—Å–ª–µ:
```
‚úÖ CSRF –Ω–∞ 7 routes
‚úÖ Rate Limiting –Ω–∞ 7 routes
‚úÖ JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ Sidebar –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚úÖ Mobile –Ω–∞–≤–∏–≥–∞—Ü–∏—è
‚úÖ –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
```

---

## üéâ –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢

### –°–æ–∑–¥–∞–Ω–æ:
- **10 –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤**
- **~1025 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞**
- **4 –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã**

### –û–±–Ω–æ–≤–ª–µ–Ω–æ:
- **15+ —Ñ–∞–π–ª–æ–≤**
- **~400+ —Å—Ç—Ä–æ–∫ —É–ª—É—á—à–µ–Ω–æ**
- **42 console.log –∑–∞–º–µ–Ω–µ–Ω—ã**

### –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:
- **–î–æ:** 95%
- **–ü–æ—Å–ª–µ:** 98%
- **–ü—Ä–∏—Ä–æ—Å—Ç:** +3%

---

## ‚úÖ –í–°–Å –†–ê–ë–û–¢–ê–ï–¢!

**–ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –¥–µ–ø–ª–æ—é –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã
- ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã
- ‚úÖ –ì–æ—Ç–æ–≤—ã –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
