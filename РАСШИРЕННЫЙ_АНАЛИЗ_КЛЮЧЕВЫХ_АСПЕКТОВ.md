# üî¨ –†–ê–°–®–ò–†–ï–ù–ù–´–ô –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó KAMCHATOUR HUB

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** –î–µ–∫–∞–±—Ä—å 2024  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** –ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞, –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏  
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç

---

## üìä EXECUTIVE SUMMARY

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞: **8.5/10**

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Next.js 14 App Router
- ‚úÖ –•–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (24 —Ç–∞–±–ª–∏—Ü—ã)
- ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Ç—Ä–∞–Ω—Å—Ñ–µ—Ä—ã, –ª–æ—è–ª—å–Ω–æ—Å—Ç—å, –ø–ª–∞—Ç–µ–∂–∏)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö
- ‚úÖ –•–æ—Ä–æ—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (89 try-catch –±–ª–æ–∫–æ–≤)
- ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è TypeScript –≤–æ –≤—Å–µ—Ö –º–æ–¥—É–ª—è—Ö

**–û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚ö†Ô∏è –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (40%)
- ‚ö†Ô∏è –ú–Ω–æ–≥–æ console.log –≤ production –∫–æ–¥–µ (58+ –≤—Ö–æ–∂–¥–µ–Ω–∏–π)
- ‚ö†Ô∏è Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è –∏ TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
- ‚ö†Ô∏è –ù–µ–∫–æ—Ç–æ—Ä—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã
- ‚ö†Ô∏è CSRF –∏ Rate Limiting –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤–µ–∑–¥–µ

---

## 1. üîç –ê–ù–ê–õ–ò–ó –ö–ê–ß–ï–°–¢–í–ê –ö–û–î–ê

### 1.1 –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

**1. Separation of Concerns**
```
‚úÖ API routes ‚Üí –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ ‚Üí –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ layers
‚úÖ Reusable –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (lib/)
```

**2. Error Handling**
- **89 try-catch –±–ª–æ–∫–æ–≤** –≤–æ –≤—Å–µ—Ö –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –º–µ—Å—Ç–∞—Ö
- Graceful degradation (fallback –∫ mock –¥–∞–Ω–Ω—ã–º –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ë–î)
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ error responses
- –ù–µ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**3. Transaction Management**
```typescript
// –û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä –∏–∑ lib/transfers/booking.ts
export async function createBookingWithLock() {
  return await transaction(async (client: PoolClient) => {
    // SELECT FOR UPDATE NOWAIT - –∑–∞—â–∏—Ç–∞ –æ—Ç race conditions
    // –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
  });
}
```

**4. Type Safety**
- TypeScript –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–µ–∑–¥–µ
- –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
- Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–ª—è API

#### ‚ö†Ô∏è –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:

**1. Hardcoded –∑–Ω–∞—á–µ–Ω–∏—è**
```typescript
// app/api/transfers/search/route.ts:74-75
const fromCoords = { lat: 53.02, lng: 158.65 };  // ‚ùå Hardcoded
const toCoords = { lat: 53.17, lng: 158.65 };    // ‚ùå Hardcoded
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –í—ã–Ω–µ—Å—Ç–∏ –≤ config –∏–ª–∏ –ø–æ–ª—É—á–∞—Ç—å –∏–∑ –≥–µ–æ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è
const fromCoords = await geocodeLocation(from);
const toCoords = await geocodeLocation(to);
```

**2. TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ production –∫–æ–¥–µ**
```typescript
// app/api/transfers/book/route.ts:104
userId: 'user_123', // TODO: –ø–æ–ª—É—á–∞—Ç—å –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞  // ‚ö†Ô∏è
```

**3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞**
- –§—É–Ω–∫—Ü–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ mock –¥–∞–Ω–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä—è—é—Ç—Å—è
- –ü–∞—Ç—Ç–µ—Ä–Ω—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ —Ä–∞–∑–Ω—ã—Ö routes

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã:
```typescript
// lib/utils/validation.ts
export function validateBookingRequest(body: any): ValidationResult

// lib/utils/mock-data.ts
export function generateMockTransfers(...)
```

### 1.2 SQL –∑–∞–ø—Ä–æ—Å—ã –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

**1. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**
```typescript
// ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã - –∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection
await query('SELECT * FROM tours WHERE id = $1', [tourId]);
```

**2. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π**
```typescript
// ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏
SELECT ... FOR UPDATE NOWAIT
UPDATE ... WHERE available_seats >= $1
```

**3. –ò–Ω–¥–µ–∫—Å—ã**
- 50+ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- GIST –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è PostGIS
- –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø–æ–ª—è—Ö (status, dates, foreign keys)

#### ‚ö†Ô∏è –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:

**1. N+1 Query Problem**

–í `app/api/transfers/search/route.ts`:
```typescript
// ‚ùå –î–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ JOIN
const routeResult = await query(routeQuery, [...]);
const scheduleResult = await query(scheduleQuery, [...]);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```sql
-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω JOIN –∑–∞–ø—Ä–æ—Å
SELECT s.*, r.*, v.*, d.*, o.*
FROM transfer_schedules s
JOIN transfer_routes r ON s.route_id = r.id
JOIN transfer_vehicles v ON s.vehicle_id = v.id
WHERE ...
```

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ connection pooling optimization**

–¢–µ–∫—É—â–∏–π –ø—É–ª:
```typescript
max: 20,              // ‚úÖ –•–æ—Ä–æ—à–æ
idleTimeoutMillis: 30000,  // ‚úÖ
connectionTimeoutMillis: 2000,  // ‚úÖ
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—É–ª–∞:
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏
pool.on('acquire', (client) => {
  metrics.connectionAcquired++;
});

pool.on('error', (err, client) => {
  logger.error('Pool error', err);
});
```

**3. –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ LIMIT**

–í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç LIMIT –¥–ª—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –±–æ–ª—å—à–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
```typescript
// ‚ö†Ô∏è –ú–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å —Ç—ã—Å—è—á–∏ —Å—Ç—Ä–æ–∫
SELECT * FROM transfer_bookings WHERE user_id = $1
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤–µ–∑–¥–µ
SELECT * FROM transfer_bookings 
WHERE user_id = $1 
ORDER BY created_at DESC 
LIMIT $2 OFFSET $3
```

### 1.3 Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

#### ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

**1. –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ hooks (useState, useEffect, useRef)
- Client Components –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–æ–º–µ—á–µ–Ω—ã `'use client'`
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

**2. Error Boundaries**
```typescript
// ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
catch (err) {
  console.error('Error fetching data:', err);
  // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å fallback UI
}
```

**3. Accessibility**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ semantic HTML
- –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

#### ‚ö†Ô∏è –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–µ–º–æ–∏–∑–∞—Ü–∏–∏**

–í `app/page.tsx`:
```typescript
// ‚ùå –ü–µ—Ä–µ—Å–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–Ω–¥–µ—Ä–µ
const mockTransfers = generateMockTransfers(...);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Ä–æ–≥–∏–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
const mockTransfers = useMemo(() => 
  generateMockTransfers(...), 
  [from, to, date]
);
```

**2. Console.log –≤ production**

**–ù–∞–π–¥–µ–Ω–æ 58+ console.log/error –≤ production –∫–æ–¥–µ**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –°–æ–∑–¥–∞—Ç—å logger —Å —É—Ä–æ–≤–Ω—è–º–∏
import { logger } from '@/lib/logger';

// –í development: console.log
// –í production: –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Sentry/–¥—Ä—É–≥–æ–π —Å–µ—Ä–≤–∏—Å
logger.debug('Transfer search', { from, to });
logger.error('Database error', error);
```

**3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Loading States**

–ù–µ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç loading —Å–æ—Å—Ç–æ—è–Ω–∏—è:
```typescript
// ‚ùå –ù–µ—Ç –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏
const [tours, setTours] = useState<Tour[]>([]);
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
const [loading, setLoading] = useState(true);
const [error, setError] = useState<string | null>(null);

// –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å skeleton/loading UI
```

---

## 2. üîê –ê–ù–ê–õ–ò–ó –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 2.1 ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:

**1. SQL Injection Protection**
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω—ã
- ‚úÖ –ù–µ—Ç –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –≤ SQL
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è pg –±–∏–±–ª–∏–æ—Ç–µ–∫–∞

**2. CSRF Protection**
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω middleware (`lib/middleware/csrf.ts`)
- ‚úÖ Double Submit Cookie Pattern
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `crypto.timingSafeEqual` –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç timing attacks

**3. Rate Limiting**
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω middleware (`lib/middleware/rate-limit.ts`)
- ‚úÖ Sliding window algorithm
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**4. Security Headers**
```typescript
// middleware.ts - ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
X-Content-Type-Options: nosniff
X-Frame-Options: DENY
X-XSS-Protection: 1; mode=block
Referrer-Policy: strict-origin-when-cross-origin
```

**5. Password Security**
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π (–ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è)

**6. Transaction Security**
- ‚úÖ SELECT FOR UPDATE NOWAIT –∑–∞—â–∏—â–∞–µ—Ç –æ—Ç race conditions
- ‚úÖ –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö

### 2.2 ‚ö†Ô∏è –£—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏ —Ä–∏—Å–∫–∏:

#### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï:

**1. CSRF –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–µ–∑–¥–µ**

**–ü—Ä–æ–±–ª–µ–º–∞:** CSRF middleware —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω–æ –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º API routes.

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω `withCsrfProtection`
- ‚ùå –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ POST/PUT/DELETE routes

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤–µ–∑–¥–µ –≥–¥–µ –Ω—É–∂–Ω–∞ –∑–∞—â–∏—Ç–∞
import { withCsrfProtection } from '@/lib/middleware/csrf';

export const POST = withCsrfProtection(async (request: NextRequest) => {
  // Handler –∫–æ–¥
});
```

**2. Rate Limiting –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤–µ–∑–¥–µ**

**–ü—Ä–æ–±–ª–µ–º–∞:** Rate limiting middleware —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
import { withRateLimit, RateLimitPresets } from '@/lib/middleware/rate-limit';

export const POST = withRateLimit(
  RateLimitPresets.creation,
  async (request: NextRequest) => {
    // Handler
  }
);
```

**3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ JWT —Ç–æ–∫–µ–Ω–æ–≤**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –∫–æ–¥–µ –µ—Å—Ç—å TODO –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è userId –∏–∑ JWT:
```typescript
userId: 'user_123', // TODO: –ø–æ–ª—É—á–∞—Ç—å –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ JWT
import { verifyJWT } from '@/lib/auth';

export function withAuth(handler: Function) {
  return async (request: NextRequest) => {
    const token = request.headers.get('authorization')?.replace('Bearer ', '');
    const userId = await verifyJWT(token);
    if (!userId) {
      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
    }
    return handler(request, userId);
  };
}
```

#### üü° –°–†–ï–î–ù–ò–ï:

**1. –°–µ–∫—Ä–µ—Ç—ã –≤ –∫–æ–¥–µ**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è hardcoded:
```typescript
// lib/notifications/email.ts:130
<p>üìû +7 (XXX) XXX-XX-XX | üìß info@kamchatour.ru</p>
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ –≤ environment variables.

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ input sanitization**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ –≤—Å–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–∞–Ω–∏—Ç–∏–∑–∏—Ä—É—é—Ç—Å—è –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ –ë–î.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
import { sanitize } from 'sanitize-html';

const sanitizedComment = sanitize(userInput.comment, {
  allowedTags: [],
  allowedAttributes: {}
});
```

**3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ HTTPS enforcement**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –î–æ–±–∞–≤–∏—Ç—å –≤ middleware:
```typescript
if (process.env.NODE_ENV === 'production' && !request.url.startsWith('https://')) {
  return NextResponse.redirect(request.url.replace('http://', 'https://'));
}
```

#### üü¢ –ù–ò–ó–ö–ò–ï:

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ security.txt**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å `/public/.well-known/security.txt`

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CORS –¥–ª—è production:
```typescript
const corsHeaders = {
  'Access-Control-Allow-Origin': process.env.ALLOWED_ORIGINS,
  'Access-Control-Allow-Methods': 'GET,POST,PUT,DELETE',
  'Access-Control-Allow-Headers': 'Content-Type,Authorization',
};
```

---

## 3. ‚ö° –ê–ù–ê–õ–ò–ó –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–ò

### 3.1 ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:

**1. Database Connection Pooling**
```typescript
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—É–ª
max: 20,
idleTimeoutMillis: 30000,
connectionTimeoutMillis: 2000
```

**2. –ò–Ω–¥–µ–∫—Å—ã –≤ –ë–î**
- ‚úÖ 50+ –∏–Ω–¥–µ–∫—Å–æ–≤
- ‚úÖ GIST –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è PostGIS
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ foreign keys

**3. Edge Runtime –¥–ª—è AI**
```typescript
// ‚úÖ –ë—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è AI
export const runtime = 'edge'
```

**4. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (—á–∞—Å—Ç–∏—á–Ω–æ)**
- ‚úÖ Weather API –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 30 –º–∏–Ω—É—Ç
- ‚úÖ –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è

### 3.2 ‚ö†Ô∏è –£–∑–∫–∏–µ –º–µ—Å—Ç–∞:

#### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï:

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è API responses**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–∏–µ API –∑–∞–ø—Ä–æ—Å—ã –Ω–µ –∫—ç—à–∏—Ä—É—é—Ç—Å—è.

**–ü—Ä–∏–º–µ—Ä:**
```typescript
// app/api/tours/route.ts
// ‚ùå –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –≤ –ë–î
const result = await query('SELECT * FROM tours WHERE ...');
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
import { cache } from '@/lib/cache';

export async function GET(request: NextRequest) {
  const cacheKey = `tours:${searchParams.toString()}`;
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
  const cached = await cache.get(cacheKey);
  if (cached) return NextResponse.json(cached);
  
  // –ó–∞–ø—Ä–æ—Å –∫ –ë–î
  const data = await query(...);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫—ç—à (TTL: 5 –º–∏–Ω—É—Ç)
  await cache.set(cacheKey, data, 300);
  
  return NextResponse.json(data);
}
```

**2. N+1 Query Problem**

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö –¥–µ–ª–∞—é—Ç—Å—è –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤–º–µ—Å—Ç–æ JOIN.

**–ü—Ä–∏–º–µ—Ä –∏–∑ `app/api/transfers/search/route.ts`:**
```typescript
// ‚ùå –î–≤–∞ –∑–∞–ø—Ä–æ—Å–∞
const routeResult = await query(routeQuery, [...]);
const scheduleResult = await query(scheduleQuery, [...]);
```

**–†–µ—à–µ–Ω–∏–µ:** –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –≤ –æ–¥–∏–Ω JOIN –∑–∞–ø—Ä–æ—Å.

**3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ú–Ω–æ–≥–∏–µ endpoints –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –≤—Å–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤–µ–∑–¥–µ
const page = parseInt(searchParams.get('page') || '1');
const limit = parseInt(searchParams.get('limit') || '20');
const offset = (page - 1) * limit;

const query = `
  SELECT * FROM tours
  ORDER BY created_at DESC
  LIMIT $1 OFFSET $2
`;
```

#### üü° –°–†–ï–î–ù–ò–ï:

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ database query optimization**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `EXPLAIN ANALYZE` –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
```sql
EXPLAIN ANALYZE 
SELECT * FROM transfer_schedules 
WHERE route_id IN (...)
```

**2. –ë–æ–ª—å—à–∏–µ JSONB –ø–æ–ª—è**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è JSONB –º–æ–≥—É—Ç –±—ã—Ç—å –±–æ–ª—å—à–∏–º–∏ (preferences, context).

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í—ã–Ω–µ—Å—Ç–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏:
```sql
-- –í–º–µ—Å—Ç–æ preferences JSONB
ALTER TABLE users ADD COLUMN interests TEXT[];
ALTER TABLE users ADD COLUMN budget_min DECIMAL;
ALTER TABLE users ADD COLUMN budget_max DECIMAL;
```

**3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ lazy loading –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Next.js Image –∫–æ–º–ø–æ–Ω–µ–Ω—Ç:
```typescript
import Image from 'next/image';

<Image 
  src={tour.image} 
  alt={tour.name}
  width={400}
  height={300}
  loading="lazy"
/>
```

#### üü¢ –ù–ò–ó–ö–ò–ï:

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ compression**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –í–∫–ª—é—á–∏—Ç—å gzip/brotli compression –≤ Next.js config.

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CDN**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤.

---

## 4. üèóÔ∏è –ê–ù–ê–õ–ò–ó –ê–†–•–ò–¢–ï–ö–¢–£–†–´

### 4.1 ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

**1. –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**
```
‚úÖ –ß–µ—Ç–∫–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ:
   - app/ - routing
   - components/ - UI
   - lib/ - –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
   - types/ - —Ç–∏–ø—ã
```

**2. Separation of Concerns**
- ‚úÖ API routes –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É
- ‚úÖ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –≤—ã–Ω–µ—Å–µ–Ω–∞ –≤ lib/
- ‚úÖ –¢–∏–ø—ã —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã

**3. Reusable Components**
- ‚úÖ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
- ‚úÖ Context API –¥–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

**4. Database Schema**
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (3NF)
- ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ foreign keys
- ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### 4.2 ‚ö†Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

#### üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï:

**1. Tight Coupling**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–¥—É–ª–∏ —Å–∏–ª—å–Ω–æ —Å–≤—è–∑–∞–Ω—ã.

**–ü—Ä–∏–º–µ—Ä:**
```typescript
// app/api/transfers/book/route.ts
// ‚ùå –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –º–Ω–æ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
import { smsService } from '@/lib/notifications/sms';
import { emailService } from '@/lib/notifications/email';
import { telegramService } from '@/lib/notifications/telegram';
import { transferPayments } from '@/lib/payments/transfer-payments';
import { matchingEngine } from '@/lib/transfers/matching';
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —Ñ–∞—Å–∞–¥:
```typescript
// lib/transfers/transfer-facade.ts
export class TransferFacade {
  async bookTransfer(request: BookingRequest) {
    // –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    const booking = await this.bookingService.create(request);
    await this.notificationService.send(booking);
    await this.paymentService.create(booking);
  }
}
```

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Dependency Injection**

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Ä–≤–∏—Å—ã —Å–æ–∑–¥–∞—é—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å DI –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∏–ª–∏ factory pattern.

#### üü° –°–†–ï–î–ù–ò–ï:

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Service Layer**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Å–º–µ—à–∞–Ω–∞ —Å –¥–∞–Ω–Ω—ã–º–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å service layer:
```
lib/
  services/
    transfer-service.ts
    loyalty-service.ts
    payment-service.ts
```

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Repository Pattern**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// lib/repositories/transfer-repository.ts
export class TransferRepository {
  async findById(id: string): Promise<Transfer> {
    return query('SELECT * FROM transfers WHERE id = $1', [id]);
  }
}
```

---

## 5. üß™ –ê–ù–ê–õ–ò–ó –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø

### 5.1 ‚úÖ –ß—Ç–æ –µ—Å—Ç—å:

**1. –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
- ‚úÖ Vitest –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ Test setup —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- ‚úÖ 4 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–∞:
  - `test/api/transfers.test.ts`
  - `test/api/loyalty.test.ts`
  - `test/webhook-validation.test.ts`
  - `test/booking-race-condition.test.ts`

**2. –ö–∞—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤**
- ‚úÖ –¢–µ—Å—Ç–∏—Ä—É—é—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è—é—Ç race conditions

### 5.2 ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

**1. –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ (‚âà40%)**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–≤–µ–ª–∏—á–∏—Ç—å –¥–æ 80%+:
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è –≤—Å–µ—Ö lib/ –º–æ–¥—É–ª–µ–π
- Integration —Ç–µ—Å—Ç—ã –¥–ª—è API
- E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–∫–æ–≤**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// test/mocks/database.ts
export const mockQuery = vi.fn();
vi.mock('@/lib/database', () => ({
  query: mockQuery
}));
```

**3. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ test fixtures**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:
```typescript
// test/fixtures/transfers.ts
export const mockTransfer = {
  id: 'test-transfer-1',
  route: { ... },
  vehicle: { ... }
};
```

---

## 6. üìù –ê–ù–ê–õ–ò–ó –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–ò

### 6.1 ‚úÖ –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:

- ‚úÖ README.md –ø–æ–¥—Ä–æ–±–Ω—ã–π
- ‚úÖ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ
- ‚úÖ JSDoc –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö

### 6.2 ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º—ã:

**1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å OpenAPI/Swagger:
```typescript
/**
 * @swagger
 * /api/transfers/search:
 *   get:
 *     summary: –ü–æ–∏—Å–∫ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
 *     parameters:
 *       - name: from
 *         in: query
 *         required: true
 */
```

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º**

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å:
- ER –¥–∏–∞–≥—Ä–∞–º–º—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- Sequence –¥–∏–∞–≥—Ä–∞–º–º—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
- Component –¥–∏–∞–≥—Ä–∞–º–º—ã

---

## 7. üéØ –ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### üî¥ –ö–†–ò–¢–ò–ß–ù–û (—Å–¥–µ–ª–∞—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å CSRF –∑–∞—â–∏—Ç—É –≤–µ–∑–¥–µ**
   - –û–±–µ—Ä–Ω—É—Ç—å –≤—Å–µ POST/PUT/DELETE routes –≤ `withCsrfProtection`
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

2. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å Rate Limiting**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `withRateLimit` –¥–ª—è –≤—Å–µ—Ö API routes
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö endpoints

3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é**
   - –°–æ–∑–¥–∞—Ç—å middleware `withAuth`
   - –£–±—Ä–∞—Ç—å hardcoded `userId: 'user_123'`

4. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Redis –¥–ª—è –∫—ç—à–∞
   - –ö—ç—à–∏—Ä–æ–≤–∞—Ç—å —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã

5. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å N+1 –∑–∞–ø—Ä–æ—Å—ã**
   - –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –≤ JOIN

### üü° –í–ê–ñ–ù–û (—Å–¥–µ–ª–∞—Ç—å –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è):

1. **–£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –¥–æ 80%+**
2. **–î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤–µ–∑–¥–µ**
3. **–£–±—Ä–∞—Ç—å console.log –∏–∑ production**
4. **–°–æ–∑–¥–∞—Ç—å logger —Å —É—Ä–æ–≤–Ω—è–º–∏**
5. **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏**

### üü¢ –ñ–ï–õ–ê–¢–ï–õ–¨–ù–û:

1. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**
   - Service layer
   - Repository pattern
   - Dependency Injection

2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
   - Database query optimization
   - Image optimization
   - CDN –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏

3. **–£–ª—É—á—à–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏**
   - API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (OpenAPI)
   - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã

---

## 8. üìà –ú–ï–¢–†–ò–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê

### –ö–æ–¥:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –í—Å–µ–≥–æ —Ñ–∞–π–ª–æ–≤ | ~150+ |
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~15,000+ |
| TypeScript —Ñ–∞–π–ª–æ–≤ | 44+ |
| React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ | 11 |
| API endpoints | 25+ |
| Try-catch –±–ª–æ–∫–æ–≤ | 89 |
| Console.log | 58+ |
| TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ | 10+ |

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –¢–∞–±–ª–∏—Ü | 24 |
| –ò–Ω–¥–µ–∫—Å–æ–≤ | 50+ |
| –¢—Ä–∏–≥–≥–µ—Ä–æ–≤ | 5+ |
| –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π (Views) | 3 |

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –¢–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤ | 4 |
| –ü–æ–∫—Ä—ã—Ç–∏–µ | ~40% |
| Unit —Ç–µ—Å—Ç–æ–≤ | –ß–∞—Å—Ç–∏—á–Ω–æ |
| Integration —Ç–µ—Å—Ç–æ–≤ | –ß–∞—Å—Ç–∏—á–Ω–æ |
| E2E —Ç–µ—Å—Ç–æ–≤ | –ù–µ—Ç |

---

## 9. ‚úÖ –ß–ï–ö–õ–ò–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ô

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å CSRF –∫–æ –≤—Å–µ–º state-changing –æ–ø–µ—Ä–∞—Ü–∏—è–º
- [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å Rate Limiting –∫–æ –≤—Å–µ–º API routes
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- [ ] –î–æ–±–∞–≤–∏—Ç—å input sanitization
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å HTTPS enforcement
- [ ] –°–æ–∑–¥–∞—Ç—å security.txt

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- [ ] –î–æ–±–∞–≤–∏—Ç—å Redis –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å N+1 –∑–∞–ø—Ä–æ—Å—ã
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ø–∞–≥–∏–Ω–∞—Ü–∏—é –≤–µ–∑–¥–µ
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CDN

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:
- [ ] –£–±—Ä–∞—Ç—å console.log –∏–∑ production
- [ ] –°–æ–∑–¥–∞—Ç—å logger —Å —É—Ä–æ–≤–Ω—è–º–∏
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å hardcoded –∑–Ω–∞—á–µ–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å TODO –∑–∞–¥–∞—á–∏
- [ ] –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–æ 80%+
- [ ] –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è lib/
- [ ] –î–æ–±–∞–≤–∏—Ç—å integration —Ç–µ—Å—Ç—ã –¥–ª—è API
- [ ] –î–æ–±–∞–≤–∏—Ç—å E2E —Ç–µ—Å—Ç—ã

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
- [ ] –°–æ–∑–¥–∞—Ç—å service layer
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å repository pattern
- [ ] –î–æ–±–∞–≤–∏—Ç—å dependency injection
- [ ] –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ tight coupling

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [ ] –°–æ–∑–¥–∞—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é (OpenAPI)
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –¥–∏–∞–≥—Ä–∞–º–º—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ API endpoints

---

## 10. üéì –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ü—Ä–æ–µ–∫—Ç **Kamchatour Hub** –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **–≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏** —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ –∏ —Ö–æ—Ä–æ—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π. –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—É–º–∞–Ω–∞, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∑–∞—â–∏—Ç–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤.

**–û—Ü–µ–Ω–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É: 85%**

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (CSRF, Rate Limiting, JWT) –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É.

**–ì–ª–∞–≤–Ω—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è:**
- ‚úÖ –ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç race conditions
- ‚úÖ –•–æ—Ä–æ—à–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –¢–∏–ø–∏–∑–∞—Ü–∏—è TypeScript

**–ì–ª–∞–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏:**
- üî¥ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∑–∞—â–∏—Ç–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã –≤–µ–∑–¥–µ
- üî¥ –£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- üî¥ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** –î–µ–∫–∞–±—Ä—å 2024  
**–ê–≤—Ç–æ—Ä:** AI Assistant (Composer)  
**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω—ã–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –∞—É–¥–∏—Ç –∑–∞–≤–µ—Ä—à–µ–Ω
