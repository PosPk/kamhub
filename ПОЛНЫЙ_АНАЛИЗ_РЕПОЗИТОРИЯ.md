# üìä –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó –†–ï–ü–û–ó–ò–¢–û–†–ò–Ø KAMCHATOUR HUB

**–î–∞—Ç–∞ –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-27  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 0.1.0  
**–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Next.js 14.2.15 + TypeScript + PostgreSQL

---

## üìã EXECUTIVE SUMMARY

**Kamchatour Hub** ‚Äî –∫–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Ç—É—Ä–∏—Å—Ç–∏—á–µ—Å–∫–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –ö–∞–º—á–∞—Ç—Å–∫–æ–≥–æ –∫—Ä–∞—è, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ç–µ–∫–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π. –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç:

- ‚úÖ **Full-stack –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –Ω–∞ Next.js 14 —Å App Router
- ‚úÖ **PostgreSQL –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** —Å PostGIS –¥–ª—è –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö
- ‚úÖ **AI-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** (GROQ, DeepSeek, OpenRouter)
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤** —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π –º–µ—Å—Ç
- ‚úÖ **CRM –¥–ª—è —Ç—É—Ä–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤**
- ‚úÖ **–°–∏—Å—Ç–µ–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏** –∏ —ç–∫–æ-–±–∞–ª–ª—ã
- ‚úÖ **–ü–ª–∞—Ç–µ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** CloudPayments
- ‚úÖ **Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã:**
- **90** TypeScript/TSX —Ñ–∞–π–ª–æ–≤
- **~20,000** —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ (–±–µ–∑ node_modules)
- **62** TypeScript –º–æ–¥—É–ª—è —Å —ç–∫—Å–ø–æ—Ä—Ç–∞–º–∏
- **107** markdown —Ñ–∞–π–ª–æ–≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- **19,888** —Å—Ç—Ä–æ–∫ SQL —Å—Ö–µ–º

---

## üèóÔ∏è –ê–†–•–ò–¢–ï–ö–¢–£–†–ê –ü–†–û–ï–ö–¢–ê

### **1. –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫**

#### Frontend
- **Next.js 14.2.15** —Å App Router (React 18.2.0)
- **TypeScript 5.4.5** (—Å—Ç—Ä–æ–≥–∏–π —Ä–µ–∂–∏–º)
- **TailwindCSS 3.4.10** –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
- **Floating UI** –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ (popover, tooltips)
- **React Context API** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º

#### Backend
- **Next.js API Routes** (Node.js runtime)
- **PostgreSQL 15** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏:
  - `uuid-ossp` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è UUID
  - `postgis` ‚Äî –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- **pg (8.11.5)** ‚Äî PostgreSQL –∫–ª–∏–µ–Ω—Ç
- **Connection Pooling** (–º–∞–∫—Å. 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π)

#### AI & –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- **GROQ API** ‚Äî Llama 3.1 70B (–æ—Å–Ω–æ–≤–Ω–æ–π)
- **DeepSeek API** ‚Äî DeepSeek Chat (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
- **OpenRouter API** ‚Äî –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
- **Yandex Maps API** ‚Äî –∫–∞—Ä—Ç—ã –∏ –≥–µ–æ–∫–æ–¥–∏–Ω–≥
- **Open-Meteo API** ‚Äî –ø–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

#### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **Docker & Docker Compose** –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Vercel** ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–µ–ø–ª–æ—è
- **Timeweb Cloud Apps** ‚Äî –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥
- **Node.js 20+** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
- **npm 10+** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)

---

### **2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π**

```
kamhub/
‚îú‚îÄ‚îÄ app/                    # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ api/               # API –º–∞—Ä—à—Ä—É—Ç—ã (25+ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ai/            # AI —Å–µ—Ä–≤–∏—Å—ã (GROQ, DeepSeek)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/          # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (signin, signup, demo)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ chat/          # AI —á–∞—Ç
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tours/         # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ partners/      # –ü–∞—Ä—Ç–Ω–µ—Ä—ã/–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transfers/     # –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ weather/        # –ü–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ eco-points/    # –≠–∫–æ-—Å–∏—Å—Ç–µ–º–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loyalty/       # –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ webhooks/      # CloudPayments webhooks
‚îÇ   ‚îú‚îÄ‚îÄ hub/               # –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tourist/       # –î–ª—è —Ç—É—Ä–∏—Å—Ç–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ operator/      # CRM –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guide/         # –î–ª—è –≥–∏–¥–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transfer/      # –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stay/          # –†–∞–∑–º–µ—â–µ–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...            # –î—Ä—É–≥–∏–µ —Ä–æ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx         # –ö–æ—Ä–Ω–µ–≤–æ–π layout
‚îÇ   ‚îî‚îÄ‚îÄ page.tsx           # –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
‚îÇ
‚îú‚îÄ‚îÄ components/            # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (11 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ AIChatWidget.tsx   # AI-—á–∞—Ç –≤–∏–¥–∂–µ—Ç
‚îÇ   ‚îú‚îÄ‚îÄ TourCard.tsx       # –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç—É—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ PartnerCard.tsx    # –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ WeatherWidget.tsx  # –í–∏–¥–∂–µ—Ç –ø–æ–≥–æ–¥—ã
‚îÇ   ‚îú‚îÄ‚îÄ EcoPointsWidget.tsx # –≠–∫–æ-–±–∞–ª–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ TransferMap.tsx    # –ö–∞—Ä—Ç–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ LoyaltyWidget.tsx  # –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îî‚îÄ‚îÄ Protected.tsx     # –ó–∞—â–∏—Ç–∞ –º–∞—Ä—à—Ä—É—Ç–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ contexts/               # React Context Providers (3)
‚îÇ   ‚îú‚îÄ‚îÄ RoleContext.tsx    # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.tsx    # –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ OrdersContext.tsx  # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
‚îÇ
‚îú‚îÄ‚îÄ lib/                    # –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã (25 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ config.ts          # –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.ts        # –†–∞–±–æ—Ç–∞ —Å PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ database/          # SQL —Å—Ö–µ–º—ã (6 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.sql     # –û—Å–Ω–æ–≤–Ω–∞—è —Å—Ö–µ–º–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ transfer_schema.sql    # –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ loyalty_schema.sql     # –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seat_holds_schema.sql  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –º–µ—Å—Ç
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transfer_payments_schema.sql # –ü–ª–∞—Ç–µ–∂–∏
‚îÇ   ‚îú‚îÄ‚îÄ transfers/         # –õ–æ–≥–∏–∫–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ booking.ts     # –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ matching.ts    # –ü–æ–¥–±–æ—Ä —Ä–µ–π—Å–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ payments/          # –ü–ª–∞—Ç–µ–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cloudpayments-webhook.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ transfer-payments.ts
‚îÇ   ‚îú‚îÄ‚îÄ loyalty/           # –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ maps/              # Yandex Maps –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ notifications/     # Email, SMS, Telegram
‚îÇ   ‚îú‚îÄ‚îÄ middleware/       # CSRF, rate-limit, validation
‚îÇ   ‚îî‚îÄ‚îÄ utils.ts           # –û–±—â–∏–µ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ types/                 # TypeScript —Ç–∏–ø—ã (2 —Ñ–∞–π–ª–∞)
‚îÇ   ‚îú‚îÄ‚îÄ index.ts           # –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã (Tour, Partner, User...)
‚îÇ   ‚îî‚îÄ‚îÄ transfer.ts        # –¢–∏–ø—ã –¥–ª—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
‚îÇ
‚îú‚îÄ‚îÄ scripts/               # –°–∫—Ä–∏–ø—Ç—ã —É—Ç–∏–ª–∏—Ç—ã (14 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ migrate.ts         # –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ timeweb-setup.ts   # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Timeweb
‚îÇ   ‚îî‚îÄ‚îÄ *.sh               # Bash —Å–∫—Ä–∏–ø—Ç—ã –¥–ª—è –¥–µ–ø–ª–æ—è
‚îÇ
‚îú‚îÄ‚îÄ test/                  # –¢–µ—Å—Ç—ã (5 —Ñ–∞–π–ª–æ–≤)
‚îÇ   ‚îú‚îÄ‚îÄ booking-race-condition.test.ts
‚îÇ   ‚îú‚îÄ‚îÄ webhook-validation.test.ts
‚îÇ   ‚îî‚îÄ‚îÄ api/               # API —Ç–µ—Å—Ç—ã
‚îÇ
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Dockerfile             # Production Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ middleware.ts          # Next.js middleware
‚îú‚îÄ‚îÄ next.config.js         # Next.js –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îî‚îÄ‚îÄ package.json           # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
```

---

## üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ö–û–ú–ü–û–ù–ï–ù–¢–û–í

### **1. API Endpoints (25+ –º–∞—Ä—à—Ä—É—Ç–æ–≤)**

#### **AI & Chat**
- `POST /api/ai` ‚Äî –∫–æ–Ω—Å–µ–Ω—Å—É—Å –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
- `POST /api/ai/groq` ‚Äî –ø—Ä—è–º–æ–π –≤—ã–∑–æ–≤ GROQ
- `POST /api/chat` ‚Äî AI —á–∞—Ç —Å –∏—Å—Ç–æ—Ä–∏–µ–π

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Fallback –º–µ–∂–¥—É GROQ ‚Üí DeepSeek ‚Üí OpenRouter
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ç—É—Ä–∏–∑–º–∞ –ö–∞–º—á–∞—Ç–∫–∏
- Edge Runtime –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
- `POST /api/auth/signin` ‚Äî –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
- `POST /api/auth/signup` ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /api/auth/demo` ‚Äî –¥–µ–º–æ-—Ä–µ–∂–∏–º
- `GET /api/csrf-token` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞

#### **–¢—É—Ä—ã**
- `GET /api/tours` ‚Äî —Å–ø–∏—Å–æ–∫ —Ç—É—Ä–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞: `activity`, `search`, `minPrice`, `maxPrice`, `limit`, `offset`
  - JOIN —Å –ø–∞—Ä—Ç–Ω–µ—Ä–∞–º–∏ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
  - –ü–∞–≥–∏–Ω–∞—Ü–∏—è

#### **–ü–∞—Ä—Ç–Ω–µ—Ä—ã**
- `GET /api/partners` ‚Äî —Å–ø–∏—Å–æ–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
  - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
  - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–∞
  - –†–µ–π—Ç–∏–Ω–≥–∏ –∏ –æ—Ç–∑—ã–≤—ã

#### **–¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã** (—Å–ª–æ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞)
- `GET /api/transfers/search` ‚Äî –ø–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤
  - –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (PostGIS)
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–µ—Å—Ç –Ω–∞ –≤—Ä–µ–º—è
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- `POST /api/transfers/book` ‚Äî –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- `POST /api/transfers/confirm` ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- `POST /api/transfers/payment/confirm` ‚Äî –æ–ø–ª–∞—Ç–∞
- `GET /api/transfers/operator/dashboard` ‚Äî –¥–∞—à–±–æ—Ä–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

#### **–õ–æ—è–ª—å–Ω–æ—Å—Ç—å**
- `GET /api/loyalty/levels` ‚Äî —É—Ä–æ–≤–Ω–∏ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- `GET /api/loyalty/stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /api/loyalty/promo/apply` ‚Äî –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–∞

#### **–≠–∫–æ-—Å–∏—Å—Ç–µ–º–∞**
- `GET /api/eco-points` ‚Äî —Ç–æ—á–∫–∏ —ç–∫–æ-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- `GET /api/eco-points/user` ‚Äî —ç–∫–æ-–±–∞–ª–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### **–ü—Ä–æ—á–µ–µ**
- `GET /api/weather` ‚Äî –ø–æ–≥–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `GET /api/health/db` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –ë–î
- `POST /api/webhooks/cloudpayments` ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- `GET /api/roles` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏
- `GET /api/operator/stats` ‚Äî –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

---

### **2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)**

#### **–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã**

**users** ‚Äî –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
```sql
- id (UUID)
- email (UNIQUE)
- name
- role (tourist | operator | guide | provider)
- preferences (JSONB)
- created_at, updated_at
```

**partners** ‚Äî –ü–∞—Ä—Ç–Ω–µ—Ä—ã/–û–ø–µ—Ä–∞—Ç–æ—Ä—ã
```sql
- id (UUID)
- name
- category (operator | guide | transfer | stay | souvenir | gear | cars | restaurant)
- description
- contact (JSONB) ‚Äî phone, email, telegram, whatsapp
- rating, review_count
- is_verified
- logo_asset_id
```

**tours** ‚Äî –¢—É—Ä—ã
```sql
- id (UUID)
- name, description, short_description
- difficulty (easy | medium | hard)
- duration (—á–∞—Å—ã)
- price, currency (RUB)
- season (JSONB –º–∞—Å—Å–∏–≤)
- coordinates (JSONB –º–∞—Å—Å–∏–≤ —Ç–æ—á–µ–∫ –º–∞—Ä—à—Ä—É—Ç–∞)
- requirements, included, not_included (JSONB)
- operator_id, guide_id (FK)
- max_group_size, min_group_size
- rating, review_count
- is_active
```

**bookings** ‚Äî –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```sql
- id (UUID)
- user_id, tour_id (FK)
- date, participants
- total_price
- status (pending | confirmed | cancelled | completed)
- payment_status (pending | paid | refunded)
- special_requests
```

**assets** ‚Äî –ú–µ–¥–∏–∞ —Ñ–∞–π–ª—ã
```sql
- id (UUID)
- url, mime_type
- sha256 (UNIQUE) ‚Äî –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è
- size, width, height
- alt
```

**–°–≤—è–∑—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã:**
- `tour_assets` ‚Äî —Å–≤—è–∑–∏ —Ç—É—Ä–æ–≤ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
- `partner_assets` ‚Äî —Å–≤—è–∑–∏ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤ –∏ –ª–æ–≥–æ—Ç–∏–ø–æ–≤

#### **–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤**

**transfer_routes** ‚Äî –ú–∞—Ä—à—Ä—É—Ç—ã
```sql
- id (UUID)
- name, from_location, to_location
- from_coordinates, to_coordinates (POINT, PostGIS)
- distance_km, estimated_duration_minutes
- is_active
```

**transfer_vehicles** ‚Äî –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç
```sql
- id (UUID)
- operator_id (FK)
- vehicle_type (economy | comfort | business | minibus | bus)
- make, model, year
- capacity
- features (TEXT[]) ‚Äî wifi, air_conditioning, child_seat...
- license_plate (UNIQUE)
```

**transfer_trips** ‚Äî –†–µ–π—Å—ã
```sql
- id (UUID)
- route_id, vehicle_id (FK)
- departure_time, arrival_time
- available_seats, total_seats
- price_per_seat
- is_cancelled
```

**seat_holds** ‚Äî –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –º–µ—Å—Ç
```sql
- id (UUID)
- trip_id (FK)
- seat_numbers (INTEGER[])
- expires_at ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞
- user_id (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

**transfer_bookings** ‚Äî –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
```sql
- id (UUID)
- trip_id, user_id
- seats (INTEGER[])
- total_price
- status (pending | confirmed | cancelled)
- payment_status
- ticket_qr_code
```

#### **–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**

**loyalty_levels** ‚Äî –£—Ä–æ–≤–Ω–∏
```sql
- id (UUID)
- name, description
- min_points_required
- benefits (JSONB)
```

**user_loyalty** ‚Äî –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
```sql
- user_id (FK, UNIQUE)
- total_points
- current_level_id
- last_activity_at
```

**loyalty_transactions** ‚Äî –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±–∞–ª–ª–æ–≤
```sql
- id (UUID)
- user_id (FK)
- points (–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ/–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ)
- source_type, source_id
- description
```

**promo_codes** ‚Äî –ü—Ä–æ–º–æ–∫–æ–¥—ã
```sql
- id (UUID)
- code (UNIQUE)
- discount_type (percentage | fixed)
- discount_value
- min_purchase_amount
- max_uses, current_uses
- expires_at
```

#### **–†–∞—Å—à–∏—Ä–µ–Ω–∏—è PostgreSQL**
- `uuid-ossp` ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è UUID
- `postgis` ‚Äî –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (GIST)

#### **–ò–Ω–¥–µ–∫—Å—ã**
- –ü–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º (GIST –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è PostGIS)
- –ü–æ –≤–Ω–µ—à–Ω–∏–º –∫–ª—é—á–∞–º
- –ü–æ —Å—Ç–∞—Ç—É—Å–∞–º (is_active, status)
- –ü–æ –¥–∞—Ç–∞–º (created_at, updated_at)

---

### **3. React Components**

#### **AIChatWidget.tsx**
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç —Å AI-–≥–∏–¥–æ–º
- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π
- Streaming –æ—Ç–≤–µ—Ç—ã
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### **TourCard.tsx**
- –ö–∞—Ä—Ç–æ—á–∫–∞ —Ç—É—Ä–∞ —Å Floating UI
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ä–µ–π—Ç–∏–Ω–≥, —Ü–µ–Ω–∞
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (popover, tooltips)
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω

#### **WeatherWidget.tsx**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –ø–æ–≥–æ–¥—ã
- –ü—Ä–æ–≥–Ω–æ–∑ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ –¥–Ω–µ–π
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Open-Meteo API

#### **EcoPointsWidget.tsx**
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç–∫–æ-–±–∞–ª–ª–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –ë–ª–∏–∂–∞–π—à–∏–µ —Ç–æ—á–∫–∏ —ç–∫–æ-–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–≥—Ä–µ—Å—Å —É—Ä–æ–≤–Ω–µ–π
- –ê—á–∏–≤–∫–∏

#### **TransferSearchWidget.tsx**
- –ü–æ–∏—Å–∫ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
- –í—ã–±–æ—Ä –¥–∞—Ç—ã –∏ –º–∞—Ä—à—Ä—É—Ç–∞
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–µ—Å—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞—Ä—Ç–æ–π

#### **TransferMap.tsx**
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—Ç–∞ (Yandex Maps)
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –¢–æ—á–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è/–ø—Ä–∏–±—ã—Ç–∏—è
- –ì–µ–æ–ª–æ–∫–∞—Ü–∏—è

#### **LoyaltyWidget.tsx**
- –¢–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
- –ë–∞–ª–ª—ã –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å
- –î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã
- –ò—Å—Ç–æ—Ä–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

#### **Protected.tsx**
- HOC –¥–ª—è –∑–∞—â–∏—Ç—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π
- –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö

---

### **4. Context Providers**

#### **RoleContext.tsx**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- –†–æ–ª–∏: `traveler`, `operator`, `guide`, `transfer`, `agent`, `admin`
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

#### **AuthContext.tsx**
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- JWT —Ç–æ–∫–µ–Ω—ã
- –°–µ—Å—Å–∏–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

#### **OrdersContext.tsx**
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏
- –°–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
- –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

---

### **5. –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã**

#### **lib/config.ts**
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (URL, SSL, –ø—É–ª—ã)
- AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã (GROQ, DeepSeek, OpenRouter)
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (JWT, –ø–∞—Ä–æ–ª–∏)
- –§–∞–π–ª—ã (—Ä–∞–∑–º–µ—Ä—ã, —Ç–∏–ø—ã, CDN)
- –ö–∞—Ä—Ç—ã (Yandex)
- –ü–æ–≥–æ–¥–∞ (Open-Meteo, Yandex)
- –ü–ª–∞—Ç–µ–∂–∏ (Yandex, Stripe)
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (Email, SMS, Telegram)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (Redis)
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry, Prometheus)
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (CORS, rate limit, CSP)

**–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
```typescript
validateConfig() ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
getClientConfig() ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω—ã–π —ç–∫—Å–ø–æ—Ä—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞
```

#### **lib/database.ts**
–†–∞–±–æ—Ç–∞ —Å PostgreSQL:
- `query<T>()` ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `transaction<T>()` ‚Äî —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- `testConnection()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- `getTableInfo()` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü
- `getTableStats()` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤
- `createIndexes()` ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
- `cleanupOldData()` ‚Äî –æ—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- `getPerformanceMetrics()` ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- `getActiveConnections()` ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- `checkDataIntegrity()` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- `exportData()` / `importData()` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç

**Connection Pooling:**
- –ú–∞–∫—Å–∏–º—É–º 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –¢–∞–π–º–∞—É—Ç 2 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
- Idle timeout 30 —Å–µ–∫—É–Ω–¥
- SSL –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ

#### **lib/transfers/booking.ts**
–õ–æ–≥–∏–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –º–µ—Å—Ç
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–∞ –≤—Ä–µ–º—è (seat_holds)
- –í–∞–ª–∏–¥–∞—Ü–∏—è –±–∏–ª–µ—Ç–æ–≤
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤

#### **lib/transfers/matching.ts**
–ü–æ–¥–±–æ—Ä —Ä–µ–π—Å–æ–≤:
- –ì–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã–π –ø–æ–∏—Å–∫ (PostGIS)
- –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ, –≤—Ä–µ–º–µ–Ω–∏
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –º–µ—Å—Ç
- –†–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

#### **lib/payments/cloudpayments-webhook.ts**
–û–±—Ä–∞–±–æ—Ç–∫–∞ webhook'–æ–≤ CloudPayments:
- –í–∞–ª–∏–¥–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏ HMAC
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –ø–ª–∞—Ç–µ–∂–µ–π
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

#### **lib/loyalty/loyalty-system.ts**
–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏:
- –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –±–∞–ª–ª–æ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω–µ–π
- –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

#### **lib/middleware/**
- `csrf.ts` ‚Äî –∑–∞—â–∏—Ç–∞ –æ—Ç CSRF
- `rate-limit.ts` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
- `validation.ts` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

#### **lib/notifications/**
- `email.ts` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ email (Nodemailer)
- `sms.ts` ‚Äî SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (SMS.ru)
- `telegram.ts` ‚Äî Telegram –±–æ—Ç—ã

---

## üé® –î–ò–ó–ê–ô–ù –ò UI

### **–¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞**
- **–û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω:** –ü—Ä–µ–º–∏—É–º —á–µ—Ä–Ω—ã–π (#000000)
- **–ê–∫—Ü–µ–Ω—Ç:** –ó–æ–ª–æ—Ç–æ–π (#FFD700)
- **–ì—Ä–∞–¥–∏–µ–Ω—Ç—ã:** –ß–µ—Ä–Ω–æ-–∑–æ–ª–æ—Ç—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
- **–¢–µ–∫—Å—Ç:** –ë–µ–ª—ã–π –Ω–∞ —á–µ—Ä–Ω–æ–º —Ñ–æ–Ω–µ

### **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã UI**
- **Floating UI** ‚Äî popover, tooltips, dropdowns
- **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω** ‚Äî mobile-first
- **–ê–Ω–∏–º–∞—Ü–∏–∏** ‚Äî –ø–ª–∞–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã
- **–ò–∫–æ–Ω–∫–∏** ‚Äî SVG inline

### **–°—Ç–∏–ª–∏**
- **TailwindCSS** –¥–ª—è —É—Ç–∏–ª–∏—Ç–∞—Ä–Ω—ã—Ö –∫–ª–∞—Å—Å–æ–≤
- **globals.css** ‚Äî –∫–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
- **ui-improvements.css** ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

---

## üîê –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

1. **Middleware (middleware.ts)**
   - Security headers (X-Content-Type-Options, X-Frame-Options)
   - CSP (Content Security Policy)
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `/api/*`

2. **CSRF –∑–∞—â–∏—Ç–∞**
   - –¢–æ–∫–µ–Ω—ã CSRF
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ middleware

3. **Rate Limiting**
   - 100 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 15 –º–∏–Ω—É—Ç —Å –æ–¥–Ω–æ–≥–æ IP
   - –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ `lib/middleware/rate-limit.ts`

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö**
   - Zod —Å—Ö–µ–º—ã
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript
   - SQL –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–∑–∞—â–∏—Ç–∞ –æ—Ç –∏–Ω—ä–µ–∫—Ü–∏–π)

5. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
   - JWT —Ç–æ–∫–µ–Ω—ã
   - –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ (7 –¥–Ω–µ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
   - Refresh —Ç–æ–∫–µ–Ω—ã (30 –¥–Ω–µ–π)

6. **–†–æ–ª–∏ –∏ –ø—Ä–∞–≤–∞**
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–µ–π –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
   - Protected –º–∞—Ä—à—Ä—É—Ç—ã

### **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

‚ö†Ô∏è **TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –Ω–∞–π–¥–µ–Ω—ã:**
- `app/api/transfers/book/route.ts:104` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ userId –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞

‚ö†Ô∏è **Sentry –Ω–∞—Å—Ç—Ä–æ–π–∫–∞**
- –û—Ç–∫–ª—é—á–µ–Ω–∞ –≤ production build –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫

---

## üìä –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**

1. **Next.js**
   - React Strict Mode
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (unoptimized –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏)
   - –£–¥–∞–ª–µ–Ω–∏–µ console.log –≤ production
   - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ Sentry –≤ build (—É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞)

2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**
   - Connection pooling (–º–∞–∫—Å. 20)
   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ –∫–ª—é—á–µ–≤—ã—Ö –ø–æ–ª—è—Ö
   - PostGIS –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö
   - –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

3. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Redis –ø–æ–¥–¥–µ—Ä–∂–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
   - TTL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 1 —á–∞—Å
   - –ö—ç—à –ø–æ–≥–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (30 –º–∏–Ω—É—Ç)

4. **Edge Runtime**
   - AI endpoints –Ω–∞ Edge (–≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ)
   - Node.js runtime –¥–ª—è —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏

### **–ú–µ—Ç—Ä–∏–∫–∏**

- –†–∞–∑–º–µ—Ä –±–∞–Ω–¥–ª–∞: –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω (Sentry –æ—Ç–∫–ª—é—á–µ–Ω)
- –í—Ä–µ–º—è —Å–±–æ—Ä–∫–∏: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –¥–ª—è Next.js
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ë–î: –º–µ—Ç—Ä–∏–∫–∏ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `getPerformanceMetrics()`

---

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### **–ù–∞—Å—Ç—Ä–æ–µ–Ω–æ**

- **Vitest 3.2.4** ‚Äî test runner
- **@testing-library/react** ‚Äî —Ç–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **@testing-library/jest-dom** ‚Äî –º–∞—Ç—á–µ—Ä—ã
- **jsdom** ‚Äî DOM –æ–∫—Ä—É–∂–µ–Ω–∏–µ

### **–¢–µ—Å—Ç—ã –Ω–∞–π–¥–µ–Ω—ã**

1. `test/booking-race-condition.test.ts` ‚Äî race conditions –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
2. `test/webhook-validation.test.ts` ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è webhook'–æ–≤
3. `test/api/loyalty.test.ts` ‚Äî API –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏
4. `test/api/transfers.test.ts` ‚Äî API —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤

### **–°–∫—Ä–∏–ø—Ç—ã**

```bash
npm test              # –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
npm run test:ui        # UI —Ä–µ–∂–∏–º
npm run test:coverage # –ü–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
npm run test:run      # –û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –∑–∞–ø—É—Å–∫
```

‚ö†Ô∏è **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–ª–∞—Ç–µ–∂–∏)

---

## üöÄ –î–ï–ü–õ–û–ô –ò –ò–ù–§–†–ê–°–¢–†–£–ö–¢–£–†–ê

### **Docker**

**docker-compose.yml:**
- PostgreSQL 15 —Å PostGIS
- Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- Health checks
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

**Dockerfile:**
- Multi-stage build
- Node.js 20 Alpine
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞
- Production —Ä–µ–∂–∏–º

### **–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã –¥–µ–ø–ª–æ—è**

1. **Vercel** (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –∏–∑ Git
   - Edge Functions
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

2. **Timeweb Cloud Apps**
   - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –≤ `TIMEWEB_*` —Ñ–∞–π–ª–∞—Ö
   - –°–∫—Ä–∏–ø—Ç—ã –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `scripts/`
   - VDS –ø–æ–¥–¥–µ—Ä–∂–∫–∞

3. **Docker**
   - –ì–æ—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
   - –ö–æ–º–∞–Ω–¥–∞: `docker-compose up`

### **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ:**
- `DATABASE_URL` ‚Äî —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è PostgreSQL
- `JWT_SECRET` ‚Äî —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è JWT

**–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ:**
- `GROQ_API_KEY`, `DEEPSEEK_API_KEY`, `OPENROUTER_API_KEY` ‚Äî AI –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
- `YANDEX_MAPS_API_KEY` ‚Äî –∫–∞—Ä—Ç—ã
- `CLOUDPAYMENTS_PUBLIC_ID`, `CLOUDPAYMENTS_API_SECRET` ‚Äî –ø–ª–∞—Ç–µ–∂–∏
- `SENTRY_DSN` ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `TIMEWEB_ENV_VARS.md` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Timeweb
- `.env.production.example` ‚Äî –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üìö –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø

### **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞**
- **107** markdown —Ñ–∞–π–ª–æ–≤
- –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: ~500+ —Å—Ç—Ä–∞–Ω–∏—Ü

### **–û—Å–Ω–æ–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã**

#### **–°—Ç–∞—Ä—Ç–æ–≤—ã–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞**
- `README.md` ‚Äî –≥–ª–∞–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- `START_HERE.md` ‚Äî –Ω–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞
- `–ë–´–°–¢–†–´–ô_–°–¢–ê–†–¢.md` ‚Äî –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

#### **–î–µ–ø–ª–æ–π**
- `DEPLOYMENT_GUIDE.md` ‚Äî –æ–±—â–µ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
- `TIMEWEB_–î–ï–ü–õ–û–ô.md` ‚Äî –¥–µ–ø–ª–æ–π –Ω–∞ Timeweb
- `VERCEL_DEPLOYMENT_INSTRUCTIONS.md` ‚Äî Vercel
- `–î–ï–ü–õ–û–ô_–ù–ê_TIMEWEB_APPS.md` ‚Äî Cloud Apps

#### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
- `–ê–†–•–ò–¢–ï–ö–¢–£–†–ù–ê–Ø_–î–ò–ê–ì–†–ê–ú–ú–ê.md` ‚Äî –¥–∏–∞–≥—Ä–∞–º–º—ã
- `TIMEWEB_AI_ARCHITECTURE.md` ‚Äî AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- `–ê–î–ê–ü–¢–ê–¶–ò–Ø_–ü–û–î_TIMEWEB.md` ‚Äî –∞–¥–∞–ø—Ç–∞—Ü–∏—è

#### **–ê–Ω–∞–ª–∏–∑ –∏ –æ—Ç—á–µ—Ç—ã**
- `COMPREHENSIVE_WORK_ANALYSIS.md` ‚Äî –ø–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ä–∞–±–æ—Ç
- `FINAL_COMPLETION_REPORT.md` ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
- `SECURITY_SCAN_REPORT.md` ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- `KAMHUB_REPOSITORY_ANALYSIS.md` ‚Äî –∞–Ω–∞–ª–∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

#### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å**
- `TRANSFER_SYSTEM_DEEP_ANALYSIS.md` ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
- `ROLES_AND_ENTITIES_ANALYSIS.md` ‚Äî —Ä–æ–ª–∏ –∏ —Å—É—â–Ω–æ—Å—Ç–∏
- `UI_IMPROVEMENTS.md` ‚Äî —É–ª—É—á—à–µ–Ω–∏—è UI

‚ö†Ô∏è **–ü—Ä–æ–±–ª–µ–º–∞:** –ò–∑–±—ã—Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (107 —Ñ–∞–π–ª–æ–≤). –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:
- –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞
- –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
- –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏–Ω–¥–µ–∫—Å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

---

## üîß –°–ö–†–ò–ü–¢–´ –ò –ê–í–¢–û–ú–ê–¢–ò–ó–ê–¶–ò–Ø

### **npm scripts**

```json
{
  "dev": "next dev -p 3002",
  "build": "next build",
  "start": "next start -p 3000",
  "migrate": "tsx scripts/migrate.ts",
  "migrate:up": "tsx scripts/migrate.ts up",
  "migrate:down": "tsx scripts/migrate.ts down",
  "migrate:status": "tsx scripts/migrate.ts status",
  "db:test": "...",
  "db:info": "...",
  "db:stats": "...",
  "db:cleanup": "...",
  "db:integrity": "...",
  "timeweb:check": "tsx scripts/timeweb-check.ts",
  "timeweb:setup": "tsx scripts/timeweb-setup.ts",
  "timeweb:manage": "tsx scripts/timeweb-manage.ts",
  "lint": "eslint . --ext .ts,.tsx --fix",
  "format": "prettier --write .",
  "type-check": "tsc --noEmit",
  "test": "vitest",
  "test:ui": "vitest --ui",
  "test:coverage": "vitest --coverage"
}
```

### **Bash —Å–∫—Ä–∏–ø—Ç—ã**

- `deploy-kamhub.sh` ‚Äî –¥–µ–ø–ª–æ–π –Ω–∞ Vercel/Timeweb
- `deploy-timeweb.sh` ‚Äî –¥–µ–ø–ª–æ–π –Ω–∞ Timeweb
- `timeweb-vds-install.sh` ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ VDS
- `auto-deploy-kamchatour.sh` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
- `scripts/setup-postgresql.sh` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL
- `scripts/backup-db.sh` ‚Äî –±—ç–∫–∞–ø –ë–î
- `scripts/restore-db.sh` ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ë–î

### **TypeScript —Å–∫—Ä–∏–ø—Ç—ã**

- `scripts/migrate.ts` ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
- `scripts/timeweb-setup.ts` ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Timeweb
- `scripts/timeweb-check.ts` ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ Timeweb API
- `scripts/timeweb-manage.ts` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–æ–º

---

## üéØ –§–£–ù–ö–¶–ò–û–ù–ê–õ–¨–ù–û–°–¢–¨

### **‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

1. **–¢—É—Ä—ã**
   - –ö–∞—Ç–∞–ª–æ–≥ —Ç—É—Ä–æ–≤
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫
   - –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

2. **–ü–∞—Ä—Ç–Ω–µ—Ä—ã**
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
   - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (operator, guide, transfer, stay...)
   - –†–µ–π—Ç–∏–Ω–≥–∏ –∏ –æ—Ç–∑—ã–≤—ã
   - –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è

3. **AI-–≥–∏–¥**
   - –ö–æ–Ω—Å–µ–Ω—Å—É—Å –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
   - –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–≥–æ–¥–æ–π
   - –ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞

4. **–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤**
   - –ü–æ–∏—Å–∫ —Ä–µ–π—Å–æ–≤ –ø–æ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–µ—Å—Ç –Ω–∞ –≤—Ä–µ–º—è
   - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–ø–ª–∞—Ç–∞
   - QR-–∫–æ–¥—ã –¥–ª—è –±–∏–ª–µ—Ç–æ–≤
   - –î–∞—à–±–æ—Ä–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

5. **–ü—Ä–æ–≥—Ä–∞–º–º–∞ –ª–æ—è–ª—å–Ω–æ—Å—Ç–∏**
   - –ë–∞–ª–ª—ã –∑–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
   - –£—Ä–æ–≤–Ω–∏ (L1, L2, L3)
   - –ü—Ä–æ–º–æ–∫–æ–¥—ã
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

6. **–≠–∫–æ-—Å–∏—Å—Ç–µ–º–∞**
   - –≠–∫–æ-–±–∞–ª–ª—ã –∑–∞ –±–µ—Ä–µ–∂–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ
   - –ë–ª–∏–∂–∞–π—à–∏–µ —Ç–æ—á–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
   - –ê—á–∏–≤–∫–∏

7. **–ü–ª–∞—Ç–µ–∂–∏**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è CloudPayments
   - Webhook –æ–±—Ä–∞–±–æ—Ç–∫–∞
   - –í–æ–∑–≤—Ä–∞—Ç—ã
   - –ò–Ω–≤–æ–π—Å—ã

8. **CRM –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤**
   - –î–∞—à–±–æ—Ä–¥ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—É—Ä–∞–º–∏
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
   - –û—Ç—á–µ—Ç—ã

9. **–ü–æ–≥–æ–¥–∞**
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Open-Meteo
   - –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
   - –ü—Ä–æ–≥–Ω–æ–∑

10. **–ö–∞—Ä—Ç—ã**
    - Yandex Maps –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
    - –ì–µ–æ–∫–æ–¥–∏–Ω–≥
    - –ú–∞—Ä—à—Ä—É—Ç—ã

### **‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**

1. **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**
   - –î–µ–º–æ-—Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç–∞–µ—Ç
   - –ü–æ–ª–Ω–∞—è JWT –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
   - TODO: –ø–æ–ª—É—á–µ–Ω–∏–µ userId –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞

2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (SMTP, SMS.ru, Telegram)

3. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - Sentry –æ—Ç–∫–ª—é—á–µ–Ω –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ production

---

## üêõ –ò–ó–í–ï–°–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### **TODO –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏**

1. `app/api/transfers/book/route.ts:104`
   ```typescript
   userId: 'user_123', // TODO: –ø–æ–ª—É—á–∞—Ç—å –∏–∑ JWT —Ç–æ–∫–µ–Ω–∞
   ```

### **–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã**

1. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - 107 markdown —Ñ–∞–π–ª–æ–≤ (–∏–∑–±—ã—Ç–æ—á–Ω–æ)
   - –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ñ–∞–π–ª—ã —É—Å—Ç–∞—Ä–µ–ª–∏

2. **–¢–µ—Å—Ç—ã**
   - –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
   - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–ª–∞—Ç–µ–∂–∏) —Ç—Ä–µ–±—É—é—Ç –±–æ–ª—å—à–µ —Ç–µ—Å—Ç–æ–≤

3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
   - Sentry –æ—Ç–∫–ª—é—á–µ–Ω (–Ω–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –æ—à–∏–±–æ–∫ –≤ production)
   - CSRF –∑–∞—â–∏—Ç–∞ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö

4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è unoptimized (—É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä)
   - –ù–µ—Ç CDN –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

## üìà –ú–ï–¢–†–ò–ö–ò –ü–†–û–ï–ö–¢–ê

### **–†–∞–∑–º–µ—Ä –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã**
- **90** TypeScript/TSX —Ñ–∞–π–ª–æ–≤
- **~20,000** —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ (–±–µ–∑ node_modules)
- **62** –º–æ–¥—É–ª—è —Å —ç–∫—Å–ø–æ—Ä—Ç–∞–º–∏
- **6** SQL —Å—Ö–µ–º (19,888 —Å—Ç—Ä–æ–∫)
- **25+** API endpoints
- **11** React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- **3** Context providers
- **14** —Å–∫—Ä–∏–ø—Ç–æ–≤ —É—Ç–∏–ª–∏—Ç
- **5** —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

### **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**

**Production (13):**
- next, react, react-dom
- pg (PostgreSQL)
- zod (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
- nodemailer (email)
- @floating-ui/* (UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- clsx, tailwind-merge (—É—Ç–∏–ª–∏—Ç—ã)

**Development (18):**
- typescript, @types/*
- eslint, prettier
- vitest, @testing-library/*
- tailwindcss, postcss, autoprefixer
- tsx (TypeScript execution)

**–†–∞–∑–º–µ—Ä node_modules:** —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è Next.js –ø—Ä–æ–µ–∫—Ç–∞ (~500MB)

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ**

1. **–î–æ—Ä–∞–±–æ—Ç–∞—Ç—å JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é**
   - –ü–æ–ª—É—á–µ–Ω–∏–µ userId –∏–∑ —Ç–æ–∫–µ–Ω–∞ –≤ API
   - –ó–∞—â–∏—Ç–∞ –≤—Å–µ—Ö –∑–∞—â–∏—â–µ–Ω–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

2. **–£–≤–µ–ª–∏—á–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**
   - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (race conditions)
   - –ü–ª–∞—Ç–µ–∂–∏ (webhook –≤–∞–ª–∏–¥–∞—Ü–∏—è)
   - –¢—Ä–∞–Ω—Å—Ñ–µ—Ä—ã (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–µ—Å—Ç)

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**
   - –í–∫–ª—é—á–∏—Ç—å Sentry –≤ production
   - –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
   - –ê–ª–µ—Ä—Ç—ã

### **–í–∞–∂–Ω—ã–µ**

4. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é**
   - –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è —Ñ–∞–π–ª—ã
   - –£–¥–∞–ª–∏—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
   - –°–æ–∑–¥–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏–Ω–¥–µ–∫—Å

5. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è**
   - –í–∫–ª—é—á–∏—Ç—å Next.js Image Optimization
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CDN
   - Lazy loading

6. **–†–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç—ã**
   - E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø–æ—Ç–æ–∫–æ–≤
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã API
   - –¢–µ—Å—Ç—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω—ã–µ**

7. **–£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ API responses
   - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è SQL –∑–∞–ø—Ä–æ—Å–æ–≤
   - Code splitting

8. **–£–ª—É—á—à–∏—Ç—å UX**
   - Loading states –≤–µ–∑–¥–µ
   - Error boundaries
   - Offline –ø–æ–¥–¥–µ—Ä–∂–∫–∞

9. **CI/CD**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã –Ω–∞ PR
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
   - Linting –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìù –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

**Kamchatour Hub** ‚Äî –∑—Ä–µ–ª—ã–π full-stack –ø—Ä–æ–µ–∫—Ç —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –∏ –±–æ–≥–∞—Ç—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º. –ü—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∞–º–∏:

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Å—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
- ‚úÖ –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å—Ñ–µ—Ä–æ–≤
- ‚úÖ AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–¥–∞
- ‚úÖ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
- ‚úÖ –û–±—à–∏—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è:**
- ‚ö†Ô∏è JWT –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏
- ‚ö†Ô∏è –ù–∏–∑–∫–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- ‚ö†Ô∏è –ò–∑–±—ã—Ç–æ—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è (107 —Ñ–∞–π–ª–æ–≤)
- ‚ö†Ô∏è –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ production

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞:** **8/10** ‚Äî –û—Ç–ª–∏—á–Ω—ã–π –ø—Ä–æ–µ–∫—Ç, –≥–æ—Ç–æ–≤—ã–π –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É –ø–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–º–µ—á–∞–Ω–∏–π.

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞:** 2025-01-27  
**–í–µ—Ä—Å–∏—è –∞–Ω–∞–ª–∏–∑–∞:** 1.0  
**–ê–≤—Ç–æ—Ä:** AI Assistant
