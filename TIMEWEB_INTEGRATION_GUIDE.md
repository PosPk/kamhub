# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ KamchaTour Hub —Å Timeweb Cloud

## üéØ –¶–µ–ª—å

–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ KamchaTour Hub –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Timeweb Cloud —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫ DevOps.

## üìã –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    Timeweb Cloud Infrastructure              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                               ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ
‚îÇ  ‚îÇ   VDS/VPS   ‚îÇ      ‚îÇ  PostgreSQL  ‚îÇ     ‚îÇ   S3 Bucket ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  (Next.js)  ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∂‚îÇ   (DBaaS)    ‚îÇ     ‚îÇ   (Files)   ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  Node.js    ‚îÇ      ‚îÇ              ‚îÇ     ‚îÇ             ‚îÇ ‚îÇ
‚îÇ  ‚îÇ  PM2        ‚îÇ      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                            ‚îÇ
‚îÇ        ‚îÇ                                                     ‚îÇ
‚îÇ        ‚ñº                                                     ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                     ‚îÇ
‚îÇ  ‚îÇ  Firewall   ‚îÇ      ‚îÇ     SSL      ‚îÇ                     ‚îÇ
‚îÇ  ‚îÇ   Rules     ‚îÇ      ‚îÇ Let's Encrypt‚îÇ                     ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                     ‚îÇ
‚îÇ                                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üöÄ –ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

#### 1.1 –°–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞
```bash
# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://timeweb.cloud
# –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email
# –ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å
```

#### 1.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CLI (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Timeweb Cloud CLI
curl -s https://timeweb.cloud/install-cli.sh | bash

# –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
twc auth login

# –ü—Ä–æ–≤–µ—Ä–∫–∞
twc account info
```

### –≠—Ç–∞–ø 2: –°–æ–∑–¥–∞–Ω–∏–µ VDS —Å–µ—Ä–≤–µ—Ä–∞

#### 2.1 –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–î–ª—è production:**
- **OS:** Ubuntu 22.04 LTS
- **CPU:** 2-4 vCPU
- **RAM:** 4-8 GB
- **SSD:** 40-80 GB
- **–¢–∞—Ä–∏—Ñ:** E-Commerce VDS –∏–ª–∏ –û–±–ª–∞—á–Ω—ã–π VDS
- **–†–µ–≥–∏–æ–Ω:** –†–æ—Å—Å–∏—è (–¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è 152-–§–ó)

**–î–ª—è development:**
- **OS:** Ubuntu 22.04 LTS
- **CPU:** 1-2 vCPU
- **RAM:** 2-4 GB
- **SSD:** 20-40 GB

#### 2.2 –°–æ–∑–¥–∞–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å
1. –í–æ–π—Ç–∏ –≤ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–°–µ—Ä–≤–µ—Ä—ã"
3. –ù–∞–∂–∞—Ç—å "–°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä"
4. –í—ã–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
5. –£–∫–∞–∑–∞—Ç—å SSH –∫–ª—é—á –∏–ª–∏ –ø–∞—Ä–æ–ª—å
6. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–µ—Ä

#### 2.3 –ü–µ—Ä–≤–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É
ssh root@YOUR_SERVER_IP

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
apt update && apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
apt install -y curl wget git build-essential ufw

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall
ufw allow 22/tcp
ufw allow 80/tcp
ufw allow 443/tcp
ufw enable

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
adduser kamchatour
usermod -aG sudo kamchatour

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
# –û—Ç–∫–ª—é—á–∏—Ç—å –≤—Ö–æ–¥ –ø–æ –ø–∞—Ä–æ–ª—é, –æ—Å—Ç–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏
```

### –≠—Ç–∞–ø 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è Node.js

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 20.x (LTS)
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏
node --version
npm --version

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2 (–º–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ–≤)
npm install -g pm2

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ pnpm (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
npm install -g pnpm
```

### –≠—Ç–∞–ø 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL (DBaaS)

#### 4.1 –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ "–ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –∏–Ω—Å—Ç–∞–Ω—Å PostgreSQL
3. –í—ã–±—Ä–∞—Ç—å –≤–µ—Ä—Å–∏—é (PostgreSQL 15+)
4. –í—ã–±—Ä–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
5. –ó–∞–ø–∏—Å–∞—Ç—å credentials

#### 4.2 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```env
# .env.production
DATABASE_URL="postgresql://username:password@db-host.timeweb.cloud:5432/kamchatour?sslmode=require"
```

#### 4.3 –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π
```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ –∏–ª–∏ –≤ CI/CD
npx prisma migrate deploy

# –ò–ª–∏ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –¥—Ä—É–≥–æ–π ORM
npm run db:migrate
```

### –≠—Ç–∞–ø 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ S3 Object Storage

#### 5.1 –°–æ–∑–¥–∞–Ω–∏–µ bucket
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ "S3 Storage"
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π bucket
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
4. –ü–æ–ª—É—á–∏—Ç—å Access Key –∏ Secret Key

#### 5.2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è S3 –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```typescript
// lib/s3-client.ts
import { S3Client } from '@aws-sdk/client-s3';

export const s3Client = new S3Client({
  region: 'ru-1', // –†–µ–≥–∏–æ–Ω Timeweb Cloud
  endpoint: 'https://s3.timeweb.cloud',
  credentials: {
    accessKeyId: process.env.S3_ACCESS_KEY_ID!,
    secretAccessKey: process.env.S3_SECRET_ACCESS_KEY!,
  },
  forcePathStyle: true, // –í–∞–∂–Ω–æ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
});

export const S3_BUCKET_NAME = process.env.S3_BUCKET_NAME!;
```

#### 5.3 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
S3_ACCESS_KEY_ID=your_access_key
S3_SECRET_ACCESS_KEY=your_secret_key
S3_BUCKET_NAME=kamchatour-media
S3_ENDPOINT=https://s3.timeweb.cloud
S3_REGION=ru-1
```

### –≠—Ç–∞–ø 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

#### 6.1 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
apt install -y certbot python3-certbot-nginx

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
certbot certonly --standalone -d kamchatour.ru -d www.kamchatour.ru

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
certbot renew --dry-run
```

#### 6.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx –∫–∞–∫ reverse proxy
```nginx
# /etc/nginx/sites-available/kamchatour
server {
    listen 80;
    server_name kamchatour.ru www.kamchatour.ru;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name kamchatour.ru www.kamchatour.ru;

    ssl_certificate /etc/letsencrypt/live/kamchatour.ru/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/kamchatour.ru/privkey.pem;

    # SSL –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ Next.js
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }

    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏
    location /_next/static {
        proxy_pass http://localhost:3000;
        proxy_cache_valid 60m;
    }
}
```

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
ln -s /etc/nginx/sites-available/kamchatour /etc/nginx/sites-enabled/
nginx -t
systemctl restart nginx
```

### –≠—Ç–∞–ø 7: –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

#### 7.1 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
su - kamchatour

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/your-username/kamchatour-hub.git
cd kamchatour-hub

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm install
```

#### 7.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –°–æ–∑–¥–∞—Ç—å .env.production
nano .env.production
```

```env
# .env.production
NODE_ENV=production
PORT=3000

# Database
DATABASE_URL="postgresql://username:password@db-host.timeweb.cloud:5432/kamchatour?sslmode=require"

# S3 Storage
S3_ACCESS_KEY_ID=your_access_key
S3_SECRET_ACCESS_KEY=your_secret_key
S3_BUCKET_NAME=kamchatour-media
S3_ENDPOINT=https://s3.timeweb.cloud
S3_REGION=ru-1

# Auth (NextAuth.js)
NEXTAUTH_URL=https://kamchatour.ru
NEXTAUTH_SECRET=your_secret_here

# Telegram Bot
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_WEBHOOK_URL=https://kamchatour.ru/api/telegram/webhook

# Yandex Maps
YANDEX_MAPS_API_KEY=your_api_key

# Payment (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
PAYMENT_API_KEY=your_payment_key

# Monitoring
SENTRY_DSN=your_sentry_dsn
```

#### 7.3 –°–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
# –°–±–æ—Ä–∫–∞ Next.js
npm run build

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–±–æ—Ä–∫–∏
ls -la .next/
```

#### 7.4 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PM2
```bash
# –°–æ–∑–¥–∞—Ç—å ecosystem —Ñ–∞–π–ª
nano ecosystem.config.js
```

```javascript
// ecosystem.config.js
module.exports = {
  apps: [{
    name: 'kamchatour-hub',
    script: 'npm',
    args: 'start',
    cwd: '/home/kamchatour/kamchatour-hub',
    instances: 2,
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: 'logs/err.log',
    out_file: 'logs/out.log',
    log_file: 'logs/combined.log',
    time: true
  }]
};
```

```bash
# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 start ecosystem.config.js

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
pm2 status

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
pm2 logs kamchatour-hub

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
pm2 startup
pm2 save
```

### –≠—Ç–∞–ø 8: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall –≤ Timeweb Cloud

#### 8.1 –ß–µ—Ä–µ–∑ –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
1. –ü–µ—Ä–µ–π—Ç–∏ –≤ "Firewall"
2. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É –ø—Ä–∞–≤–∏–ª
3. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞:
   - **HTTP:** TCP, –ø–æ—Ä—Ç 80, –∏—Å—Ç–æ—á–Ω–∏–∫ 0.0.0.0/0
   - **HTTPS:** TCP, –ø–æ—Ä—Ç 443, –∏—Å—Ç–æ—á–Ω–∏–∫ 0.0.0.0/0
   - **SSH:** TCP, –ø–æ—Ä—Ç 22, –∏—Å—Ç–æ—á–Ω–∏–∫ YOUR_IP/32 (–æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø)
   - **PostgreSQL:** TCP, –ø–æ—Ä—Ç 5432, —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è —Å–µ—Ç—å
4. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ —Å–µ—Ä–≤–µ—Ä—É

#### 8.2 –ß–µ—Ä–µ–∑ CLI (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∞–≤–∏–ª —Ñ–∞–π—Ä–≤–æ–ª–∞
twc firewall create --name kamchatour-fw
twc firewall rule add --firewall kamchatour-fw --protocol tcp --port 80 --source 0.0.0.0/0
twc firewall rule add --firewall kamchatour-fw --protocol tcp --port 443 --source 0.0.0.0/0
twc firewall rule add --firewall kamchatour-fw --protocol tcp --port 22 --source YOUR_IP/32

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ —Å–µ—Ä–≤–µ—Ä—É
twc server firewall attach --server-id SERVER_ID --firewall kamchatour-fw
```

### –≠—Ç–∞–ø 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CI/CD

#### 9.1 GitHub Actions workflow

```yaml
# .github/workflows/deploy.yml
name: Deploy to Timeweb Cloud

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run tests
        run: npm test
        
      - name: Build application
        run: npm run build
        env:
          DATABASE_URL: ${{ secrets.DATABASE_URL }}
          
      - name: Deploy to server
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            cd /home/kamchatour/kamchatour-hub
            git pull origin main
            npm ci
            npm run build
            pm2 reload ecosystem.config.js
```

#### 9.2 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ GitHub
1. Settings ‚Üí Secrets and variables ‚Üí Actions
2. –î–æ–±–∞–≤–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã:
   - `SERVER_HOST` - IP –∞–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞
   - `SERVER_USER` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (kamchatour)
   - `SSH_PRIVATE_KEY` - –ø—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á
   - `DATABASE_URL` - —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

### –≠—Ç–∞–ø 10: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 10.1 PM2 –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å PM2
pm2 install pm2-logrotate
pm2 set pm2-logrotate:max_size 10M
pm2 set pm2-logrotate:retain 7

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ –∫–æ–º–∞–Ω–¥–Ω—É—é —Å—Ç—Ä–æ–∫—É
pm2 monit
```

#### 10.2 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Sentry
```typescript
// lib/sentry.ts
import * as Sentry from '@sentry/nextjs';

Sentry.init({
  dsn: process.env.SENTRY_DSN,
  environment: process.env.NODE_ENV,
  tracesSampleRate: 1.0,
});
```

#### 10.3 –õ–æ–≥–∏ Nginx
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ Nginx
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
nano /etc/logrotate.d/nginx
```

### –≠—Ç–∞–ø 11: –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 11.1 –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
```bash
# –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
nano /home/kamchatour/scripts/backup-db.sh
```

```bash
#!/bin/bash
# backup-db.sh

DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/home/kamchatour/backups"
DB_NAME="kamchatour"

# –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –±—ç–∫–∞–ø–æ–≤
mkdir -p $BACKUP_DIR

# –°–æ–∑–¥–∞—Ç—å –¥–∞–º–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
PGPASSWORD=$DB_PASSWORD pg_dump \
  -h db-host.timeweb.cloud \
  -U $DB_USER \
  -d $DB_NAME \
  > $BACKUP_DIR/db_backup_$DATE.sql

# –°–∂–∞—Ç—å –¥–∞–º–ø
gzip $BACKUP_DIR/db_backup_$DATE.sql

# –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –±—ç–∫–∞–ø—ã (—Å—Ç–∞—Ä—à–µ 7 –¥–Ω–µ–π)
find $BACKUP_DIR -name "db_backup_*.sql.gz" -mtime +7 -delete

echo "Backup completed: db_backup_$DATE.sql.gz"
```

```bash
# –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x /home/kamchatour/scripts/backup-db.sh

# –î–æ–±–∞–≤–∏—Ç—å –≤ cron (–µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 2:00)
crontab -e
# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
# 0 2 * * * /home/kamchatour/scripts/backup-db.sh
```

#### 11.2 –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ S3
```bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –±—ç–∫–∞–ø–æ–≤ –≤ S3
nano /home/kamchatour/scripts/backup-to-s3.sh
```

```bash
#!/bin/bash
# backup-to-s3.sh

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å AWS CLI
apt install -y awscli

# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å AWS CLI –¥–ª—è Timeweb S3
aws configure set aws_access_key_id $S3_ACCESS_KEY_ID
aws configure set aws_secret_access_key $S3_SECRET_ACCESS_KEY
aws configure set default.region ru-1

# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –±—ç–∫–∞–ø—ã –≤ S3
aws s3 sync /home/kamchatour/backups/ \
  s3://kamchatour-backups/ \
  --endpoint-url https://s3.timeweb.cloud
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:
- CPU usage
- Memory usage
- Disk I/O
- Network traffic
- Response time
- Error rate
- Active connections

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
1. **PM2 Plus** (–ø–ª–∞—Ç–Ω—ã–π) - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
2. **Grafana + Prometheus** - —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
3. **Timeweb Cloud Dashboard** - –±–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –ø–∞–Ω–µ–ª–∏

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- ‚úÖ SSH –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –ø–æ –∫–ª—é—á–∞–º
- ‚úÖ Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- ‚úÖ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∏–∑–Ω—É—Ç—Ä–∏ —Å–µ—Ç–∏
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –≤ –∫–æ–¥–µ, —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∫–ª—é—á–µ–Ω–æ
- ‚úÖ Rate limiting –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ CORS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üí∞ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞—Ç—Ä–∞—Ç

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
1. **–ù–∞—á–∞—Ç—å —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
   - 2 vCPU, 4 GB RAM
   - –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å –ø–æ –º–µ—Ä–µ —Ä–æ—Å—Ç–∞ –Ω–∞–≥—Ä—É–∑–∫–∏

2. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å S3 –¥–ª—è —Å—Ç–∞—Ç–∏–∫–∏**
   - –î–µ—à–µ–≤–ª–µ —á–µ–º —Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞ SSD —Å–µ—Ä–≤–µ—Ä–∞
   - –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

3. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Redis –¥–ª—è —Å–µ—Å—Å–∏–π (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   - CDN –¥–ª—è —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤**
   - –°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞—Ç—å
   - –ò–∑–±–µ–≥–∞—Ç—å overpro provisioning

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ PM2
pm2 logs kamchatour-hub --lines 100

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç—ã
netstat -tlnp | grep 3000

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
pm2 env 0
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql -h db-host.timeweb.cloud -U username -d kamchatour

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall
ufw status
```

### –ü—Ä–æ–±–ª–µ–º–∞: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
certbot certificates

# –û–±–Ω–æ–≤–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
certbot renew

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx
nginx -t
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ S3
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ S3
aws s3 ls s3://kamchatour-media/ --endpoint-url https://s3.timeweb.cloud

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ S3 client
# –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π endpoint –∏ region
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Timeweb Cloud

- **–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞ 24/7:** support@timeweb.cloud
- **Telegram:** @timeweb_support
- **–¢–µ–ª–µ—Ñ–æ–Ω:** 8 (800) 555-00-00
- **–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è:** https://timeweb.cloud
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** https://timeweb.cloud/docs

## üìù –ß–µ–∫–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –∫ production

- [ ] VDS —Å–µ—Ä–≤–µ—Ä —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] PostgreSQL (DBaaS) —Å–æ–∑–¥–∞–Ω–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω–∞
- [ ] S3 bucket —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç–æ
- [ ] PM2 –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Nginx –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–∞–∫ reverse proxy
- [ ] CI/CD pipeline –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –î–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ production —Å—Ä–µ–¥–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 2025-10-29
**–í–µ—Ä—Å–∏—è:** 1.0
