# üöÄ –ü–û–õ–ù–û–ï –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–ï KAMCHATOUR HUB

> **–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Timeweb Cloud VDS  
> **–î–∞—Ç–∞:** 2025-11-03  
> **–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
> **–í—Ä–µ–º—è –¥–µ–ø–ª–æ—è:** ~20 –º–∏–Ω—É—Ç

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
2. [–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π](#–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π-–¥–µ–ø–ª–æ–π)
3. [–†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π](#—Ä—É—á–Ω–æ–π-–¥–µ–ø–ª–æ–π)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–ø–æ—Å–ª–µ-–¥–µ–ø–ª–æ—è)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã](#–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç—ã)
6. [–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–æ–º](#—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ-—Å–∞–π—Ç–æ–º)
7. [Troubleshooting](#troubleshooting)

---

## üéØ –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–´–ï –¢–†–ï–ë–û–í–ê–ù–ò–Ø

### 1. Timeweb Cloud VDS

**–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- **CPU:** 2 —è–¥—Ä–∞
- **RAM:** 2 GB
- **Disk:** 20 GB SSD
- **OS:** Ubuntu 22.04 LTS

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ:**
- **CPU:** 4 —è–¥—Ä–∞
- **RAM:** 4 GB
- **Disk:** 40 GB SSD

### 2. –î–æ–º–µ–Ω

- –î–æ–º–µ–Ω–Ω–æ–µ –∏–º—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, `kamchatour.ru`)
- DNS –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ IP –≤–∞—à–µ–≥–æ VDS
- A-–∑–∞–ø–∏—Å—å: `@` ‚Üí `IP —Å–µ—Ä–≤–µ—Ä–∞`
- A-–∑–∞–ø–∏—Å—å: `www` ‚Üí `IP —Å–µ—Ä–≤–µ—Ä–∞`

### 3. Database (—É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)

- ‚úÖ PostgreSQL 18.0 –Ω–∞ Timeweb Cloud
- ‚úÖ Database URL: `postgresql://gen_user:***@51e6e5ca5d967b8e81fc9b75.twc1.net:5432/default_db`
- ‚úÖ 30+ —Ç–∞–±–ª–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã

### 4. API –ö–ª—é—á–∏ (–Ω—É–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å)

- [ ] GROQ API Key (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- [ ] CloudPayments (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
- [ ] Yandex Maps API (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
- [ ] SMTP credentials (Gmail/Yandex)
- [ ] SMS.ru API ID (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] Telegram Bot Token (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

---

## üöÄ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –î–ï–ü–õ–û–ô

### –í–∞—Ä–∏–∞–Ω—Ç 1: –û–¥–∏–Ω —Å–∫—Ä–∏–ø—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ VDS
ssh root@your-server-ip

# 2. –°–∫–∞—á–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
git clone https://github.com/your-repo/kamchatour-hub.git
cd kamchatour-hub

# 3. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω –≤ —Å–∫—Ä–∏–ø—Ç–µ
nano deploy-production.sh
# –ò–∑–º–µ–Ω–∏—Ç—å: DOMAIN="your-domain.com"

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –¥–µ–ø–ª–æ–π
chmod +x deploy-production.sh
sudo bash deploy-production.sh
```

**–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Node.js 20
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç PM2, Nginx, PostgreSQL client
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Certbot (Let's Encrypt SSL)
- ‚úÖ –°–∫–æ–ø–∏—Ä—É–µ—Ç –∫–æ–¥ –≤ `/var/www/kamchatour-hub`
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç `.env.production`
- ‚úÖ –°–æ–±–µ—Ä–µ—Ç Next.js –ø—Ä–æ–µ–∫—Ç
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç PM2 (cluster mode, 2 instances)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç Nginx (reverse proxy, gzip, SSL)
- ‚úÖ –ü–æ–ª—É—á–∏—Ç SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç firewall (UFW)
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç cron jobs (cleanup, backup)
- ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~15-20 –º–∏–Ω—É—Ç

---

## üìù –†–£–ß–ù–û–ô –î–ï–ü–õ–û–ô

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
# SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@your-server-ip

# –ò–ª–∏ —á–µ—Ä–µ–∑ Timeweb Cloud –ø–∞–Ω–µ–ª—å
# https://timeweb.cloud/my/servers
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js

```bash
# –î–æ–±–∞–≤–ª—è–µ–º NodeSource —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º Node.js
sudo apt install -y nodejs

# –ü—Ä–æ–≤–µ—Ä–∫–∞
node -v  # v20.x.x
npm -v   # 10.x.x
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2

```bash
# –ì–ª–æ–±–∞–ª—å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
sudo npm install -g pm2

# –ü—Ä–æ–≤–µ—Ä–∫–∞
pm2 -v
```

### –®–∞–≥ 4: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo apt update
sudo apt install -y nginx

# –ó–∞–ø—É—Å–∫
sudo systemctl start nginx
sudo systemctl enable nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo systemctl status nginx
```

### –®–∞–≥ 5: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot (SSL)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
sudo apt install -y certbot python3-certbot-nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞
certbot --version
```

### –®–∞–≥ 6: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
sudo mkdir -p /var/www/kamchatour-hub
cd /var/www/kamchatour-hub

# –ö–ª–æ–Ω–∏—Ä—É–µ–º (–∏–ª–∏ –∑–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ FTP)
git clone https://github.com/your-repo/kamchatour-hub.git .

# –ò–ª–∏ —á–µ—Ä–µ–∑ rsync —Å –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã
# rsync -avz --exclude 'node_modules' ./ root@your-server-ip:/var/www/kamchatour-hub/
```

### –®–∞–≥ 7: –°–æ–∑–¥–∞–Ω–∏–µ .env.production

```bash
# –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª
nano .env.production
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```bash
# Node Environment
NODE_ENV=production
PORT=3000

# Database (Timeweb Cloud)
DATABASE_URL="postgresql://gen_user:q;3U+PY7XCz@Br@51e6e5ca5d967b8e81fc9b75.twc1.net:5432/default_db?sslmode=require"
DATABASE_SSL=true
DATABASE_MAX_CONNECTIONS=20

# JWT (–ò–ó–ú–ï–ù–ò–¢–¨!)
JWT_SECRET=your-super-secret-jwt-key-change-me-in-production
JWT_EXPIRES_IN=7d

# Application
NEXT_PUBLIC_APP_URL=https://your-domain.com

# AI APIs
GROQ_API_KEY=your_groq_api_key_here
DEEPSEEK_API_KEY=your_deepseek_api_key_here
OPENROUTER_API_KEY=your_openrouter_api_key_here

# Payments
CLOUDPAYMENTS_PUBLIC_ID=your_public_id
CLOUDPAYMENTS_API_SECRET=your_api_secret

# Maps
YANDEX_MAPS_API_KEY=your_yandex_maps_key
YANDEX_WEATHER_API_KEY=your_yandex_weather_key

# Email (Gmail SMTP –ø—Ä–∏–º–µ—Ä)
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASS=your-app-password
EMAIL_FROM=noreply@kamchatour.ru

# SMS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
SMS_RU_API_ID=your_sms_ru_api_id

# Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
TELEGRAM_BOT_TOKEN=your_bot_token
TELEGRAM_CHAT_ID=your_chat_id

# Monitoring
SENTRY_DSN=your_sentry_dsn
NEXT_PUBLIC_SENTRY_DSN=your_sentry_dsn

# Security
CRON_SECRET=your-random-cron-secret-key

# Redis (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
REDIS_URL=redis://localhost:6379
```

**–°–æ—Ö—Ä–∞–Ω–∏—Ç—å:** `Ctrl+X`, `Y`, `Enter`

### –®–∞–≥ 8: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–±–æ—Ä–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
npm ci --production=false

# –°–±–æ—Ä–∫–∞ Next.js
npm run build

# –û—á–∏—Å—Ç–∫–∞ dev –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (—ç–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞)
npm prune --production
```

### –®–∞–≥ 9: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PM2

**–°–æ–∑–¥–∞–µ–º `ecosystem.config.js`:**
```bash
nano ecosystem.config.js
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```javascript
module.exports = {
  apps: [{
    name: 'kamchatour-hub',
    script: 'npm',
    args: 'start',
    instances: 2,  // 2 –ø—Ä–æ—Ü–µ—Å—Å–∞
    exec_mode: 'cluster',
    env: {
      NODE_ENV: 'production',
      PORT: 3000
    },
    error_file: './logs/err.log',
    out_file: './logs/out.log',
    log_file: './logs/combined.log',
    time: true,
    max_memory_restart: '500M',
    autorestart: true,
    watch: false
  }]
};
```

**–ó–∞–ø—É—Å–∫:**
```bash
# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
mkdir -p logs

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 start ecosystem.config.js

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
pm2 startup systemd
pm2 save

# –ü—Ä–æ–≤–µ—Ä–∫–∞
pm2 status
pm2 logs kamchatour-hub --lines 50
```

### –®–∞–≥ 10: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

**–°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:**
```bash
sudo nano /etc/nginx/sites-available/kamchatour-hub
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```nginx
# Redirect HTTP to HTTPS
server {
    listen 80;
    listen [::]:80;
    server_name your-domain.com www.your-domain.com;
    
    location /.well-known/acme-challenge/ {
        root /var/www/certbot;
    }
    
    location / {
        return 301 https://$server_name$request_uri;
    }
}

# HTTPS Server
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name your-domain.com www.your-domain.com;
    
    # SSL certificates (–±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã certbot)
    # ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    # ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # Logging
    access_log /var/log/nginx/kamchatour_access.log;
    error_log /var/log/nginx/kamchatour_error.log;
    
    # Gzip
    gzip on;
    gzip_types text/plain text/css application/json application/javascript;
    
    # Proxy to Next.js
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
    
    # Cache static files
    location /_next/static {
        proxy_pass http://localhost:3000;
        add_header Cache-Control "public, max-age=3600, immutable";
    }
}
```

**–ê–∫—Ç–∏–≤–∞—Ü–∏—è:**
```bash
# –°–æ–∑–¥–∞–µ–º —Å–∏–º–ª–∏–Ω–∫
sudo ln -s /etc/nginx/sites-available/kamchatour-hub /etc/nginx/sites-enabled/

# –£–¥–∞–ª—è–µ–º default
sudo rm /etc/nginx/sites-enabled/default

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl restart nginx
```

### –®–∞–≥ 11: –ü–æ–ª—É—á–µ–Ω–∏–µ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

```bash
# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è certbot
sudo mkdir -p /var/www/certbot

# –ü–æ–ª—É—á–∞–µ–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx \
    -d your-domain.com \
    -d www.your-domain.com \
    --non-interactive \
    --agree-tos \
    --email your-email@example.com \
    --redirect

# –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo systemctl enable certbot.timer
```

### –®–∞–≥ 12: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall

```bash
# –í–∫–ª—é—á–∞–µ–º UFW
sudo ufw enable

# –†–∞–∑—Ä–µ—à–∞–µ–º –ø–æ—Ä—Ç—ã
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'

# –ü—Ä–æ–≤–µ—Ä–∫–∞
sudo ufw status
```

### –®–∞–≥ 13: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cron Jobs

```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º crontab
crontab -e
```

**–î–æ–±–∞–≤–∏—Ç—å:**
```bash
# Cleanup expired holds (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
* * * * * curl -H 'X-Cron-Secret: your-cron-secret' https://your-domain.com/api/cron/cleanup-holds

# Database backup (–∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00)
0 3 * * * cd /var/www/kamchatour-hub && bash scripts/backup-db.sh
```

---

## ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê –ü–û–°–õ–ï –î–ï–ü–õ–û–Ø

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
# PM2 —Å—Ç–∞—Ç—É—Å
pm2 status

# –õ–æ–≥–∏
pm2 logs kamchatour-hub --lines 100

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∏, —Ä–µ—Å—Ç–∞—Ä—Ç
pm2 restart kamchatour-hub
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Nginx

```bash
# –°—Ç–∞—Ç—É—Å
sudo systemctl status nginx

# –õ–æ–≥–∏
sudo tail -f /var/log/nginx/kamchatour_error.log

# –ï—Å–ª–∏ –æ—à–∏–±–∫–∏, —Ä–µ—Å—Ç–∞—Ä—Ç
sudo systemctl restart nginx
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot certificates

# –¢–µ—Å—Ç–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
sudo certbot renew --dry-run
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
curl http://localhost:3000

# –ü–æ –¥–æ–º–µ–Ω—É
curl https://your-domain.com

# –ü—Ä–æ–≤–µ—Ä–∫–∞ API
curl https://your-domain.com/api/health/db
```

### 5. –ü–æ–ª—É—á–µ–Ω–∏–µ API –∫–ª—é—á–µ–π

#### GROQ (AI):
1. –ó–∞–π—Ç–∏ –Ω–∞ https://console.groq.com
2. –°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)
3. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á
4. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.production`: `GROQ_API_KEY=gsk_...`

#### CloudPayments (–ü–ª–∞—Ç–µ–∂–∏):
1. –ó–∞–π—Ç–∏ –Ω–∞ https://cloudpayments.ru
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç
3. –ü–æ–ª—É—á–∏—Ç—å Public ID –∏ API Secret
4. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.production`

#### Yandex Maps:
1. –ó–∞–π—Ç–∏ –Ω–∞ https://developer.tech.yandex.ru
2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
3. –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á
4. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.production`

#### Gmail SMTP:
1. –í–∫–ª—é—á–∏—Ç—å 2FA –≤ Google –∞–∫–∫–∞—É–Ω—Ç–µ
2. –°–æ–∑–¥–∞—Ç—å App Password
3. –î–æ–±–∞–≤–∏—Ç—å –≤ `.env.production`

### 6. –†–µ—Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è .env

```bash
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
nano /var/www/kamchatour-hub/.env.production

# –†–µ—Å—Ç–∞—Ä—Ç PM2
pm2 restart kamchatour-hub

# –ü—Ä–æ–≤–µ—Ä–∫–∞
pm2 logs kamchatour-hub --lines 50
```

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´

### 1. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
```
https://your-domain.com
```

### 2. –î–∞—à–±–æ—Ä–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
```
https://your-domain.com/hub/tour-operator
```

### 3. API Health Check
```bash
curl https://your-domain.com/api/health/db
```

–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:
```json
{
  "status": "ok",
  "database": "connected",
  "timestamp": "..."
}
```

### 4. Tours API
```bash
curl https://your-domain.com/api/tours
```

### 5. Tours Operator Dashboard API
```bash
curl "https://your-domain.com/api/tours/operator/dashboard?operatorId=b5d82b0f-fb2c-4449-91b4-6b7f4916b7df"
```

---

## üéõÔ∏è –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–ê–ô–¢–û–ú

### PM2 –ö–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
pm2 status

# –õ–æ–≥–∏
pm2 logs kamchatour-hub
pm2 logs kamchatour-hub --lines 100
pm2 logs kamchatour-hub --err  # –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏

# –†–µ—Å—Ç–∞—Ä—Ç
pm2 restart kamchatour-hub

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
pm2 stop kamchatour-hub

# –£–¥–∞–ª–µ–Ω–∏–µ
pm2 delete kamchatour-hub

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
pm2 monit

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
pm2 info kamchatour-hub
```

### Nginx –ö–æ–º–∞–Ω–¥—ã

```bash
# –°—Ç–∞—Ç—É—Å
sudo systemctl status nginx

# –†–µ—Å—Ç–∞—Ä—Ç
sudo systemctl restart nginx

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –∫–æ–Ω—Ñ–∏–≥–∞ (–±–µ–∑ downtime)
sudo systemctl reload nginx

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –õ–æ–≥–∏
sudo tail -f /var/log/nginx/kamchatour_access.log
sudo tail -f /var/log/nginx/kamchatour_error.log
```

### Database –ö–æ–º–∞–Ω–¥—ã

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
psql 'postgresql://gen_user:q;3U+PY7XCz@Br@51e6e5ca5d967b8e81fc9b75.twc1.net:5432/default_db?sslmode=require'

# Backup
bash /var/www/kamchatour-hub/scripts/backup-db.sh

# Restore
bash /var/www/kamchatour-hub/scripts/restore-db.sh backup-file.sql
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞

```bash
# –ó–∞–π—Ç–∏ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é
cd /var/www/kamchatour-hub

# –ü–æ–ª—É—á–∏—Ç—å –Ω–æ–≤—ã–π –∫–æ–¥
git pull origin main

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
npm run build

# –†–µ—Å—Ç–∞—Ä—Ç
pm2 restart kamchatour-hub
```

---

## üêõ TROUBLESHOOTING

### –ü—Ä–æ–±–ª–µ–º–∞: –°–∞–π—Ç –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# 1. –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ PM2?
pm2 status
pm2 logs kamchatour-hub --err

# 2. –†–∞–±–æ—Ç–∞–µ—Ç –ª–∏ Nginx?
sudo systemctl status nginx
sudo nginx -t

# 3. –û—Ç–∫—Ä—ã—Ç—ã –ª–∏ –ø–æ—Ä—Ç—ã?
sudo netstat -tlnp | grep -E ':(80|443|3000)'

# 4. Firewall?
sudo ufw status
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –†–µ—Å—Ç–∞—Ä—Ç –≤—Å–µ–≥–æ
pm2 restart kamchatour-hub
sudo systemctl restart nginx
```

### –ü—Ä–æ–±–ª–µ–º–∞: 502 Bad Gateway

**–ü—Ä–∏—á–∏–Ω–∞:** Nginx –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ Next.js

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ Next.js –∑–∞–ø—É—â–µ–Ω
pm2 status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç 3000
curl http://localhost:3000

# –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 restart kamchatour-hub
pm2 logs kamchatour-hub
```

### –ü—Ä–æ–±–ª–µ–º–∞: SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
sudo certbot certificates

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥ Nginx
sudo nginx -t

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
sudo tail -f /var/log/letsencrypt/letsencrypt.log
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
sudo certbot --nginx -d your-domain.com --force-renewal
```

### –ü—Ä–æ–±–ª–µ–º–∞: Database connection error

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å .env.production
cat /var/www/kamchatour-hub/.env.production | grep DATABASE_URL

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql 'postgresql://...'
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ò—Å–ø—Ä–∞–≤–∏—Ç—å DATABASE_URL –≤ .env.production
nano /var/www/kamchatour-hub/.env.production

# –†–µ—Å—Ç–∞—Ä—Ç
pm2 restart kamchatour-hub
```

### –ü—Ä–æ–±–ª–µ–º–∞: Out of memory

**–ü—Ä–æ–≤–µ—Ä–∫–∏:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–∞–º—è—Ç—å
free -h

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PM2
pm2 status
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£–º–µ–Ω—å—à–∏—Ç—å instances –≤ ecosystem.config.js
nano /var/www/kamchatour-hub/ecosystem.config.js
# –ò–∑–º–µ–Ω–∏—Ç—å instances: 2 ‚Üí instances: 1

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 delete kamchatour-hub
pm2 start ecosystem.config.js
```

---

## üìà MONITORING

### PM2 Plus (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

```bash
# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://pm2.io
# –ü–æ–ª—É—á–∏—Ç—å –∫–ª—é—á

# –ü–æ–¥–∫–ª—é—á–∏—Ç—å
pm2 link <secret> <public>

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# https://app.pm2.io
```

### Sentry (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# 1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ https://sentry.io
# 2. –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
# 3. –ü–æ–ª—É—á–∏—Ç—å DSN
# 4. –î–æ–±–∞–≤–∏—Ç—å –≤ .env.production:
SENTRY_DSN=https://...@sentry.io/...

# 5. –†–µ—Å—Ç–∞—Ä—Ç
pm2 restart kamchatour-hub
```

---

## üéâ –ò–¢–û–ì–û

**–í–∞—à —Å–∞–π—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç!**

### ‚úÖ –ß—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ:

- [x] Node.js 20 + PM2 (cluster mode, 2 instances)
- [x] Nginx (reverse proxy, gzip, SSL)
- [x] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç (Let's Encrypt, –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- [x] Firewall (UFW)
- [x] Cron jobs (cleanup, backup)
- [x] Database connection (Timeweb Cloud PostgreSQL)
- [x] 30+ —Ç–∞–±–ª–∏—Ü –≤ –ë–î
- [x] API endpoints (28 —à—Ç)
- [x] –î–∞—à–±–æ—Ä–¥ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞
- [x] –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ

### üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–¥–µ–ª–∞—Ç—å:

- [ ] –î–æ–±–∞–≤–∏—Ç—å API –∫–ª—é—á–∏ (GROQ, CloudPayments, –∏ —Ç.–¥.)
- [ ] –ò–∑–º–µ–Ω–∏—Ç—å JWT_SECRET –∏ CRON_SECRET
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Sentry)
- [ ] –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
- [ ] Load testing

### üöÄ URL:

- **–°–∞–π—Ç:** https://your-domain.com
- **–î–∞—à–±–æ—Ä–¥:** https://your-domain.com/hub/tour-operator
- **API:** https://your-domain.com/api/*

---

**–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –∑–∞–ø—É—Å–∫–æ–º! üéâ**
