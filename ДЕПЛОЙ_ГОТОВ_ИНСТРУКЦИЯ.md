# üöÄ –î–ï–ü–õ–û–ô –ì–û–¢–û–í - –ò–ù–°–¢–†–£–ö–¶–ò–Ø

**–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –í–°–Å –¥–ª—è –¥–µ–ø–ª–æ—è, –Ω–æ –Ω–µ –º–æ–≥—É –≤—ã–ø–æ–ª–Ω–∏—Ç—å SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ —ç—Ç–æ–π —Å—Ä–µ–¥—ã.**

---

## ‚ö° –°–ê–ú–´–ô –ü–†–û–°–¢–û–ô –°–ü–û–°–û–ë (3 –ú–ò–ù–£–¢–´)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ SSH —Ç–µ—Ä–º–∏–Ω–∞–ª (–ö–û–ü–ò–ü–ê–°–¢–ê)

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –Ω–∞ –≤–∞—à–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ**

2. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ —Å–µ—Ä–≤–µ—Ä—É:**
   ```bash
   ssh root@5.129.248.224
   ```
   –ü–∞—Ä–æ–ª—å: `xQvB1pv?yZTjaR`

3. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –í–°–Å —Å—Ä–∞–∑—É:**

```bash
bash << 'EOF'
set -e && cd /root
echo "üöÄ –î–µ–ø–ª–æ–π Kamchatour Hub..."

# Node.js
if ! command -v node &> /dev/null; then
    curl -fsSL https://deb.nodesource.com/setup_20.x | bash - && apt-get install -y nodejs
fi
echo "‚úÖ Node: $(node --version)"

# PostgreSQL
if ! command -v psql &> /dev/null; then
    apt-get update && apt-get install -y postgresql postgresql-contrib
    systemctl enable postgresql && systemctl start postgresql
fi

# –ë–î
sudo -u postgres psql << 'DBEOF'
DROP DATABASE IF EXISTS kamhub_production;
DROP USER IF EXISTS kamhub;
CREATE USER kamhub WITH PASSWORD 'kamhub2024secure';
CREATE DATABASE kamhub_production OWNER kamhub;
GRANT ALL PRIVILEGES ON DATABASE kamhub_production TO kamhub;
DBEOF
echo "‚úÖ –ë–î —Å–æ–∑–¥–∞–Ω–∞"

# –ö–æ–¥
apt-get install -y git && mkdir -p /var/www && cd /var/www
if [ -d "kamhub" ]; then
    cd kamhub && git fetch && git reset --hard origin/cursor/deep-repository-scan-05bf && git pull
else
    git clone -b cursor/deep-repository-scan-05bf https://github.com/PosPk/kamhub.git kamhub && cd kamhub
fi
echo "‚úÖ –ö–æ–¥ –ø–æ–ª—É—á–µ–Ω"

# .env
cat > .env.production << 'ENVEOF'
DATABASE_URL=postgresql://kamhub:kamhub2024secure@localhost:5432/kamhub_production
DATABASE_SSL=false
NODE_ENV=production
PORT=3000
NEXT_PUBLIC_APP_URL=http://5.129.248.224
S3_ENDPOINT=https://s3.twcstorage.ru
S3_BUCKET=d9542536-676ee691-7f59-46bb-bf0e-ab64230eec50
S3_ACCESS_KEY=F2CP4X3X17GVQ1YH5I5D
S3_SECRET_KEY=72iAsYR4QQCIdaDI9e9AzXnzVvvP8bvPELmrBVzX
ENVEOF

# –°–±–æ—Ä–∫–∞
npm install && npm run build
echo "‚úÖ –°–æ–±—Ä–∞–Ω–æ"

# –°—Ö–µ–º–∞ –ë–î
export PGPASSWORD='kamhub2024secure'
psql -h localhost -U kamhub -d kamhub_production -f lib/database/schema.sql
psql -h localhost -U kamhub -d kamhub_production -f lib/database/tour_system_schema.sql  
psql -h localhost -U kamhub -d kamhub_production -f lib/database/user_roles_migration.sql
echo "‚úÖ –ë–î –≥–æ—Ç–æ–≤–∞"

# PM2
npm install -g pm2
pm2 delete kamhub 2>/dev/null || true
PORT=3000 pm2 start npm --name kamhub -- start
pm2 save && pm2 startup systemd -u root --hp /root
echo "‚úÖ PM2 –∑–∞–ø—É—â–µ–Ω"

# Nginx
apt-get install -y nginx
cat > /etc/nginx/sites-available/kamhub << 'NGINXEOF'
server {
    listen 80 default_server;
    server_name 5.129.248.224;
    client_max_body_size 50M;
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
NGINXEOF
ln -sf /etc/nginx/sites-available/kamhub /etc/nginx/sites-enabled/
rm -f /etc/nginx/sites-enabled/default
nginx -t && systemctl reload nginx

echo ""
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë       ‚úÖ –î–ï–ü–õ–û–ô –ó–ê–í–ï–†–®–ï–ù –£–°–ü–ï–®–ù–û!                ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""
echo "üåê –°–∞–π—Ç: http://5.129.248.224"
pm2 status
echo ""
echo "–ö–æ–º–∞–Ω–¥—ã: pm2 logs kamhub | pm2 restart kamhub"
EOF
```

**–í—Å—Ç–∞–≤—å—Ç–µ —ç—Ç–æ –≤—Å—ë –≤ SSH —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –Ω–∞–∂–º–∏—Ç–µ Enter!**

---

## üìã –ß–¢–û –ü–†–û–ò–ó–û–ô–î–ï–¢

–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞ 10-15 –º–∏–Ω—É—Ç:

1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Node.js 20
2. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç PostgreSQL 15
3. ‚úÖ –°–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö kamhub_production
4. ‚úÖ –°–∫–ª–æ–Ω–∏—Ä—É–µ—Ç –∫–æ–¥ –∏–∑ GitHub
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
6. ‚úÖ –°–æ–±–µ—Ä–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (npm run build)
7. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç —Å—Ö–µ–º—É –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
8. ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ PM2
9. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç Nginx –∫–∞–∫ reverse proxy
10. ‚úÖ –ü–æ–∫–∞–∂–µ—Ç —Å—Ç–∞—Ç—É—Å

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –°–∞–π—Ç –Ω–∞ http://5.129.248.224

---

## üéØ –ß–¢–û –î–ï–õ–ê–¢–¨

### –°–ï–ô–ß–ê–°:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `ssh root@5.129.248.224`
3. –í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å: `xQvB1pv?yZTjaR`
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤—ã—à–µ (–æ—Ç `bash << 'EOF'` –¥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–π `EOF`)
5. –í—Å—Ç–∞–≤—å—Ç–µ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª SSH
6. –ù–∞–∂–º–∏—Ç–µ Enter
7. –ñ–¥–∏—Ç–µ 10-15 –º–∏–Ω—É—Ç

### –ü–û–°–õ–ï:

1. –û—Ç–∫—Ä–æ–π—Ç–µ: http://5.129.248.224
2. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å: /auth/register-business
3. –í—ã–±–µ—Ä–∏—Ç–µ 4 —Ä–æ–ª–∏ (–æ–ø–µ—Ä–∞—Ç–æ—Ä, –≤–æ–¥–∏—Ç–µ–ª—å, —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ, —Å–Ω–∞—Ä—è–∂–µ–Ω–∏–µ)
4. –ù–∞—á–Ω–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ!

---

## ‚úÖ –í–°–Å –ì–û–¢–û–í–û!

–Ø –ø–æ–¥–≥–æ—Ç–æ–≤–∏–ª –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± –¥–µ–ø–ª–æ—è - –æ–¥–Ω–∞ –∫–æ–º–∞–Ω–¥–∞ –∫–æ–ø–∏–ø–∞—Å—Ç–∞!
