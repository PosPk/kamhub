# üöÄ –î–ï–ü–õ–û–ô –ù–ê TIMEWEB CLOUD

> **–ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é Kamchatour Hub –Ω–∞ Timeweb Cloud**

---

## üìã –°–û–î–ï–†–ñ–ê–ù–ò–ï

1. [–ß—Ç–æ –Ω—É–∂–Ω–æ](#—á—Ç–æ-–Ω—É–∂–Ω–æ)
2. [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (1 –∫–æ–º–∞–Ω–¥–∞)](#–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
3. [–†—É—á–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞](#—Ä—É—á–Ω–∞—è-—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ–º–µ–Ω–∞](#–Ω–∞—Å—Ç—Ä–æ–π–∫–∞-–¥–æ–º–µ–Ω–∞)
5. [SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç](#ssl-—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç)
6. [–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è](#–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
7. [–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏](#–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥-–∏-–ª–æ–≥–∏)
8. [–†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º](#—Ä–µ—à–µ–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º)

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û

### –ù–∞ Timeweb Cloud:

1. **VDS/VPS —Å–µ—Ä–≤–µ—Ä**
   - –ú–∏–Ω–∏–º—É–º: 2 CPU, 2GB RAM, 20GB SSD
   - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 4 CPU, 4GB RAM, 40GB SSD
   - –û–°: Ubuntu 20.04/22.04 –∏–ª–∏ CentOS 7/8

2. **–î–æ–º–µ–Ω (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)**
   - –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å —Å–≤–æ–π –¥–æ–º–µ–Ω
   - –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å IP –∞–¥—Ä–µ—Å

### –¢–∞—Ä–∏—Ñ—ã Timeweb Cloud (–ø—Ä–∏–º–µ—Ä–Ω–æ):

```
VDS-2: 2 CPU, 2GB RAM, 20GB SSD  - ~300‚ÇΩ/–º–µ—Å
VDS-4: 4 CPU, 4GB RAM, 40GB SSD  - ~600‚ÇΩ/–º–µ—Å ‚Üê –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è
VDS-8: 8 CPU, 8GB RAM, 80GB SSD  - ~1200‚ÇΩ/–º–µ—Å
```

---

## ‚ö° –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

```bash
# 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å–µ—Ä–≤–µ—Ä—É –ø–æ SSH
ssh root@–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip

# 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
cd /root
git clone <your-repo-url> kamchatour-hub
cd kamchatour-hub

# 3. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π
chmod +x deploy-timeweb.sh
./deploy-timeweb.sh
```

**–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
- ‚úÖ –û–±–Ω–æ–≤–∏—Ç —Å–∏—Å—Ç–µ–º—É
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Node.js 20
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç PostgreSQL
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç Nginx
- ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç PM2
- ‚úÖ –°–æ–±–µ—Ä–µ—Ç –ø—Ä–æ–µ–∫—Ç
- ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç firewall
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç backup

**‚è± –í—Ä–µ–º—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏: 5-10 –º–∏–Ω—É—Ç**

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ:
- `http://–≤–∞—à-ip`
- `http://–≤–∞—à-–¥–æ–º–µ–Ω` (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω)

---

## üîß –†–£–ß–ù–ê–Ø –£–°–¢–ê–ù–û–í–ö–ê

### –®–∞–≥ 1: –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
# SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
ssh root@–≤–∞—à-—Å–µ—Ä–≤–µ—Ä-ip

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
apt update && apt upgrade -y  # Ubuntu/Debian
# –∏–ª–∏
yum update -y                 # CentOS
```

### –®–∞–≥ 2: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 20

```bash
# Ubuntu/Debian
curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
apt install -y nodejs

# CentOS
curl -fsSL https://rpm.nodesource.com/setup_20.x | bash -
yum install -y nodejs

# –ü—Ä–æ–≤–µ—Ä–∫–∞
node -v  # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å v20.x.x
npm -v
```

### –®–∞–≥ 3: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

```bash
# Ubuntu/Debian
apt install -y postgresql postgresql-contrib
systemctl start postgresql
systemctl enable postgresql

# CentOS
yum install -y postgresql-server postgresql-contrib
postgresql-setup initdb
systemctl start postgresql
systemctl enable postgresql
```

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
sudo -u postgres psql

# –í –∫–æ–Ω—Å–æ–ª–∏ PostgreSQL:
CREATE DATABASE kamchatour;
CREATE USER kamuser WITH PASSWORD '–≤–∞—à-–ø–∞—Ä–æ–ª—å';
GRANT ALL PRIVILEGES ON DATABASE kamchatour TO kamuser;
CREATE EXTENSION IF NOT EXISTS "uuid-ossp";
\c kamchatour
CREATE EXTENSION IF NOT EXISTS postgis;
\q
```

### –®–∞–≥ 5: –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p /var/www/kamchatour
cd /var/www/kamchatour

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
git clone <your-repo-url> .

# –ò–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ FTP/SFTP
```

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env

```bash
cd /var/www/kamchatour
nano .env
```

```env
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
DATABASE_URL=postgresql://kamuser:–≤–∞—à-–ø–∞—Ä–æ–ª—å@localhost:5432/kamchatour
DATABASE_SSL=false
DATABASE_MAX_CONNECTIONS=20

# Security
JWT_SECRET=$(openssl rand -base64 32)
JWT_EXPIRES_IN=7d

# Application
NODE_ENV=production
NEXT_PUBLIC_APP_URL=http://–≤–∞—à-–¥–æ–º–µ–Ω-–∏–ª–∏-ip

# –î–æ–±–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env.example
```

### –®–∞–≥ 7: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ —Å–±–æ—Ä–∫–∞

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
npm install

# –°–±–æ—Ä–∫–∞
npm run build
```

### –®–∞–≥ 8: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
npm run migrate:up

# –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
psql $DATABASE_URL -f lib/database/seat_holds_schema.sql

# –ü—Ä–æ–≤–µ—Ä–∫–∞
npm run db:test
```

### –®–∞–≥ 9: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
npm install -g pm2

# –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 start npm --name "kamchatour-hub" -- start

# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
pm2 save
pm2 startup
# –í—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É –∫–æ—Ç–æ—Ä—É—é –≤—ã–¥–∞—Å—Ç pm2 startup
```

### –®–∞–≥ 10: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx
apt install -y nginx  # Ubuntu/Debian
# –∏–ª–∏
yum install -y nginx  # CentOS

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nano /etc/nginx/sites-available/kamchatour
```

```nginx
server {
    listen 80;
    server_name –≤–∞—à-–¥–æ–º–µ–Ω.ru www.–≤–∞—à-–¥–æ–º–µ–Ω.ru;

    # Security headers
    add_header X-Frame-Options "DENY" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "strict-origin-when-cross-origin" always;

    # –õ–æ–≥–∏
    access_log /var/log/nginx/kamchatour_access.log;
    error_log /var/log/nginx/kamchatour_error.log;

    # –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–æ–≤
    client_max_body_size 10M;

    # Proxy –∫ Next.js
    location / {
        proxy_pass http://127.0.0.1:3002;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –¢–∞–π–º–∞—É—Ç—ã
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
    location /_next/static {
        proxy_pass http://127.0.0.1:3002;
        proxy_cache_valid 200 60m;
        add_header Cache-Control "public, max-age=3600, immutable";
    }
}
```

```bash
# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
ln -s /etc/nginx/sites-available/kamchatour /etc/nginx/sites-enabled/
rm /etc/nginx/sites-enabled/default  # —É–¥–∞–ª–∏—Ç—å default

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
systemctl reload nginx
systemctl enable nginx
```

### –®–∞–≥ 11: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall

```bash
# Ubuntu/Debian (UFW)
ufw allow 22/tcp   # SSH
ufw allow 80/tcp   # HTTP
ufw allow 443/tcp  # HTTPS
ufw enable

# CentOS (firewalld)
firewall-cmd --permanent --add-service=ssh
firewall-cmd --permanent --add-service=http
firewall-cmd --permanent --add-service=https
firewall-cmd --reload
```

---

## üåê –ù–ê–°–¢–†–û–ô–ö–ê –î–û–ú–ï–ù–ê

### –í –ø–∞–Ω–µ–ª–∏ Timeweb Cloud:

1. **–ö—É–ø–∏—Ç—å/–¥–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω:**
   - –£—Å–ª—É–≥–∏ ‚Üí –î–æ–º–µ–Ω—ã ‚Üí –î–æ–±–∞–≤–∏—Ç—å –¥–æ–º–µ–Ω
   - –ò–ª–∏ –ø—Ä–∏–≤—è–∑–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π

2. **DNS –∑–∞–ø–∏—Å–∏:**
   ```
   A-–∑–∞–ø–∏—Å—å:  @        ‚Üí IP-–∞–¥—Ä–µ—Å-—Å–µ—Ä–≤–µ—Ä–∞
   A-–∑–∞–ø–∏—Å—å:  www      ‚Üí IP-–∞–¥—Ä–µ—Å-—Å–µ—Ä–≤–µ—Ä–∞
   CNAME:     *        ‚Üí –≤–∞—à-–¥–æ–º–µ–Ω.ru
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å .env:**
   ```env
   NEXT_PUBLIC_APP_URL=https://–≤–∞—à-–¥–æ–º–µ–Ω.ru
   ```

4. **–û–±–Ω–æ–≤–∏—Ç—å Nginx:**
   ```bash
   nano /etc/nginx/sites-available/kamchatour
   # –ò–∑–º–µ–Ω–∏—Ç—å server_name –Ω–∞ –≤–∞—à –¥–æ–º–µ–Ω
   nginx -t
   systemctl reload nginx
   ```

5. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
   ```bash
   pm2 restart kamchatour-hub
   ```

---

## üîí SSL –°–ï–†–¢–ò–§–ò–ö–ê–¢

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π SSL (Let's Encrypt)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
apt install -y certbot python3-certbot-nginx  # Ubuntu/Debian
# –∏–ª–∏
yum install -y certbot python3-certbot-nginx  # CentOS

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç Nginx)
certbot --nginx -d –≤–∞—à-–¥–æ–º–µ–Ω.ru -d www.–≤–∞—à-–¥–æ–º–µ–Ω.ru

# –ê–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏–µ
certbot renew --dry-run

# –î–æ–±–∞–≤–∏—Ç—å –≤ cron –¥–ª—è –∞–≤—Ç–æ–ø—Ä–æ–¥–ª–µ–Ω–∏—è
crontab -e
```

–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É:
```
0 0 * * * certbot renew --quiet --post-hook "systemctl reload nginx"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL:

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ HTTPS:
- `https://–≤–∞—à-–¥–æ–º–µ–Ω.ru`

---

## üîÑ –û–ë–ù–û–í–õ–ï–ù–ò–ï –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### –ß–µ—Ä–µ–∑ Git:

```bash
cd /var/www/kamchatour

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
pm2 stop kamchatour-hub

# –ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
git pull origin main

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å
npm run build

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å –Ω–æ–≤—ã–µ)
npm run migrate:up

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
pm2 start kamchatour-hub
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:

```bash
#!/bin/bash
cd /var/www/kamchatour
pm2 stop kamchatour-hub
git pull
npm install
npm run build
npm run migrate:up
pm2 start kamchatour-hub
pm2 save
echo "‚úì –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫ `update.sh`, —Å–¥–µ–ª–∞—Ç—å –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º:
```bash
chmod +x update.sh
./update.sh
```

---

## üìä –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –õ–û–ì–ò

### PM2 –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:

```bash
# –°—Ç–∞—Ç—É—Å –≤—Å–µ—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
pm2 status

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
pm2 show kamchatour-hub

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 logs kamchatour-hub

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
pm2 logs kamchatour-hub --lines 100

# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
pm2 flush

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤
pm2 monit
```

### Nginx –õ–æ–≥–∏:

```bash
# Access log
tail -f /var/log/nginx/kamchatour_access.log

# Error log
tail -f /var/log/nginx/kamchatour_error.log

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ—à–∏–±–∫–∏
grep "error" /var/log/nginx/kamchatour_error.log | tail -20
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:

```bash
# CPU –∏ –ø–∞–º—è—Ç—å
htop

# –ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ
df -h

# –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
netstat -tulpn | grep LISTEN

# –ü—Ä–æ—Ü–µ—Å—Å—ã Node.js
ps aux | grep node
```

### PostgreSQL:

```bash
# –†–∞–∑–º–µ—Ä –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
sudo -u postgres psql -c "SELECT pg_size_pretty(pg_database_size('kamchatour'));"

# –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
sudo -u postgres psql -c "SELECT count(*) FROM pg_stat_activity WHERE datname='kamchatour';"

# –õ–æ–≥–∏ PostgreSQL
tail -f /var/log/postgresql/postgresql-*.log
```

---

## üÜò –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ PM2
pm2 logs kamchatour-hub --err

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç 3002
netstat -tulpn | grep 3002

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
pm2 restart kamchatour-hub

# –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ PM2
pm2 kill
pm2 start npm --name "kamchatour-hub" -- start
```

### "Connection refused" –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω
systemctl status postgresql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
psql -h localhost -U kamuser -d kamchatour

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å DATABASE_URL –≤ .env
cat .env | grep DATABASE_URL

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å PostgreSQL
systemctl restart postgresql
```

### Nginx –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 502 Bad Gateway:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
pm2 status

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä—Ç 3002
curl http://localhost:3002

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Nginx
tail -f /var/log/nginx/kamchatour_error.log

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Nginx
systemctl restart nginx
```

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã
htop

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è PostgreSQL
sudo -u postgres psql -d kamchatour -c "VACUUM ANALYZE;"

# –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏ PM2
pm2 flush

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–π –ø–∞–º—è—Ç—å—é
pm2 delete kamchatour-hub
pm2 start npm --name "kamchatour-hub" --max-memory-restart 1G -- start
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å SSL:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
certbot certificates

# –¢–µ—Å—Ç –ø—Ä–æ–¥–ª–µ–Ω–∏—è
certbot renew --dry-run

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Nginx
nginx -t

# –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–æ–¥–ª–µ–Ω–∏–µ
certbot renew --force-renewal
```

---

## üíæ BACKUP

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π backup:

–£–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å–∫—Ä–∏–ø—Ç–æ–º `deploy-timeweb.sh`:

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cron job
crontab -l

# –†—É—á–Ω–æ–π backup
/var/www/kamchatour/scripts/backup-db.sh

# Backup —Ö—Ä–∞–Ω—è—Ç—Å—è –≤
ls -lh /var/www/kamchatour/backups/
```

### –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ backup:

```bash
cd /var/www/kamchatour
./scripts/restore-db.sh /path/to/backup.sql.gz
```

---

## üìà –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### PostgreSQL:

```bash
sudo nano /etc/postgresql/*/main/postgresql.conf
```

```ini
# –£–≤–µ–ª–∏—á–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
max_connections = 100

# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
shared_buffers = 512MB
effective_cache_size = 2GB
maintenance_work_mem = 128MB
work_mem = 16MB
```

```bash
sudo systemctl restart postgresql
```

### PM2 Cluster Mode:

```bash
pm2 delete kamchatour-hub
pm2 start npm --name "kamchatour-hub" -i 2 -- start
pm2 save
```

### Nginx –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:

–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Nginx:

```nginx
# –ö—ç—à –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è
proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=1g inactive=60m;

server {
    # ...
    
    location /api {
        proxy_cache my_cache;
        proxy_cache_valid 200 5m;
        proxy_cache_methods GET HEAD;
        # ...
    }
}
```

---

## üéØ –ß–ï–ö–õ–ò–°–¢ –ü–û–°–õ–ï –î–ï–ü–õ–û–Ø

- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ HTTP
- [ ] –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∞
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] PM2 –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Nginx —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Firewall –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –î–æ–º–µ–Ω –ø—Ä–∏–≤—è–∑–∞–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)
- [ ] SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] Backup –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] API –∫–ª—é—á–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ .env
- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–æ–∑–¥–∞–Ω—ã

---

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

### –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:

- **Timeweb Cloud:** https://timeweb.cloud/
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Timeweb:** https://timeweb.cloud/help/
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** support@timeweb.ru

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞:

- `–ì–û–¢–û–í–û_–î–ï–ü–õ–û–ô.md` - –æ–±—â–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- `START_HERE.md` - –æ–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞
- `IMPLEMENTATION_GUIDE.md` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è middleware

---

## ‚úÖ –ì–û–¢–û–í–û!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:

- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Timeweb Cloud VDS/VPS
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ –ø–æ –¥–æ–º–µ–Ω—É —Å SSL
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ
- ‚úÖ –ò–º–µ–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ backup
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–æ firewall
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—Å—è —á–µ—Ä–µ–∑ PM2

**–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≥–æ—Ç–æ–≤–æ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é! üéâ**

---

**–ê–≤—Ç–æ—Ä:** Cursor AI Agent  
**–î–∞—Ç–∞:** 30 –æ–∫—Ç—è–±—Ä—è 2025  
**–î–ª—è:** Timeweb Cloud VDS/VPS
