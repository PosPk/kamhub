#!/bin/bash

# ===================================================================
# Ð‘Ð«Ð¡Ð¢Ð Ð«Ð™ Ð”Ð•ÐŸÐ›ÐžÐ™ ÐÐ VERCEL - 5 ÐœÐ˜ÐÐ£Ð¢
# Kamchatour Hub - Quick Vercel Deployment
# ===================================================================

set -e

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘          ðŸš€ Ð‘Ð«Ð¡Ð¢Ð Ð«Ð™ Ð”Ð•ÐŸÐ›ÐžÐ™ ÐÐ VERCEL                          â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Ð¦Ð²ÐµÑ‚Ð° Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð°
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m' # No Color

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð²Ñ‹Ð²Ð¾Ð´Ð° ÑˆÐ°Ð³Ð¾Ð²
step() {
    echo -e "${GREEN}âœ“${NC} $1"
}

error() {
    echo -e "${RED}âœ—${NC} $1"
}

warn() {
    echo -e "${YELLOW}âš ${NC} $1"
}

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ Node.js
if ! command -v node &> /dev/null; then
    error "Node.js Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½. Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Node.js 18+ Ñ https://nodejs.org"
    exit 1
fi

step "Node.js: $(node --version)"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ npm
if ! command -v npm &> /dev/null; then
    error "npm Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
    exit 1
fi

step "npm: $(npm --version)"

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "1ï¸âƒ£  ÐŸÐ ÐžÐ’Ð•Ð ÐšÐ ÐŸÐ ÐžÐ•ÐšÐ¢Ð"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ package.json
if [ ! -f "package.json" ]; then
    error "package.json Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð¸Ð· ÐºÐ¾Ñ€Ð½Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°."
    exit 1
fi

step "package.json Ð½Ð°Ð¹Ð´ÐµÐ½"

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
if [ ! -d "node_modules" ]; then
    echo "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹..."
    npm install
    step "Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
else
    step "Ð—Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ ÑƒÐ¶Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
fi

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° TypeScript
echo "ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° TypeScript..."
if npm run type-check; then
    step "TypeScript: ÐžÐš (0 Ð¾ÑˆÐ¸Ð±Ð¾Ðº)"
else
    warn "TypeScript Ð¸Ð¼ÐµÐµÑ‚ Ð¾ÑˆÐ¸Ð±ÐºÐ¸, Ð½Ð¾ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶Ð°ÐµÐ¼..."
fi

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "2ï¸âƒ£  Ð£Ð¡Ð¢ÐÐÐžÐ’ÐšÐ VERCEL CLI"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Vercel CLI
if ! command -v vercel &> /dev/null; then
    echo "Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Vercel CLI..."
    npm install -g vercel
    step "Vercel CLI ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
else
    step "Vercel CLI ÑƒÐ¶Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½: $(vercel --version)"
fi

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "3ï¸âƒ£  Ð›ÐžÐ“Ð˜Ð Ð’ VERCEL"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

if vercel whoami &> /dev/null; then
    step "Ð£Ð¶Ðµ Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð¾Ð²Ð°Ð½Ñ‹ ÐºÐ°Ðº: $(vercel whoami)"
else
    echo "ÐÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð° Ð°Ð²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð² Vercel..."
    vercel login
    step "ÐÐ²Ñ‚Ð¾Ñ€Ð¸Ð·Ð°Ñ†Ð¸Ñ ÑƒÑÐ¿ÐµÑˆÐ½Ð°"
fi

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "4ï¸âƒ£  ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ .env"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ñ .env
if [ ! -f ".env" ]; then
    warn ".env Ñ„Ð°Ð¹Ð» Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
    echo ""
    echo "Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ .env Ñ„Ð°Ð¹Ð» Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼Ð¸:"
    echo ""
    echo "DATABASE_URL=postgresql://user:pass@host:5432/db"
    echo "DATABASE_SSL=true"
    echo "NODE_ENV=production"
    echo "NEXT_PUBLIC_APP_URL=https://your-app.vercel.app"
    echo ""
    read -p "Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ .env ÑÐµÐ¹Ñ‡Ð°Ñ? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        cat > .env << 'EOF'
# Ð’ÐÐ–ÐÐž: Ð£ÐºÐ°Ð¶Ð¸Ñ‚Ðµ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ñ‹Ðµ Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ñ!
DATABASE_URL=postgresql://user:pass@host:5432/db
DATABASE_SSL=true
NODE_ENV=production
NEXT_PUBLIC_APP_URL=https://your-app.vercel.app
PORT=3000

# ÐžÐ¿Ñ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ (Ð¼Ð¾Ð¶Ð½Ð¾ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ð¾Ð·Ð¶Ðµ)
GROQ_API_KEY=
CLOUDPAYMENTS_PUBLIC_ID=
CLOUDPAYMENTS_API_SECRET=
YANDEX_MAPS_API_KEY=
EOF
        warn ".env ÑÐ¾Ð·Ð´Ð°Ð½. ÐžÐ‘Ð¯Ð—ÐÐ¢Ð•Ð›Ð¬ÐÐž Ð¾Ñ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÐµÐ³Ð¾ Ð¿ÐµÑ€ÐµÐ´ Ð´ÐµÐ¿Ð»Ð¾ÐµÐ¼!"
        echo "ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ .env Ð² Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¾Ñ€Ðµ Ð¸ ÑƒÐºÐ°Ð¶Ð¸Ñ‚Ðµ DATABASE_URL"
        read -p "ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Enter ÐºÐ¾Ð³Ð´Ð° Ð¾Ñ‚Ñ€ÐµÐ´Ð°ÐºÑ‚Ð¸Ñ€ÑƒÐµÑ‚Ðµ .env..."
    else
        error "Ð‘ÐµÐ· .env Ñ„Ð°Ð¹Ð»Ð° Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð½ÐµÐ²Ð¾Ð·Ð¼Ð¾Ð¶ÐµÐ½"
        exit 1
    fi
else
    step ".env Ñ„Ð°Ð¹Ð» Ð½Ð°Ð¹Ð´ÐµÐ½"
fi

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "5ï¸âƒ£  Ð”Ð•ÐŸÐ›ÐžÐ™ ÐÐ VERCEL"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

echo ""
echo "Ð—Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð´ÐµÐ¿Ð»Ð¾Ð¹..."
echo ""
warn "Ð¡Ð»ÐµÐ´ÑƒÐ¹Ñ‚Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼ Vercel CLI:"
echo "  - Set up and deploy? YES"
echo "  - Which scope? (Ð²Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð²Ð°Ñˆ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚)"
echo "  - Link to existing project? NO"
echo "  - What's your project's name? kamchatour-hub"
echo "  - In which directory? ./"
echo "  - Override settings? NO"
echo ""

# Ð”ÐµÐ¿Ð»Ð¾Ð¹
if vercel --prod; then
    step "Ð”ÐµÐ¿Ð»Ð¾Ð¹ ÑƒÑÐ¿ÐµÑˆÐµÐ½!"
else
    error "ÐžÑˆÐ¸Ð±ÐºÐ° Ð´ÐµÐ¿Ð»Ð¾Ñ"
    exit 1
fi

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo "6ï¸âƒ£  ÐÐÐ¡Ð¢Ð ÐžÐ™ÐšÐ ÐŸÐ•Ð Ð•ÐœÐ•ÐÐÐ«Ð¥ ÐžÐšÐ Ð£Ð–Ð•ÐÐ˜Ð¯"
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

echo ""
warn "Ð’ÐÐ–ÐÐž: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð² Vercel Dashboard:"
echo ""
echo "1. ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ: https://vercel.com/dashboard"
echo "2. Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾ÐµÐºÑ‚: kamchatour-hub"
echo "3. Settings â†’ Environment Variables"
echo "4. Ð”Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¸Ð· .env Ñ„Ð°Ð¹Ð»Ð°"
echo "5. Redeploy Ð¿Ñ€Ð¾ÐµÐºÑ‚ Ð¿Ð¾ÑÐ»Ðµ Ð´Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ñ…"
echo ""

read -p "ÐŸÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹? ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Enter Ð´Ð»Ñ Ñ€ÐµÐ´ÐµÐ¿Ð»Ð¾Ñ..." 

echo ""
echo "Ð ÐµÐ´ÐµÐ¿Ð»Ð¾Ð¹ Ñ Ð½Ð¾Ð²Ñ‹Ð¼Ð¸ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ð¼Ð¸..."
vercel --prod

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘                    âœ… Ð”Ð•ÐŸÐ›ÐžÐ™ Ð—ÐÐ’Ð•Ð Ð¨Ð•Ð!                        â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ðŸŽ‰ Ð’Ð°ÑˆÐµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ Ð·Ð°Ð´ÐµÐ¿Ð»Ð¾ÐµÐ½Ð¾ Ð½Ð° Vercel!"
echo ""
echo "ðŸ“‹ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
echo ""
echo "1ï¸âƒ£  ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð²Ð°ÑˆÐµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ:"
echo "   https://kamchatour-hub.vercel.app"
echo ""
echo "2ï¸âƒ£  Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð³Ð¾ Ð¿Ð°Ñ€Ñ‚Ð½ÐµÑ€Ð°:"
echo "   /auth/register-business"
echo ""
echo "3ï¸âƒ£  ÐÐ°Ñ‡Ð½Ð¸Ñ‚Ðµ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ:"
echo "   Ð¡Ð»ÐµÐ´ÑƒÐ¹Ñ‚Ðµ Ð¿Ð»Ð°Ð½Ñƒ Ð² ÐŸÐ›ÐÐ_Ð¢Ð•Ð¡Ð¢Ð˜Ð ÐžÐ’ÐÐÐ˜Ð¯_ÐŸÐÐ Ð¢ÐÐ•Ð .md"
echo ""
echo "ðŸ“„ Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸Ñ: DEPLOY_NOW_TESTING.md"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
