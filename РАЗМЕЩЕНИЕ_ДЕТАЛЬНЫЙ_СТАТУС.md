# üè® –†–ê–ó–ú–ï–©–ï–ù–ò–ï - –î–ï–¢–ê–õ–¨–ù–´–ô –°–¢–ê–¢–£–° –ò –ü–õ–ê–ù

**–î–∞—Ç–∞:** 2025-11-04  
**–†–∞–∑–¥–µ–ª:** Stay Hub (–ú–µ—Å—Ç–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è)  
**–¢–µ–∫—É—â–∞—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 40%

---

## üìä –¢–ï–ö–£–©–ï–ï –°–û–°–¢–û–Ø–ù–ò–ï

### ‚úÖ –ß–¢–û –£–ñ–ï –ï–°–¢–¨

#### 1. UI –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å (40%)
**–§–∞–π–ª:** `/app/hub/stay/page.tsx`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å Protected route
- ‚úÖ Header —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∏ –æ–ø–∏—Å–∞–Ω–∏–µ–º
- ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≤–∫–ª–∞–¥–æ–∫ (4 –≤–∫–ª–∞–¥–∫–∏)
  - –û–±—ä–µ–∫—Ç—ã
  - –ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
  - –û—Ç–∑—ã–≤—ã
- ‚úÖ –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- ‚úÖ Premium —Å—Ç–∏–ª—å (—á–µ—Ä–Ω—ã–π + –∑–æ–ª–æ—Ç–æ)

**–ü—Ä–æ–±–ª–µ–º–∞:** –í—Å–µ –≤–∫–ª–∞–¥–∫–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –∑–∞–≥–ª—É—à–∫–∏ "–∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è..."

```tsx
<div className="text-center text-white/70 py-8">
  <div className="text-4xl mb-2">üè®</div>
  <p>–û–±—ä–µ–∫—Ç—ã —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è...</p>
</div>
```

---

#### 2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (20%)
**–§–∞–π–ª:** `/lib/database/schema.sql`

**–ß—Ç–æ –µ—Å—Ç—å:**
- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `partners` —Å category `'stay'`
  - –ú–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –æ—Ç–µ–ª–∏/–±–∞–∑—ã –∫–∞–∫ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
  - –ï—Å—Ç—å –ø–æ–ª—è: name, description, contact, rating
  - –ï—Å—Ç—å —Å–≤—è–∑—å —Å assets (–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ partners:**
```sql
CREATE TABLE IF NOT EXISTS partners (
    id UUID PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    category VARCHAR(50) CHECK (category IN ('stay', ...)),
    description TEXT,
    contact JSONB NOT NULL,
    rating DECIMAL(3,2) DEFAULT 0.0,
    review_count INTEGER DEFAULT 0,
    is_verified BOOLEAN DEFAULT FALSE,
    logo_asset_id UUID,
    created_at TIMESTAMPTZ,
    updated_at TIMESTAMPTZ
);
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ—Å—Ç—å, –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å.

---

### ‚ùå –ß–ï–ì–û –ù–ï–¢ (60%)

#### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è (0%)

**–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫—Ä–∏—Ç–∏—á–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã:**

##### ‚ùå `accommodations` - –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–∞—Ö
```sql
-- –ù–£–ñ–ù–û –°–û–ó–î–ê–¢–¨
CREATE TABLE accommodations (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    partner_id UUID REFERENCES partners(id),
    type VARCHAR(50) NOT NULL, -- hotel, hostel, resort, apartment, cabin
    address TEXT NOT NULL,
    latitude DECIMAL(10,8),
    longitude DECIMAL(11,8),
    price_per_night DECIMAL(10,2) NOT NULL,
    currency VARCHAR(3) DEFAULT 'RUB',
    max_guests INTEGER NOT NULL,
    total_rooms INTEGER NOT NULL,
    amenities JSONB DEFAULT '[]', -- WiFi, parking, breakfast, etc.
    check_in_time TIME DEFAULT '14:00',
    check_out_time TIME DEFAULT '12:00',
    policies JSONB DEFAULT '{}', -- cancellation, pets, smoking, etc.
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

##### ‚ùå `accommodation_rooms` - –¢–∏–ø—ã –Ω–æ–º–µ—Ä–æ–≤
```sql
-- –ù–£–ñ–ù–û –°–û–ó–î–ê–¢–¨
CREATE TABLE accommodation_rooms (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    accommodation_id UUID REFERENCES accommodations(id),
    room_type VARCHAR(100) NOT NULL, -- standard, deluxe, suite
    description TEXT,
    price_per_night DECIMAL(10,2) NOT NULL,
    max_guests INTEGER NOT NULL,
    quantity INTEGER NOT NULL, -- –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–∞–∫–∏—Ö –Ω–æ–º–µ—Ä–æ–≤
    amenities JSONB DEFAULT '[]',
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

##### ‚ùå `accommodation_bookings` - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
```sql
-- –ù–£–ñ–ù–û –°–û–ó–î–ê–¢–¨
CREATE TABLE accommodation_bookings (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    accommodation_id UUID REFERENCES accommodations(id),
    room_id UUID REFERENCES accommodation_rooms(id),
    user_id UUID REFERENCES users(id),
    check_in DATE NOT NULL,
    check_out DATE NOT NULL,
    guests INTEGER NOT NULL,
    total_nights INTEGER NOT NULL,
    price_per_night DECIMAL(10,2) NOT NULL,
    total_amount DECIMAL(10,2) NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'pending',
        -- pending, confirmed, cancelled, completed
    special_requests TEXT,
    payment_status VARCHAR(20) DEFAULT 'pending',
    payment_method VARCHAR(50),
    contact_info JSONB NOT NULL,
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

##### ‚ùå `accommodation_availability` - –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
```sql
-- –ù–£–ñ–ù–û –°–û–ó–î–ê–¢–¨
CREATE TABLE accommodation_availability (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    room_id UUID REFERENCES accommodation_rooms(id),
    date DATE NOT NULL,
    available_count INTEGER NOT NULL,
    price_override DECIMAL(10,2), -- –æ—Å–æ–±–∞—è —Ü–µ–Ω–∞ –¥–ª—è —ç—Ç–æ–π –¥–∞—Ç—ã
    is_blocked BOOLEAN DEFAULT FALSE,
    UNIQUE(room_id, date)
);
```

##### ‚ùå `accommodation_reviews` - –û—Ç–∑—ã–≤—ã
```sql
-- –ù–£–ñ–ù–û –°–û–ó–î–ê–¢–¨
CREATE TABLE accommodation_reviews (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    accommodation_id UUID REFERENCES accommodations(id),
    booking_id UUID REFERENCES accommodation_bookings(id),
    user_id UUID REFERENCES users(id),
    rating INTEGER CHECK (rating >= 1 AND rating <= 5),
    cleanliness_rating INTEGER CHECK (cleanliness_rating >= 1 AND cleanliness_rating <= 5),
    location_rating INTEGER CHECK (location_rating >= 1 AND location_rating <= 5),
    service_rating INTEGER CHECK (service_rating >= 1 AND service_rating <= 5),
    value_rating INTEGER CHECK (value_rating >= 1 AND value_rating <= 5),
    comment TEXT,
    pros TEXT,
    cons TEXT,
    created_at TIMESTAMPTZ DEFAULT NOW()
);
```

##### ‚ùå `user_favorites` - –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
```sql
-- –ù–£–ñ–ù–û –°–û–ó–î–ê–¢–¨
CREATE TABLE user_favorites (
    user_id UUID REFERENCES users(id),
    accommodation_id UUID REFERENCES accommodations(id),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    PRIMARY KEY (user_id, accommodation_id)
);
```

---

#### 2. API Endpoints (0%)

**–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:**

```
‚ùå GET    /api/accommodations/search
   - –ü–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
   - –§–∏–ª—å—Ç—Ä—ã: –¥–∞—Ç—ã, –≥–æ—Å—Ç–∏, —Ü–µ–Ω–∞, —É–¥–æ–±—Å—Ç–≤–∞, —Ç–∏–ø
   - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Ü–µ–Ω–∞, —Ä–µ–π—Ç–∏–Ω–≥, –ø–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å

‚ùå GET    /api/accommodations/:id
   - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–±—ä–µ–∫—Ç–µ
   - –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏, —É–¥–æ–±—Å—Ç–≤–∞, –æ—Ç–∑—ã–≤—ã
   - –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–æ–º–µ—Ä–æ–≤

‚ùå POST   /api/accommodations/check-availability
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞ –¥–∞—Ç—ã
   - –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
   - –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –Ω–æ–º–µ—Ä–æ–≤

‚ùå POST   /api/accommodations/book
   - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç –∏ –≥–æ—Å—Ç–µ–π
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏
   - Race condition protection

‚ùå GET    /api/accommodations/bookings
   - –°–ø–∏—Å–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –§–∏–ª—å—Ç—Ä—ã: upcoming, past, cancelled
   - –ò—Å—Ç–æ—Ä–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

‚ùå PUT    /api/accommodations/bookings/:id
   - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –í–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤

‚ùå GET    /api/accommodations/favorites
   - –ò–∑–±—Ä–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

‚ùå POST   /api/accommodations/favorites
   - –î–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ

‚ùå DELETE /api/accommodations/favorites/:id
   - –£–¥–∞–ª–∏—Ç—å –∏–∑ –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ

‚ùå GET    /api/accommodations/:id/reviews
   - –û—Ç–∑—ã–≤—ã –æ–± –æ–±—ä–µ–∫—Ç–µ
   - –ü–∞–≥–∏–Ω–∞—Ü–∏—è
   - –§–∏–ª—å—Ç—Ä—ã –ø–æ —Ä–µ–π—Ç–∏–Ω–≥—É

‚ùå POST   /api/accommodations/reviews
   - –û—Å—Ç–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
   - –¢–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è
```

---

#### 3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (0%)

**–ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:**

```typescript
‚ùå AccommodationCard.tsx
   - –ö–∞—Ä—Ç–æ—á–∫–∞ –æ–±—ä–µ–∫—Ç–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
   - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ä–µ–π—Ç–∏–Ω–≥
   - –¶–µ–Ω–∞ –∑–∞ –Ω–æ—á—å
   - –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"

‚ùå AccommodationDetails.tsx
   - –ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –æ–±—ä–µ–∫—Ç–∞
   - –ì–∞–ª–µ—Ä–µ—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
   - –û–ø–∏—Å–∞–Ω–∏–µ –∏ —É–¥–æ–±—Å—Ç–≤–∞
   - –ö–∞—Ä—Ç–∞ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è
   - –ë–ª–æ–∫ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

‚ùå AccommodationFilters.tsx
   - –§–∏–ª—å—Ç—Ä—ã –ø–æ–∏—Å–∫–∞
   - –î–∞—Ç—ã (check-in, check-out)
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π
   - –î–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω
   - –¢–∏–ø—ã —Ä–∞–∑–º–µ—â–µ–Ω–∏—è
   - –£–¥–æ–±—Å—Ç–≤–∞ (WiFi, parking, etc.)

‚ùå AccommodationCalendar.tsx
   - –ö–∞–ª–µ–Ω–¥–∞—Ä—å –≤—ã–±–æ—Ä–∞ –¥–∞—Ç
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
   - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ –Ω–æ—á–µ–π
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã—Ö –¥–∞—Ç

‚ùå BookingForm.tsx
   - –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –í—ã–±–æ—Ä –Ω–æ–º–µ—Ä–∞
   - –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
   - –û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
   - –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –æ–ø–ª–∞—Ç–æ–π

‚ùå BookingCard.tsx
   - –ö–∞—Ä—Ç–æ—á–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –°—Ç–∞—Ç—É—Å, –¥–∞—Ç—ã, —Å—É–º–º–∞
   - –ö–Ω–æ–ø–∫–∏: –æ—Ç–º–µ–Ω–∏—Ç—å, –∏–∑–º–µ–Ω–∏—Ç—å, –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å

‚ùå ReviewCard.tsx
   - –ö–∞—Ä—Ç–æ—á–∫–∞ –æ—Ç–∑—ã–≤–∞
   - –†–µ–π—Ç–∏–Ω–≥, —Ç–µ–∫—Å—Ç, –∞–≤—Ç–æ—Ä
   - –î–∞—Ç–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è

‚ùå FavoriteButton.tsx
   - –ö–Ω–æ–ø–∫–∞ "–í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ"
   - Toggle —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
```

---

#### 4. –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (0%)

**–ù–µ—Ç —Ñ–∞–π–ª–æ–≤ –≤ `/lib`:**

```typescript
‚ùå lib/accommodations/search.ts
   - –õ–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞
   - –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ SQL –∑–∞–ø—Ä–æ—Å–æ–≤
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞

‚ùå lib/accommodations/booking.ts
   - –õ–æ–≥–∏–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
   - Race condition protection
   - –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏

‚ùå lib/accommodations/availability.ts
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é
   - –ö–∞–ª–µ–Ω–¥–∞—Ä—å
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç

‚ùå lib/accommodations/reviews.ts
   - –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∑—ã–≤–∞–º–∏
   - –í–∞–ª–∏–¥–∞—Ü–∏—è
   - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤

‚ùå lib/accommodations/favorites.ts
   - –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
   - CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
```

---

## üéØ –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨

### –≠–¢–ê–ü 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (1-2 –¥–Ω—è)

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
```sql
1. accommodations - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –¥–ª—è partners
2. accommodation_rooms - —Ç–∏–ø—ã –Ω–æ–º–µ—Ä–æ–≤
3. accommodation_bookings - –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
4. accommodation_availability - –∫–∞–ª–µ–Ω–¥–∞—Ä—å
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
```sql
5. accommodation_reviews - –æ—Ç–∑—ã–≤—ã
6. user_favorites - –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
```

#### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –ò–Ω–¥–µ–∫—Å—ã –∏ —Ç—Ä–∏–≥–≥–µ—Ä—ã
```sql
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –¥–∞—Ç–∞–º
- –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è location (lat/lng)
- –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–æ–≤
- –¢—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è updated_at
```

#### –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:
`/lib/database/accommodations_schema.sql`

---

### –≠–¢–ê–ü 2: API Endpoints (2-3 –¥–Ω—è)

#### –î–µ–Ω—å 1: –ü–æ–∏—Å–∫ –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä
```
1. GET  /api/accommodations/search       ‚ö° –ö—Ä–∏—Ç–∏—á–Ω–æ
2. GET  /api/accommodations/:id          ‚ö° –ö—Ä–∏—Ç–∏—á–Ω–æ
3. POST /api/accommodations/check-availability
```

#### –î–µ–Ω—å 2: –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```
4. POST /api/accommodations/book         ‚ö° –ö—Ä–∏—Ç–∏—á–Ω–æ
5. GET  /api/accommodations/bookings
6. PUT  /api/accommodations/bookings/:id
```

#### –î–µ–Ω—å 3: –ò–∑–±—Ä–∞–Ω–Ω–æ–µ –∏ –æ—Ç–∑—ã–≤—ã
```
7. GET/POST/DELETE /api/accommodations/favorites
8. GET/POST /api/accommodations/reviews
```

---

### –≠–¢–ê–ü 3: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (2 –¥–Ω—è)

#### –î–µ–Ω—å 1: –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
```typescript
1. AccommodationCard.tsx        ‚ö° –ö—Ä–∏—Ç–∏—á–Ω–æ
2. AccommodationFilters.tsx     ‚ö° –ö—Ä–∏—Ç–∏—á–Ω–æ
3. AccommodationCalendar.tsx    ‚ö° –ö—Ä–∏—Ç–∏—á–Ω–æ
```

#### –î–µ–Ω—å 2: –§–æ—Ä–º–∞ –∏ –¥–µ—Ç–∞–ª–∏
```typescript
4. BookingForm.tsx              ‚ö° –ö—Ä–∏—Ç–∏—á–Ω–æ
5. AccommodationDetails.tsx
6. BookingCard.tsx
7. ReviewCard.tsx
8. FavoriteButton.tsx
```

---

### –≠–¢–ê–ü 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Stay Hub (1 –¥–µ–Ω—å)

#### –û–±–Ω–æ–≤–∏—Ç—å `/app/hub/stay/page.tsx`

```typescript
// –í–º–µ—Å—Ç–æ –∑–∞–≥–ª—É—à–µ–∫ –¥–æ–±–∞–≤–∏—Ç—å:

1. –í–∫–ª–∞–¥–∫–∞ "–û–±—ä–µ–∫—Ç—ã":
   - –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - –°–ø–∏—Å–æ–∫ AccommodationCard
   - –ü–∞–≥–∏–Ω–∞—Ü–∏—è

2. –í–∫–ª–∞–¥–∫–∞ "–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è":
   - –°–ø–∏—Å–æ–∫ BookingCard
   - –§–∏–ª—å—Ç—Ä—ã: –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ/–ø—Ä–æ—à–ª—ã–µ
   - –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

3. –í–∫–ª–∞–¥–∫–∞ "–ò–∑–±—Ä–∞–Ω–Ω–æ–µ":
   - –°–ø–∏—Å–æ–∫ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö AccommodationCard
   - –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å"

4. –í–∫–ª–∞–¥–∫–∞ "–û—Ç–∑—ã–≤—ã":
   - –°–ø–∏—Å–æ–∫ –æ—Ç–∑—ã–≤–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   - –§–æ—Ä–º–∞ –Ω–æ–≤–æ–≥–æ –æ—Ç–∑—ã–≤–∞
```

---

### –≠–¢–ê–ü 5: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (1 –¥–µ–Ω—å)

```
1. CloudPayments - –ø–ª–∞—Ç–µ–∂–∏ –∑–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
2. Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
3. SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è - –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
4. Yandex Maps - –∫–∞—Ä—Ç—ã –æ–±—ä–µ–∫—Ç–æ–≤
```

---

## üìã –î–ï–¢–ê–õ–¨–ù–´–ô –ü–õ–ê–ù –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

### –ù–ï–î–ï–õ–Ø 1 (5 –¥–Ω–µ–π)

#### –î–µ–Ω—å 1: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- [ ] –°–æ–∑–¥–∞—Ç—å `accommodations_schema.sql`
- [ ] 6 —Ç–∞–±–ª–∏—Ü —Å –∏–Ω–¥–µ–∫—Å–∞–º–∏
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ test –ë–î
- [ ] Seed –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤

**Deliverable:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

#### –î–µ–Ω—å 2: API - –ü–æ–∏—Å–∫
- [ ] `/api/accommodations/search/route.ts`
  - –ü–æ–∏—Å–∫ –ø–æ –¥–∞—Ç–∞–º, –≥–æ—Å—Ç—è–º, —Ü–µ–Ω–µ
  - –§–∏–ª—å—Ç—Ä—ã –ø–æ —É–¥–æ–±—Å—Ç–≤–∞–º
  - –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
  - –ü–∞–≥–∏–Ω–∞—Ü–∏—è
- [ ] `/api/accommodations/[id]/route.ts`
  - –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  - –°–≤—è–∑–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (reviews, rooms)
- [ ] `lib/accommodations/search.ts`
  - –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø–æ–∏—Å–∫–∞

**Deliverable:** –†–∞–±–æ—Ç–∞—é—â–∏–π –ø–æ–∏—Å–∫ –æ–±—ä–µ–∫—Ç–æ–≤

---

#### –î–µ–Ω—å 3: API - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] `/api/accommodations/check-availability/route.ts`
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
  - –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
- [ ] `/api/accommodations/book/route.ts`
  - –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - Race condition protection
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç
- [ ] `lib/accommodations/booking.ts`
  - `checkAvailability()`
  - `createBooking()`
  - `updateAvailability()`

**Deliverable:** –†–∞–±–æ—Ç–∞—é—â–µ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

---

#### –î–µ–Ω—å 4: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã - –ü–æ–∏—Å–∫ –∏ –∫–∞—Ä—Ç–æ—á–∫–∏
- [ ] `AccommodationCard.tsx`
  - –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –Ω–∞–∑–≤–∞–Ω–∏–µ, —Ä–µ–π—Ç–∏–Ω–≥
  - –¶–µ–Ω–∞ –∑–∞ –Ω–æ—á—å
  - –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
  - –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω
- [ ] `AccommodationFilters.tsx`
  - Date picker (check-in/out)
  - Guests selector
  - Price range slider
  - Amenities checkboxes
- [ ] `AccommodationCalendar.tsx`
  - React Date Picker –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
  - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç
  - –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª-–≤–æ –Ω–æ—á–µ–π

**Deliverable:** UI –¥–ª—è –ø–æ–∏—Å–∫–∞ –≥–æ—Ç–æ–≤

---

#### –î–µ–Ω—å 5: –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã - –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] `BookingForm.tsx`
  - –í—ã–±–æ—Ä –Ω–æ–º–µ—Ä–∞
  - –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è —Ñ–æ—Ä–º–∞
  - –û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
  - –†–∞—Å—á–µ—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—Ç–æ–∏–º–æ—Å—Ç–∏
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CloudPayments
- [ ] `BookingCard.tsx`
  - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏
  - –°—Ç–∞—Ç—É—Å —Å —Ü–≤–µ—Ç–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ü–∏–µ–π
  - –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- [ ] `AccommodationDetails.tsx`
  - –ì–∞–ª–µ—Ä–µ—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ
  - –ö–∞—Ä—Ç–∞ Yandex Maps
  - –°–ø–∏—Å–æ–∫ —É–¥–æ–±—Å—Ç–≤
  - –ë–ª–æ–∫ –æ—Ç–∑—ã–≤–æ–≤

**Deliverable:** –ü–æ–ª–Ω—ã–π UI –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

---

### –ù–ï–î–ï–õ–Ø 2 (2 –¥–Ω—è)

#### –î–µ–Ω—å 6: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ –¥–æ–ø. —Ñ—É–Ω–∫—Ü–∏–∏
- [ ] API –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
  - GET/POST/DELETE endpoints
- [ ] API –¥–ª—è –æ—Ç–∑—ã–≤–æ–≤
  - GET/POST endpoints
  - –í–∞–ª–∏–¥–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è)
- [ ] `ReviewCard.tsx`
- [ ] `FavoriteButton.tsx`
- [ ] –û–±–Ω–æ–≤–∏—Ç—å `/app/hub/stay/page.tsx`
  - –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–º–µ—Å—Ç–æ –∑–∞–≥–ª—É—à–µ–∫
  - –í—Å–µ 4 –≤–∫–ª–∞–¥–∫–∏ –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã

**Deliverable:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π Stay Hub

---

#### –î–µ–Ω—å 7: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
- [ ] CloudPayments –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
  - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ –¥–µ–Ω—å
  - –û—Ç–º–µ–Ω–∞
- [ ] SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
  - Unit —Ç–µ—Å—Ç—ã –¥–ª—è API
  - E2E —Ç–µ—Å—Ç—ã –¥–ª—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
  - Race condition —Ç–µ—Å—Ç—ã
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**Deliverable:** Production-ready —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
// lib/accommodations/booking.ts

export async function checkAvailability(
  roomId: string,
  checkIn: Date,
  checkOut: Date,
  guests: number
): Promise<AvailabilityResult> {
  const client = await pool.connect();
  
  try {
    // 1. –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –Ω–æ–º–µ—Ä–µ
    const room = await getRoomDetails(roomId);
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π
    if (guests > room.max_guests) {
      return { available: false, reason: 'Too many guests' };
    }
    
    // 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –Ω–∞ –∫–∞–∂–¥—É—é –¥–∞—Ç—É
    const nights = calculateNights(checkIn, checkOut);
    const availabilityQuery = `
      SELECT date, available_count
      FROM accommodation_availability
      WHERE room_id = $1
        AND date >= $2
        AND date < $3
    `;
    
    const availability = await client.query(availabilityQuery, [
      roomId,
      checkIn,
      checkOut
    ]);
    
    // 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –Ω–∞ –≤—Å–µ –¥–∞—Ç—ã –µ—Å—Ç—å —Å–≤–æ–±–æ–¥–Ω—ã–µ –Ω–æ–º–µ—Ä–∞
    for (let row of availability.rows) {
      if (row.available_count < 1) {
        return { 
          available: false, 
          reason: 'Not available on ' + row.date 
        };
      }
    }
    
    // 5. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å—Ç–æ–∏–º–æ—Å—Ç—å
    const totalAmount = await calculateTotalAmount(
      roomId, 
      checkIn, 
      checkOut
    );
    
    return {
      available: true,
      roomId,
      checkIn,
      checkOut,
      nights,
      pricePerNight: room.price_per_night,
      totalAmount
    };
    
  } finally {
    client.release();
  }
}

export async function createBooking(
  bookingData: BookingRequest
): Promise<BookingResult> {
  const client = await pool.connect();
  
  try {
    await client.query('BEGIN');
    
    // 1. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è race condition protection
    await client.query(`
      SELECT id FROM accommodation_rooms
      WHERE id = $1
      FOR UPDATE NOWAIT
    `, [bookingData.roomId]);
    
    // 2. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
    const availability = await checkAvailability(
      bookingData.roomId,
      bookingData.checkIn,
      bookingData.checkOut,
      bookingData.guests
    );
    
    if (!availability.available) {
      throw new Error('Room no longer available');
    }
    
    // 3. –°–æ–∑–¥–∞—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
    const booking = await client.query(`
      INSERT INTO accommodation_bookings (
        accommodation_id,
        room_id,
        user_id,
        check_in,
        check_out,
        guests,
        total_nights,
        price_per_night,
        total_amount,
        status,
        contact_info
      ) VALUES ($1, $2, $3, $4, $5, $6, $7, $8, $9, $10, $11)
      RETURNING *
    `, [
      bookingData.accommodationId,
      bookingData.roomId,
      bookingData.userId,
      bookingData.checkIn,
      bookingData.checkOut,
      bookingData.guests,
      availability.nights,
      availability.pricePerNight,
      availability.totalAmount,
      'pending',
      bookingData.contactInfo
    ]);
    
    // 4. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
    await client.query(`
      UPDATE accommodation_availability
      SET available_count = available_count - 1
      WHERE room_id = $1
        AND date >= $2
        AND date < $3
    `, [bookingData.roomId, bookingData.checkIn, bookingData.checkOut]);
    
    await client.query('COMMIT');
    
    // 5. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    await sendBookingConfirmation(booking.rows[0]);
    
    return {
      success: true,
      booking: booking.rows[0]
    };
    
  } catch (error) {
    await client.query('ROLLBACK');
    throw error;
  } finally {
    client.release();
  }
}
```

---

### Race Condition Protection

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –±—Ä–æ–Ω–∏—Ä—É—é—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —Å–≤–æ–±–æ–¥–Ω—ã–π –Ω–æ–º–µ—Ä.

**–†–µ—à–µ–Ω–∏–µ:**
1. `SELECT FOR UPDATE NOWAIT` - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏
2. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
3. –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `available_count`

---

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CloudPayments

```typescript
// –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
const booking = await createBooking(bookingData);

// –ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂–Ω—É—é —Å—Å—ã–ª–∫—É
const paymentLink = await cloudPayments.createPayment({
  amount: booking.total_amount,
  currency: 'RUB',
  description: `–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ #${booking.id}`,
  accountId: userId,
  invoiceId: booking.id,
  email: bookingData.contactInfo.email
});

// –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã (webhook)
await confirmBooking(booking.id);
await sendBookingConfirmation(booking);
```

---

## üìä –û–¶–ï–ù–ö–ê –†–ê–ë–û–¢

### –í—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

| –≠—Ç–∞–ø | –ó–∞–¥–∞—á–∏ | –í—Ä–µ–º—è | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|------|--------|-------|-----------|
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | 6 —Ç–∞–±–ª–∏—Ü + –∏–Ω–¥–µ–∫—Å—ã | 1-2 –¥–Ω—è | üü° –°—Ä–µ–¥–Ω—è—è |
| **API Endpoints** | 10+ endpoints | 2-3 –¥–Ω—è | üî¥ –í—ã—Å–æ–∫–∞—è |
| **–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã** | 8+ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ | 2 –¥–Ω—è | üü° –°—Ä–µ–¥–Ω—è—è |
| **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** | Stay Hub + –ø–ª–∞—Ç–µ–∂–∏ | 1 –¥–µ–Ω—å | üü¢ –ù–∏–∑–∫–∞—è |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | Unit + E2E —Ç–µ—Å—Ç—ã | 1 –¥–µ–Ω—å | üü° –°—Ä–µ–¥–Ω—è—è |
| **–ò–¢–û–ì–û** | | **7-9 –¥–Ω–µ–π** | |

### –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞: **1.5-2 –Ω–µ–¥–µ–ª–∏**

---

## üéØ MVP –§–£–ù–ö–¶–ò–û–ù–ê–õ (–ú–∏–Ω–∏–º—É–º)

### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:

**–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ (5 –¥–Ω–µ–π):**
1. ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (accommodations, bookings, rooms)
2. ‚úÖ API –ø–æ–∏—Å–∫–∞
3. ‚úÖ API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
4. ‚úÖ AccommodationCard + Filters
5. ‚úÖ BookingForm

**–ú–æ–∂–Ω–æ –æ—Ç–ª–æ–∂–∏—Ç—å:**
- –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
- –†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ—Ç–∑—ã–≤—ã
- –°–ª–æ–∂–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ (visual)

---

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

### –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –±—ã—Å—Ç—Ä–æ (3 –¥–Ω—è):

#### –î–µ–Ω—å 1:
```sql
-- –°–æ–∑–¥–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é —Å—Ö–µ–º—É –ë–î
- accommodations (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
- accommodation_bookings
- –ò–Ω–¥–µ–∫—Å—ã
```

#### –î–µ–Ω—å 2:
```typescript
// API endpoints
- POST /api/accommodations/search (–±–∞–∑–æ–≤—ã–π)
- POST /api/accommodations/book (—Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏)
```

#### –î–µ–Ω—å 3:
```typescript
// UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- AccommodationCard
- Simple booking form
- –û–±–Ω–æ–≤–∏—Ç—å Stay Hub page
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ë–∞–∑–æ–≤–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ.

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ö—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∑–∞–ø—É—Å–∫–∞
1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (accommodations + bookings)
2. API –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å race condition protection
3. –§–æ—Ä–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CloudPayments

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –í–∞–∂–Ω–æ, –Ω–æ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
5. –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
6. –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
7. Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: Nice to have
8. –ò–∑–±—Ä–∞–Ω–Ω–æ–µ
9. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—ã–µ –æ—Ç–∑—ã–≤—ã
10. SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

---

## üìû –ò–¢–û–ì–û

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
```
‚úÖ UI —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:      40%
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:       20% (—Ç–æ–ª—å–∫–æ partners)
‚ùå API:               0%
‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:        0%
‚ùå –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞:     0%

–û–ë–©–ê–Ø –ì–û–¢–û–í–ù–û–°–¢–¨:    40%
```

### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è 100%:
```
1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:       1-2 –¥–Ω—è
2. API endpoints:     2-3 –¥–Ω—è
3. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:        2 –¥–Ω—è
4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:        1 –¥–µ–Ω—å
5. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:      1 –¥–µ–Ω—å

–ò–¢–û–ì–û:                7-9 –¥–Ω–µ–π (1.5-2 –Ω–µ–¥–µ–ª–∏)
```

### –î–ª—è MVP (–∑–∞–ø—É—Å—Ç–∏—Ç—å –±—ã—Å—Ç—Ä–æ):
```
–ö–†–ò–¢–ò–ß–ù–û:             5 –¥–Ω–µ–π
MVP –ì–û–¢–û–í–ù–û–°–¢–¨:       3 –¥–Ω—è (—É—Å–∫–æ—Ä–µ–Ω–Ω–∞—è)
```

---

**–î–∞—Ç–∞:** 2025-11-04  
**–°—Ç–∞—Ç—É—Å:** üìã –ü–ª–∞–Ω —Å–æ—Å—Ç–∞–≤–ª–µ–Ω  
**–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å:** 40% ‚Üí 100% –∑–∞ 7-9 –¥–Ω–µ–π
