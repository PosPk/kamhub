#!/bin/bash

# ================================================
# SSH ПОДКЛЮЧЕНИЕ К TIMEWEB
# ================================================

set -e

echo "╔═══════════════════════════════════════════════════════════════╗"
echo "║                                                               ║"
echo "║         🔐 ПОДКЛЮЧЕНИЕ К TIMEWEB ПО SSH                      ║"
echo "║                                                               ║"
echo "╚═══════════════════════════════════════════════════════════════╝"
echo ""

# Цвета
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

# ================================================
# ОПРЕДЕЛЕНИЕ ТИПА ПОДКЛЮЧЕНИЯ
# ================================================

echo "Выберите тип подключения:"
echo ""
echo "  1) Timeweb Cloud Apps (приложение)"
echo "  2) Timeweb VDS (сервер)"
echo "  3) Custom (ввести вручную)"
echo ""
read -p "Ваш выбор (1-3): " choice

case $choice in
  1)
    HOST="kamchatour-125051.timeweb.cloud"
    USER="app"
    PORT=22
    echo -e "${GREEN}✓${NC} Подключение к Timeweb Cloud Apps"
    ;;
  2)
    read -p "Введите IP адрес VDS: " HOST
    USER="root"
    PORT=22
    echo -e "${GREEN}✓${NC} Подключение к Timeweb VDS"
    ;;
  3)
    read -p "Host: " HOST
    read -p "User: " USER
    read -p "Port (22): " PORT
    PORT=${PORT:-22}
    echo -e "${GREEN}✓${NC} Custom подключение"
    ;;
  *)
    echo "Неверный выбор"
    exit 1
    ;;
esac

echo ""

# ================================================
# ПРОВЕРКА ДОСТУПНОСТИ
# ================================================

echo -e "${BLUE}▶${NC} Проверка доступности $HOST..."

if ping -c 1 -W 2 "$HOST" > /dev/null 2>&1; then
  echo -e "${GREEN}✓${NC} Хост доступен"
else
  echo -e "${YELLOW}⚠${NC} Хост не отвечает на ping (может быть firewall)"
fi

echo ""

# ================================================
# ПОДКЛЮЧЕНИЕ
# ================================================

echo "═══════════════════════════════════════════════════════════════"
echo ""
echo "Подключаюсь к: ${USER}@${HOST}:${PORT}"
echo ""
echo "💡 После подключения попробуйте:"
echo ""
echo "  ls -la              # Посмотреть файлы"
echo "  npm run migrate:up  # Применить миграции"
echo "  pm2 logs            # Посмотреть логи"
echo "  printenv            # Переменные окружения"
echo ""
echo "═══════════════════════════════════════════════════════════════"
echo ""

# Подключение
ssh -p "$PORT" "${USER}@${HOST}"
