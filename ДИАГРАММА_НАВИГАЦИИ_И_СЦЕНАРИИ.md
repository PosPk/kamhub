# 🎨 ВИЗУАЛЬНАЯ ДИАГРАММА НАВИГАЦИИ И СЦЕНАРИИ ИСПОЛЬЗОВАНИЯ

**Проект:** KamHub  
**Тип документа:** Визуальные схемы и детальные user flows  
**Дата:** 30 октября 2025

---

# 🗺️ ПОЛНАЯ КАРТА НАВИГАЦИИ

```
                    ┌─────────────────────────────────────────┐
                    │        KAMHUB ПЛАТФОРМА                 │
                    │    https://kamhub.timeweb.cloud         │
                    └──────────────────┬──────────────────────┘
                                       │
                    ┌──────────────────┴──────────────────┐
                    │                                      │
            ┌───────▼─────────┐              ┌───────────▼──────────┐
            │  ПУБЛИЧНАЯ ЗОНА │              │   ЗАЩИЩЁННАЯ ЗОНА    │
            │  (Guest Access) │              │  (Auth Required)     │
            └───────┬─────────┘              └───────────┬──────────┘
                    │                                    │
        ┌───────────┼───────────┐                       │
        │           │           │                       │
    ┌───▼───┐  ┌───▼───┐  ┌───▼────┐                  │
    │   /   │  │ /demo │  │ /auth/ │                  │
    │ Home  │  │       │  │ login  │                  │
    └───┬───┘  └───┬───┘  └───┬────┘                  │
        │          │           │                       │
        └──────────┴───────────┴───────────────────────┘
                               │
                  ┌────────────▼────────────┐
                  │  АУТЕНТИФИКАЦИЯ (JWT)   │
                  │  POST /api/auth/signin  │
                  └────────────┬────────────┘
                               │
        ┌──────────────────────┼──────────────────────┐
        │                      │                      │
   ┌────▼────┐          ┌─────▼──────┐        ┌─────▼──────┐
   │ ТУРИСТ  │          │  ОПЕРАТОР  │        │    ГИД     │
   │ tourist │          │  operator  │        │   guide    │
   └────┬────┘          └─────┬──────┘        └─────┬──────┘
        │                     │                      │
        │                     │                      │
   ┌────▼─────────┐     ┌────▼─────────┐      ┌────▼─────────┐
   │/hub/tourist  │     │/hub/operator │      │/hub/guide    │
   │              │     │              │      │              │
   │ Функции:     │     │ Функции:     │      │ Функции:     │
   │ • Бронир.    │     │ • CRM        │      │ • Расписание │
   │ • Трансферы  │     │ • Туры       │      │ • Группы     │
   │ • Лояльность │     │ • Гиды       │      │ • Доходы     │
   │ • Eco-points │     │ • Аналитика  │      │ • Отзывы     │
   │ • AI-чат     │     │ • Погода     │      │ • Погода     │
   └────┬─────────┘     └────┬─────────┘      └────┬─────────┘
        │                     │                      │
        │                     │                      │
        │                     │                      │
   ┌────▼────┐          ┌─────▼──────┐        ┌─────▼──────┐
   │ТРАНСФЕР │          │    АГЕНТ   │        │   ADMIN    │
   │transfer │          │   agent    │        │   admin    │
   └────┬────┘          └─────┬──────┘        └─────┬──────┘
        │                     │                      │
        │                     │                      │
   ┌────▼─────────┐     ┌────▼─────────┐      ┌────▼─────────┐
   │/hub/transfer │     │/hub/agent    │      │/hub/admin    │
   │/hub/transfer-│     │              │      │              │
   │   operator   │     │ Функции:     │      │ Функции:     │
   │              │     │ • Группы     │      │ • Модерация  │
   │ Функции:     │     │ • Ваучеры    │      │ • Пользов.   │
   │ • Маршруты   │     │ • Комиссии   │      │ • Финансы    │
   │ • Транспорт  │     │ • GDS        │      │ • Мониторинг │
   │ • Водители   │     │ • B2B        │      │ • Аудит      │
   │ • AI Match   │     │ • White Label│      │ • Система    │
   │ • Аналитика  │     │              │      │              │
   └────┬─────────┘     └────┬─────────┘      └────┬─────────┘
        │                     │                      │
        │                     │                      │
        └─────────────────────┴──────────────────────┘
                              │
        ┌─────────────────────┴─────────────────────┐
        │          ОБЩИЕ HUB СТРАНИЦЫ               │
        │       (Доступны всем авторизованным)      │
        └─────────────────────┬─────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
   ┌────▼────┐          ┌────▼─────┐         ┌────▼─────┐
   │/hub/    │          │/hub/     │         │/hub/     │
   │ tours   │          │ cars     │         │ gear     │
   └─────────┘          └──────────┘         └──────────┘
        │                     │                     │
   ┌────▼────┐          ┌────▼─────┐         ┌────▼─────┐
   │/hub/    │          │/hub/     │         │          │
   │ stay    │          │souvenirs │         │          │
   └─────────┘          └──────────┘         └──────────┘
        │                     
   ┌────▼────┐
   │/hub/    │
   │ safety  │
   └─────────┘
```

---

# 👤 ДЕТАЛЬНЫЕ СЦЕНАРИИ ПО РОЛЯМ

---

## 🎯 ТУРИСТ (Tourist)

### **Сценарий 1: Первое посещение → Регистрация → Первое бронирование**

```
ЭТАП 1: ЗНАКОМСТВО С ПЛАТФОРМОЙ
┌─────────────────────────────────────────────────────┐
│ 1. Турист заходит на сайт                           │
│    → https://kamhub.timeweb.cloud                   │
│    → Видит главную страницу (/)                     │
│                                                     │
│ На экране:                                          │
│ ✅ Hero с видео Камчатки                            │
│ ✅ Поиск туров                                      │
│ ✅ 8 карточек ролей (Турист, Оператор, и т.д.)     │
│ ✅ Популярные туры (топ-6)                          │
│ ✅ Виджет погоды                                    │
│ ✅ Виджет Eco-points                                │
│ ✅ AI-чат                                           │
│                                                     │
│ Действия:                                           │
│ • Просмотр туров (скролл)                          │
│ • Клик на карточку тура → Детали                   │
│ • Вопрос AI-чату: "Какие туры для новичков?"       │
│ • Просмотр погоды                                  │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 2: РЕГИСТРАЦИЯ
┌─────────────────────────────────────────────────────┐
│ 2. Турист решает забронировать тур                  │
│    → Клик "Забронировать"                           │
│    → Редирект на /auth/login                        │
│                                                     │
│ На экране:                                          │
│ ✅ Форма входа/регистрации                          │
│ ✅ Выбор роли (по умолчанию: Турист)                │
│                                                     │
│ Действия:                                           │
│ • Ввод email: tourist@example.com                  │
│ • Ввод пароля: ********                            │
│ • Выбор роли: Турист                               │
│ • Клик "Зарегистрироваться"                        │
│                                                     │
│ API:                                                │
│ POST /api/auth/signup                               │
│ {                                                   │
│   email: "tourist@example.com",                     │
│   password: "********",                             │
│   role: "tourist"                                   │
│ }                                                   │
│                                                     │
│ Response:                                           │
│ {                                                   │
│   success: true,                                    │
│   token: "jwt_token_here",                          │
│   user: { id, email, name, role }                  │
│ }                                                   │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 3: ПЕРВЫЙ ВХОД
┌─────────────────────────────────────────────────────┐
│ 3. Редирект в Hub туриста                           │
│    → /hub/tourist                                   │
│                                                     │
│ На экране:                                          │
│ ✅ Приветствие: "Добро пожаловать, [Имя]!"         │
│ ✅ Баллы лояльности: 0 (Уровень: Новичок)           │
│ ✅ Eco-points: 0                                    │
│ ✅ Активные бронирования: Нет                       │
│ ✅ Рекомендации AI                                  │
│ ✅ Быстрые действия:                                │
│    • Найти тур                                     │
│    • Забронировать трансфер                        │
│    • Пригласить друга (реферал)                    │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 4: ПОИСК ТУРА
┌─────────────────────────────────────────────────────┐
│ 4. Клик "Найти тур"                                 │
│    → /hub/tours                                     │
│                                                     │
│ На экране:                                          │
│ ✅ Поисковая строка                                 │
│ ✅ Фильтры:                                         │
│    • Цена: 0₽ - 50,000₽ (слайдер)                  │
│    • Сложность: Лёгкий / Средний / Сложный         │
│    • Длительность: 1-8 часов                       │
│    • Сезон: Лето, Осень, Зима, Весна               │
│    • Активность: Хайкинг, Сноуборд, Рыбалка        │
│    • Рейтинг: 4+, 4.5+, 5                          │
│ ✅ Сортировка: По цене, По рейтингу, По популярности│
│ ✅ Карточки туров (пагинация по 12)                │
│                                                     │
│ Действия:                                           │
│ • Установка фильтров:                              │
│   - Цена: 5,000₽ - 15,000₽                         │
│   - Сложность: Лёгкий                              │
│ • Клик "Применить"                                 │
│                                                     │
│ API:                                                │
│ GET /api/tours?                                     │
│   priceFrom=5000&                                   │
│   priceTo=15000&                                    │
│   difficulty=easy&                                  │
│   page=1&                                           │
│   limit=12                                          │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 5: ПРОСМОТР ДЕТАЛЕЙ ТУРА
┌─────────────────────────────────────────────────────┐
│ 5. Клик на карточку тура                            │
│    → /hub/tours/[tour_id]                           │
│                                                     │
│ На экране:                                          │
│ ✅ Галерея изображений (6+ фото)                    │
│ ✅ Название: "Восхождение на Авачинский вулкан"     │
│ ✅ Описание (полное)                                │
│ ✅ Характеристики:                                  │
│    • Сложность: Средняя ⚠️                         │
│    • Длительность: 8 часов                         │
│    • Цена: 15,000₽ на человека                     │
│    • Группа: 4-12 человек                          │
│    • Сезон: Лето, Осень                            │
│ ✅ Что включено / Что не включено                   │
│ ✅ Требования к снаряжению                          │
│ ✅ Карта маршрута (Yandex Maps)                     │
│ ✅ Погода для маршрута                              │
│ ✅ Отзывы (4.8 ★ / 156 отзывов)                     │
│ ✅ Оператор: "Вулканы Камчатки Тур" (4.9 ★)        │
│ ✅ Гид: "Александр Вулканов" (4.9 ★)               │
│                                                     │
│ Действия:                                           │
│ • Просмотр всех фото                               │
│ • Чтение отзывов                                   │
│ • Клик "Забронировать"                             │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 6: БРОНИРОВАНИЕ
┌─────────────────────────────────────────────────────┐
│ 6. Страница бронирования                            │
│    → /hub/booking/new?tour_id=[tour_id]             │
│                                                     │
│ На экране:                                          │
│ ✅ Детали тура (краткие)                            │
│ ✅ Форма бронирования:                              │
│    • Дата: [Календарь]                             │
│    • Количество участников: [1-12]                 │
│    • Особые требования: [Текстовое поле]           │
│    • Контакты:                                     │
│      - Телефон: +7-XXX-XXX-XX-XX                   │
│      - Email: (автозаполнение)                     │
│ ✅ Расчёт цены:                                     │
│    - Цена за 1 чел: 15,000₽                        │
│    - Количество: 2                                 │
│    - Промокод: [Поле ввода]                        │
│    - Баллы лояльности: 0 (недостаточно)            │
│    - ИТОГО: 30,000₽                                │
│                                                     │
│ Действия:                                           │
│ • Выбор даты: 2024-02-15                           │
│ • Количество: 2 человека                           │
│ • Особые требования: "Вегетарианское питание"      │
│ • Клик "Продолжить к оплате"                       │
│                                                     │
│ API:                                                │
│ POST /api/bookings                                  │
│ {                                                   │
│   tourId: "tour_123",                               │
│   date: "2024-02-15",                               │
│   participants: 2,                                  │
│   totalPrice: 30000,                                │
│   specialRequests: "Вегетарианское питание"         │
│ }                                                   │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 7: ОПЛАТА
┌─────────────────────────────────────────────────────┐
│ 7. Страница оплаты (CloudPayments)                  │
│    → /hub/payment/[booking_id]                      │
│                                                     │
│ На экране:                                          │
│ ✅ Детали заказа                                    │
│ ✅ Сумма: 30,000₽                                   │
│ ✅ Способы оплаты:                                  │
│    • 💳 Банковская карта                           │
│    • 📱 Apple Pay / Google Pay                     │
│    • 💰 ЮMoney                                      │
│ ✅ Форма карты (iframe CloudPayments)               │
│                                                     │
│ Действия:                                           │
│ • Выбор способа: Банковская карта                  │
│ • Ввод данных карты:                               │
│   - Номер: 1234 5678 9012 3456                     │
│   - Срок: 12/25                                    │
│   - CVV: 123                                       │
│ • Клик "Оплатить"                                  │
│                                                     │
│ API:                                                │
│ POST /api/payments/create                           │
│ → CloudPayments API                                 │
│ → Webhook: POST /api/payments/webhook               │
│                                                     │
│ Response (успех):                                   │
│ {                                                   │
│   success: true,                                    │
│   paymentId: "pay_123",                             │
│   status: "success"                                 │
│ }                                                   │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 8: ПОДТВЕРЖДЕНИЕ
┌─────────────────────────────────────────────────────┐
│ 8. Страница успешного бронирования                  │
│    → /hub/booking/[booking_id]/success              │
│                                                     │
│ На экране:                                          │
│ ✅ ✅ Бронирование успешно создано!                 │
│ ✅ Код подтверждения: ABC123                        │
│ ✅ Детали бронирования:                             │
│    • Тур: Восхождение на Авачинский вулкан         │
│    • Дата: 15 февраля 2024                         │
│    • Участники: 2 человека                         │
│    • Оператор: Вулканы Камчатки Тур                │
│    • Гид: Александр Вулканов                       │
│ ✅ Начислено баллов: 300 (1% от 30,000₽)           │
│ ✅ Ваучер (PDF) - скачать                           │
│                                                     │
│ Уведомления:                                        │
│ 📱 SMS: "Ваше бронирование подтверждено! Код: ABC123"│
│ 📧 Email: Полные детали + ваучер (PDF)             │
│                                                     │
│ Действия:                                           │
│ • Скачать ваучер (PDF)                             │
│ • Добавить в календарь                             │
│ • Поделиться с друзьями                            │
│ • Вернуться в профиль                              │
└─────────────────────────────────────────────────────┘
```

---

### **Сценарий 2: Бронирование трансфера с AI**

```
ЭТАП 1: ВХОД В РАЗДЕЛ ТРАНСФЕРОВ
┌─────────────────────────────────────────────────────┐
│ 1. Турист в /hub/tourist                            │
│    → Клик "Трансферы"                               │
│    → /hub/transfers/search                          │
│                                                     │
│ На экране:                                          │
│ ✅ Форма поиска трансфера:                          │
│    • Откуда: [Поле с автодополнением]              │
│    • Куда: [Поле с автодополнением]                │
│    • Дата: [Календарь]                             │
│    • Время: [Выбор времени]                        │
│    • Пассажиры: [1-50]                             │
│    • Тип транспорта: [Economy/Comfort/Business]    │
│    • Функции: [WiFi, Детское кресло, и т.д.]       │
│    • Бюджет: [0₽ - 10,000₽]                        │
│ ✅ Карта (Yandex Maps)                              │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 2: ВВОД ДАННЫХ
┌─────────────────────────────────────────────────────┐
│ 2. Турист заполняет форму                           │
│                                                     │
│ Ввод:                                               │
│ • Откуда: "Аэропорт Елизово"                       │
│   → Автодополнение → Координаты: 53.17, 158.65     │
│ • Куда: "Гостиница Авача"                          │
│   → Автодополнение → Координаты: 53.05, 158.65     │
│ • Дата: 16 февраля 2024                            │
│ • Время: 14:00                                     │
│ • Пассажиры: 3                                     │
│ • Тип: Comfort                                     │
│ • Функции: WiFi, Детское кресло                    │
│ • Бюджет: до 5,000₽                                │
│                                                     │
│ Клик "Найти трансфер"                              │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 3: AI MATCHING
┌─────────────────────────────────────────────────────┐
│ 3. AI Matching Engine работает                      │
│                                                     │
│ API:                                                │
│ POST /api/transfers/search                          │
│ {                                                   │
│   from: "Аэропорт Елизово",                        │
│   to: "Гостиница Авача",                           │
│   fromCoordinates: { lat: 53.17, lng: 158.65 },    │
│   toCoordinates: { lat: 53.05, lng: 158.65 },      │
│   date: "2024-02-16",                               │
│   time: "14:00",                                    │
│   passengers: 3,                                    │
│   vehicleType: "comfort",                           │
│   features: ["wifi", "child_seat"],                 │
│   budgetMax: 5000                                   │
│ }                                                   │
│                                                     │
│ Алгоритм:                                           │
│ 1. Поиск всех подходящих водителей:                │
│    - Вместимость >= 3                              │
│    - Тип = Comfort                                 │
│    - Функции: WiFi ✅, Child Seat ✅                │
│    - Доступен 16.02.2024 14:00 ✅                  │
│    - Рейтинг >= 4.0 ✅                              │
│                                                     │
│ 2. Расчёт балла для каждого:                       │
│    Водитель 1: Иван Петров                         │
│    - Рейтинг: 4.9/5 (0.98) × 30% = 0.294           │
│    - Цена: 1,800₽ (0.85) × 25% = 0.213             │
│    - Расстояние: 2 км (0.95) × 20% = 0.190         │
│    - Доступность: Да (1.0) × 15% = 0.150           │
│    - Опыт: 8 лет (0.8) × 10% = 0.080               │
│    - Бонус: WiFi + Child Seat = +0.10              │
│    ────────────────────────────────────            │
│    ИТОГО: 0.927 (92.7%)                             │
│                                                     │
│    Водитель 2: Мария Сидорова                      │
│    - Рейтинг: 4.7/5 (0.94) × 30% = 0.282           │
│    - Цена: 2,000₽ (0.80) × 25% = 0.200             │
│    - Расстояние: 5 км (0.75) × 20% = 0.150         │
│    - Доступность: Да (1.0) × 15% = 0.150           │
│    - Опыт: 5 лет (0.5) × 10% = 0.050               │
│    - Бонус: WiFi + Child Seat = +0.10              │
│    ────────────────────────────────────            │
│    ИТОГО: 0.832 (83.2%)                             │
│                                                     │
│ 3. Сортировка по баллам (desc)                     │
│ 4. Топ-5 водителей                                 │
│                                                     │
│ Время обработки: 387ms                             │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 4: РЕЗУЛЬТАТЫ ПОИСКА
┌─────────────────────────────────────────────────────┐
│ 4. Результаты поиска (топ-5)                        │
│    → /hub/transfers/search/results                  │
│                                                     │
│ На экране:                                          │
│ ✅ Найдено 5 водителей                              │
│                                                     │
│ ┌─────────────────────────────────────────┐        │
│ │ 🥇 #1 - Иван Петров (92.7%)             │        │
│ │ ⭐ 4.9 (150 поездок)                     │        │
│ │ 🚗 Toyota Camry 2023 (Comfort)           │        │
│ │ 💰 1,800₽ на человека (5,400₽ всего)    │        │
│ │ 📍 2 км от вас (прибудет через 5 мин)    │        │
│ │ 🗣️ Русский, Английский                  │        │
│ │ ✅ WiFi, Детское кресло, Кондиционер     │        │
│ │ [Выбрать этого водителя]                │        │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ ┌─────────────────────────────────────────┐        │
│ │ 🥈 #2 - Мария Сидорова (83.2%)          │        │
│ │ ⭐ 4.7 (120 поездок)                     │        │
│ │ 🚗 Hyundai Elantra 2022 (Comfort)        │        │
│ │ 💰 2,000₽ на человека (6,000₽ всего)    │        │
│ │ 📍 5 км от вас (прибудет через 12 мин)   │        │
│ │ 🗣️ Русский, Китайский                   │        │
│ │ ✅ WiFi, Детское кресло, Кондиционер     │        │
│ │ [Выбрать этого водителя]                │        │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ ... (ещё 3 водителя)                               │
│                                                     │
│ Действия:                                           │
│ • Сравнение водителей                              │
│ • Просмотр профиля водителя (рейтинг, отзывы)      │
│ • Клик "Выбрать этого водителя" (Иван Петров)     │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 5: ПОДТВЕРЖДЕНИЕ ЗАКАЗА
┌─────────────────────────────────────────────────────┐
│ 5. Подтверждение заказа трансфера                   │
│    → /hub/transfers/booking/confirm                 │
│                                                     │
│ На экране:                                          │
│ ✅ Детали поездки:                                  │
│    • Маршрут: Аэропорт Елизово → Гостиница Авача   │
│    • Дата: 16 февраля 2024                         │
│    • Время: 14:00                                  │
│    • Пассажиры: 3                                  │
│ ✅ Водитель: Иван Петров (⭐ 4.9)                   │
│ ✅ Автомобиль: Toyota Camry 2023                    │
│ ✅ Цена: 5,400₽                                     │
│ ✅ Промокод: [Поле ввода]                           │
│ ✅ Баллы лояльности: 300 баллов (недостаточно)      │
│                                                     │
│ Действия:                                           │
│ • Ввод промокода: KAMCHAT2025                      │
│ • Клик "Применить промокод"                        │
│                                                     │
│ API:                                                │
│ POST /api/loyalty/promo/apply                       │
│ { code: "KAMCHAT2025", amount: 5400 }               │
│                                                     │
│ Response:                                           │
│ {                                                   │
│   success: true,                                    │
│   discountAmount: 540,  // 10% скидка              │
│   newTotal: 4860                                    │
│ }                                                   │
│                                                     │
│ Обновлённая цена: 4,860₽                            │
│                                                     │
│ • Клик "Забронировать и оплатить"                  │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 6: СОЗДАНИЕ БРОНИРОВАНИЯ
┌─────────────────────────────────────────────────────┐
│ 6. Бронирование создаётся                           │
│                                                     │
│ API:                                                │
│ POST /api/transfers/book                            │
│ {                                                   │
│   scheduleId: "schedule_123",                       │
│   passengersCount: 3,                               │
│   contactInfo: {                                    │
│     phone: "+7-914-123-45-67",                      │
│     email: "tourist@example.com",                   │
│     name: "Иван Турист"                             │
│   },                                                │
│   fromCoordinates: { lat: 53.17, lng: 158.65 },    │
│   toCoordinates: { lat: 53.05, lng: 158.65 },      │
│   departureDate: "2024-02-16",                      │
│   vehicleType: "comfort",                           │
│   features: ["wifi", "child_seat"]                  │
│ }                                                   │
│                                                     │
│ Backend процесс:                                    │
│ 1. Создание booking в БД                           │
│ 2. Генерация кода подтверждения: KT8F2X            │
│ 3. Создание платежа (CloudPayments)                │
│ 4. Уменьшение available_seats                      │
│ 5. Создание уведомлений:                           │
│    ├─ Турист: SMS (код KT8F2X)                     │
│    ├─ Турист: Email (детали + ваучер)              │
│    └─ Водитель: Telegram (новая заявка)            │
│ 6. Начисление баллов лояльности (48 баллов)        │
│                                                     │
│ Триггеры БД (автоматически):                        │
│ ✅ auto_earn_loyalty_points → 48 баллов             │
│ ✅ auto_calculate_commissions:                      │
│    • Платформа: 729₽ (15%)                         │
│    • Оператор: 486₽ (10%)                          │
│    • Водитель: 3,645₽ (75%)                        │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 7: УВЕДОМЛЕНИЯ
┌─────────────────────────────────────────────────────┐
│ 7. Уведомления отправляются                         │
│                                                     │
│ SMS туристу (+7-914-123-45-67):                     │
│ ┌─────────────────────────────────────────┐        │
│ │ Трансфер забронирован! Код: KT8F2X      │        │
│ │ 16.02.2024 14:00                         │        │
│ │ Аэропорт → Гостиница Авача              │        │
│ │ Водитель: Иван Петров                   │        │
│ │ Toyota Camry (А123БВ)                    │        │
│ │ Тел: +7-914-111-11-11                   │        │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ Email туристу:                                      │
│ ┌─────────────────────────────────────────┐        │
│ │ ✅ Ваш трансфер подтверждён!             │        │
│ │                                          │        │
│ │ Код подтверждения: KT8F2X                │        │
│ │                                          │        │
│ │ Детали поездки:                          │        │
│ │ • Откуда: Аэропорт Елизово               │        │
│ │ • Куда: Гостиница Авача                  │        │
│ │ • Дата: 16 февраля 2024                  │        │
│ │ • Время: 14:00                           │        │
│ │ • Пассажиры: 3                           │        │
│ │ • Цена: 4,860₽                           │        │
│ │                                          │        │
│ │ Водитель:                                │        │
│ │ • Иван Петров (⭐ 4.9)                   │        │
│ │ • +7-914-111-11-11                       │        │
│ │ • Toyota Camry 2023 (А123БВ)             │        │
│ │ • Функции: WiFi, Детское кресло          │        │
│ │                                          │        │
│ │ [Скачать ваучер PDF]                     │        │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ Telegram водителю (chat_id: 123456789):             │
│ ┌─────────────────────────────────────────┐        │
│ │ 🚕 НОВАЯ ЗАЯВКА!                         │        │
│ │                                          │        │
│ │ Откуда: Аэропорт Елизово                │        │
│ │ Куда: Гостиница Авача                   │        │
│ │ Время: 16.02.2024 14:00                 │        │
│ │ Пассажиры: 3                            │        │
│ │ Доход: 3,645₽ (75%)                     │        │
│ │                                          │        │
│ │ Пассажир:                               │        │
│ │ • Иван Турист                           │        │
│ │ • +7-914-123-45-67                      │        │
│ │                                          │        │
│ │ [Принять] [Отклонить]                   │        │
│ └─────────────────────────────────────────┘        │
└─────────────────────────────────────────────────────┘
```

---

## 🏢 ОПЕРАТОР (Operator)

### **Сценарий 3: Создание тура**

```
ЭТАП 1: ВХОД В CRM
┌─────────────────────────────────────────────────────┐
│ 1. Оператор заходит в панель                        │
│    → /hub/operator                                  │
│                                                     │
│ На экране:                                          │
│ ✅ Dashboard:                                       │
│    • Общая выручка: 450,000₽                       │
│    • Активные бронирования: 8                      │
│    • Завершённые: 105                              │
│    • Средний рейтинг: 4.7 ⭐                        │
│ ✅ Графики (выручка по дням)                        │
│ ✅ Список туров (свои)                              │
│ ✅ Последние бронирования                           │
│ ✅ Уведомления (3 новых)                            │
│                                                     │
│ Действия:                                           │
│ • Клик "Создать новый тур"                         │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 2: ФОРМА СОЗДАНИЯ ТУРА
┌─────────────────────────────────────────────────────┐
│ 2. Страница создания тура                           │
│    → /hub/operator/tours/new                        │
│                                                     │
│ На экране:                                          │
│ ✅ Форма (многоэтапная):                            │
│                                                     │
│ ШАГ 1: Основная информация                          │
│ • Название: "Восхождение на Мутновский вулкан"     │
│ • Краткое описание: (200 символов)                 │
│ • Полное описание: (1000 символов)                 │
│ • Активность: Хайкинг                              │
│                                                     │
│ ШАГ 2: Параметры                                    │
│ • Сложность: [Лёгкая/Средняя/Сложная] → Средняя    │
│ • Длительность: 10 часов                           │
│ • Цена от: 18,000₽                                 │
│ • Цена до: 18,000₽                                 │
│ • Макс участников: 12                              │
│ • Мин участников: 4                                │
│                                                     │
│ ШАГ 3: Детали                                       │
│ • Сезон: [✅ Лето] [✅ Осень] [ ] Зима [ ] Весна   │
│ • Что включено:                                    │
│   - Транспорт                                      │
│   - Гид                                            │
│   - Питание (обед)                                 │
│   - Страховка                                      │
│ • Что не включено:                                 │
│   - Личное снаряжение                              │
│   - Дополнительное питание                         │
│ • Требования к снаряжению:                         │
│   - Треккинговые ботинки                           │
│   - Рюкзак 30-40л                                  │
│   - Термобельё                                     │
│                                                     │
│ ШАГ 4: Маршрут                                      │
│ • Координаты точек: [Карта Yandex Maps]            │
│   - Точка 1: База (53.02, 158.65)                  │
│   - Точка 2: Кратер (53.10, 158.70)                │
│ • Встреча: "Автостанция, 07:00"                    │
│                                                     │
│ ШАГ 5: Изображения                                  │
│ • Загрузка фото (мин 3, макс 10):                  │
│   [Drag & Drop зона]                               │
│   - volcano_1.jpg (загружено)                      │
│   - volcano_2.jpg (загружено)                      │
│   - volcano_3.jpg (загружено)                      │
│                                                     │
│ ШАГ 6: Гид                                          │
│ • Назначение гида: [Dropdown]                      │
│   → Александр Вулканов (⭐ 4.9, 45 туров)          │
│                                                     │
│ Клик "Создать тур"                                 │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 3: СОЗДАНИЕ В БД
┌─────────────────────────────────────────────────────┐
│ 3. Backend обработка                                │
│                                                     │
│ API:                                                │
│ POST /api/tours                                     │
│ {                                                   │
│   name: "Восхождение на Мутновский вулкан",        │
│   description: "...",                               │
│   difficulty: "medium",                             │
│   duration: 10,                                     │
│   priceFrom: 18000,                                 │
│   priceTo: 18000,                                   │
│   maxParticipants: 12,                              │
│   minParticipants: 4,                               │
│   season: ["summer", "autumn"],                     │
│   coordinates: [...],                               │
│   requirementsIncluded: [...],                      │
│   requirementsNotIncluded: [...],                   │
│   equipmentRequired: [...],                         │
│   guideId: "guide_123",                             │
│   images: [...]                                     │
│ }                                                   │
│                                                     │
│ Backend процесс:                                    │
│ 1. Валидация данных                                │
│ 2. Загрузка изображений в S3                       │
│ 3. Создание записи в tours                         │
│ 4. Создание связей в tour_assets                   │
│ 5. Уведомление гиду (назначение)                   │
│ 6. Модерация (если требуется)                      │
│                                                     │
│ Response:                                           │
│ {                                                   │
│   success: true,                                    │
│   tourId: "tour_new_123",                           │
│   status: "pending_moderation"                      │
│ }                                                   │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 4: ПОДТВЕРЖДЕНИЕ
┌─────────────────────────────────────────────────────┐
│ 4. Успешное создание                                │
│    → /hub/operator                                  │
│                                                     │
│ На экране:                                          │
│ ✅ ✅ Тур успешно создан!                            │
│ ✅ Ожидает модерации администратором                │
│ ✅ Уведомление отправлено гиду                      │
│                                                     │
│ Тур добавлен в список:                              │
│ ┌─────────────────────────────────────────┐        │
│ │ 🆕 Восхождение на Мутновский вулкан      │        │
│ │ Статус: Ожидает модерации ⏳             │        │
│ │ Гид: Александр Вулканов                  │        │
│ │ Цена: 18,000₽                            │        │
│ │ [Редактировать] [Удалить]                │        │
│ └─────────────────────────────────────────┘        │
└─────────────────────────────────────────────────────┘
```

---

### **Сценарий 4: Подтверждение бронирования**

```
ЭТАП 1: ПОЛУЧЕНИЕ УВЕДОМЛЕНИЯ
┌─────────────────────────────────────────────────────┐
│ 1. Оператор получает уведомление                    │
│    → Email, Telegram, Push                          │
│                                                     │
│ Уведомление:                                        │
│ ┌─────────────────────────────────────────┐        │
│ │ 🔔 Новое бронирование!                   │        │
│ │                                          │        │
│ │ Тур: Восхождение на Авачинский вулкан   │        │
│ │ Дата: 15 февраля 2024                    │        │
│ │ Участники: 2 человека                   │        │
│ │ Турист: Иван Турист                     │        │
│ │ Сумма: 30,000₽                           │        │
│ │                                          │        │
│ │ [Перейти к бронированию]                │        │
│ └─────────────────────────────────────────┘        │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 2: ПРОСМОТР БРОНИРОВАНИЯ
┌─────────────────────────────────────────────────────┐
│ 2. Оператор в /hub/operator                         │
│    → Вкладка "Бронирования"                         │
│    → Клик на новое бронирование                     │
│                                                     │
│ На экране:                                          │
│ ✅ Детали бронирования:                             │
│    • ID: booking_123                               │
│    • Статус: Ожидает подтверждения ⏳               │
│    • Тур: Восхождение на Авачинский вулкан         │
│    • Дата: 15 февраля 2024                         │
│    • Участники: 2                                  │
│    • Турист: Иван Турист                           │
│    • Контакты: +7-914-123-45-67                    │
│    • Email: tourist@example.com                    │
│    • Особые требования: "Вегетарианское питание"   │
│    • Оплата: Оплачено ✅                            │
│ ✅ Проверка доступности:                            │
│    • Дата: 15.02.2024 (свободно ✅)                │
│    • Гид: Александр Вулканов (доступен ✅)         │
│    • Погода: Хорошая (good) ✅                      │
│    • Безопасность: Отлично (excellent) ✅           │
│                                                     │
│ Действия:                                           │
│ • Клик "Подтвердить бронирование"                  │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 3: ПОДТВЕРЖДЕНИЕ
┌─────────────────────────────────────────────────────┐
│ 3. Подтверждение бронирования                       │
│                                                     │
│ API:                                                │
│ PUT /api/bookings/booking_123/confirm               │
│ {                                                   │
│   action: "confirm",                                │
│   message: "Подтверждено! Ждём вас!"                │
│ }                                                   │
│                                                     │
│ Backend процесс:                                    │
│ 1. Обновление статуса: pending → confirmed         │
│ 2. Обновление слота (уменьшение мест)              │
│ 3. Уведомление туристу (SMS + Email)               │
│ 4. Уведомление гиду (назначение)                   │
│ 5. Создание записи в audit_logs                    │
│                                                     │
│ Уведомления:                                        │
│ ├─ Турист: "Ваше бронирование подтверждено!"       │
│ └─ Гид: "Вы назначены на тур 15.02.2024"           │
└─────────────────────────────────────────────────────┘
```

---

## 🎒 ГИД (Guide)

### **Сценарий 5: Просмотр расписания и работа с группой**

```
ЭТАП 1: ВХОД В ПАНЕЛЬ ГИДА
┌─────────────────────────────────────────────────────┐
│ 1. Гид заходит в панель                             │
│    → /hub/guide                                     │
│                                                     │
│ На экране:                                          │
│ ✅ Календарь туров (текущий месяц)                  │
│ ✅ Предстоящие туры (ближайшие 7 дней):             │
│    ┌─────────────────────────────────────┐         │
│    │ 15 фев - Авачинский вулкан           │         │
│    │ Группа: 2 чел | 08:00 | 8 часов      │         │
│    │ [Подробнее]                          │         │
│    └─────────────────────────────────────┘         │
│    ┌─────────────────────────────────────┐         │
│    │ 16 фев - Долина гейзеров             │         │
│    │ Группа: 4 чел | 06:00 | 12 часов     │         │
│    │ [Подробнее]                          │         │
│    └─────────────────────────────────────┘         │
│ ✅ Статистика:                                      │
│    • Всего туров: 45                               │
│    • Заработок: 125,000₽                           │
│    • Рейтинг: 4.9 ⭐ (87 отзывов)                  │
│ ✅ Погода для предстоящих туров                     │
│                                                     │
│ Действия:                                           │
│ • Клик на "15 фев - Авачинский вулкан"             │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 2: ДЕТАЛИ ТУРА И ГРУППА
┌─────────────────────────────────────────────────────┐
│ 2. Детали тура                                      │
│    → /hub/guide/tour/[tour_id]                      │
│                                                     │
│ На экране:                                          │
│ ✅ Информация о туре:                               │
│    • Название: Восхождение на Авачинский вулкан    │
│    • Дата: 15 февраля 2024, 08:00                  │
│    • Длительность: 8 часов                         │
│    • Встреча: Автостанция, 07:30                   │
│ ✅ Погода на 15.02.2024:                            │
│    • Температура: -5°C                             │
│    • Облачность: Переменная                        │
│    • Ветер: 12 м/с                                 │
│    • Безопасность: Отлично ✅                       │
│ ✅ Группа туристов (2 чел):                         │
│    ┌─────────────────────────────────────┐         │
│    │ 👤 Иван Турист                       │         │
│    │ 📱 +7-914-123-45-67                  │         │
│    │ 📧 tourist@example.com               │         │
│    │ ⚠️ Особые требования:                │         │
│    │    Вегетарианское питание            │         │
│    │ [Написать сообщение]                 │         │
│    └─────────────────────────────────────┘         │
│    ┌─────────────────────────────────────┐         │
│    │ 👤 Мария Петрова                     │         │
│    │ 📱 +7-914-234-56-78                  │         │
│    │ 📧 maria@example.com                 │         │
│    │ ⚠️ Особые требования: Нет            │         │
│    │ [Написать сообщение]                 │         │
│    └─────────────────────────────────────┘         │
│ ✅ Чек-лист подготовки:                             │
│    [ ] Проверить снаряжение                        │
│    [ ] Проверить транспорт                         │
│    [ ] Подготовить питание (веган для Ивана)       │
│    [ ] Связаться с группой                         │
│                                                     │
│ Действия:                                           │
│ • Клик "Написать сообщение всей группе"            │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 3: ОБЩЕНИЕ С ГРУППОЙ
┌─────────────────────────────────────────────────────┐
│ 3. Чат с группой                                    │
│    → /hub/guide/tour/[tour_id]/chat                 │
│                                                     │
│ На экране:                                          │
│ ✅ Групповой чат                                    │
│ ✅ Участники: Иван, Мария                           │
│                                                     │
│ Сообщения:                                          │
│ ┌─────────────────────────────────────────┐        │
│ │ [Гид] Александр Вулканов                │        │
│ │ Добрый день! Встречаемся завтра в 07:30  │        │
│ │ на автостанции. С собой треккинговые     │        │
│ │ ботинки, рюкзак, тёплую одежду.          │        │
│ │ 14:25                                    │        │
│ └─────────────────────────────────────────┘        │
│ ┌─────────────────────────────────────────┐        │
│ │ [Турист] Иван                            │        │
│ │ Спасибо! А вегетарианский обед будет?    │        │
│ │ 14:27                                    │        │
│ └─────────────────────────────────────────┘        │
│ ┌─────────────────────────────────────────┐        │
│ │ [Гид] Александр Вулканов                │        │
│ │ Да, мы учли! Вегетарианский обед готов.  │        │
│ │ 14:30                                    │        │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ Поле ввода: [Введите сообщение...]                 │
│ [Отправить]                                         │
│                                                     │
│ API:                                                │
│ POST /api/guide/chat/send                           │
│ WebSocket: ws://kamhub/chat/tour_123                │
└─────────────────────────────────────────────────────┘
```

---

## 🚗 ВЛАДЕЛЕЦ ТРАНСФЕРА (Transfer Owner)

### **Сценарий 6: Добавление нового водителя**

```
ЭТАП 1: ВХОД В ПАНЕЛЬ
┌─────────────────────────────────────────────────────┐
│ 1. Владелец трансфера заходит                       │
│    → /hub/transfer-operator                         │
│                                                     │
│ На экране:                                          │
│ ✅ Dashboard:                                       │
│    • Всего водителей: 5                            │
│    • Всего транспорта: 5                           │
│    • Активные заявки: 8                            │
│    • Выручка за месяц: 135,000₽                    │
│ ✅ Вкладки:                                         │
│    • Обзор                                         │
│    • Водители                                      │
│    • Транспорт                                     │
│    • Маршруты                                      │
│    • Расписание                                    │
│    • Заявки                                        │
│    • Аналитика                                     │
│                                                     │
│ Действия:                                           │
│ • Клик на вкладку "Водители"                       │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 2: СПИСОК ВОДИТЕЛЕЙ
┌─────────────────────────────────────────────────────┐
│ 2. Список всех водителей                            │
│    → /hub/transfer-operator/drivers                 │
│                                                     │
│ На экране:                                          │
│ ✅ Таблица водителей:                               │
│ ┌────┬────────────┬────────┬────────┬──────┐       │
│ │ ID │ Имя        │ Рейтинг│ Поездки│Статус│       │
│ ├────┼────────────┼────────┼────────┼──────┤       │
│ │ 1  │ Иван П.    │ 4.9 ⭐ │ 150    │ ✅   │       │
│ │ 2  │ Мария С.   │ 4.7 ⭐ │ 120    │ ✅   │       │
│ │ 3  │ Пётр К.    │ 4.8 ⭐ │ 200    │ ✅   │       │
│ │ 4  │ Алексей В. │ 4.6 ⭐ │ 80     │ ⏸️   │       │
│ │ 5  │ Сергей Д.  │ 4.9 ⭐ │ 180    │ ✅   │       │
│ └────┴────────────┴────────┴────────┴──────┘       │
│                                                     │
│ Фильтры:                                            │
│ • Рейтинг: Все / 4+ / 4.5+ / 5                     │
│ • Статус: Все / Активные / Неактивные              │
│ • Поиск: [По имени, телефону]                      │
│                                                     │
│ Действия:                                           │
│ • Клик "Добавить водителя"                         │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 3: ФОРМА ДОБАВЛЕНИЯ
┌─────────────────────────────────────────────────────┐
│ 3. Форма нового водителя                            │
│    → /hub/transfer-operator/drivers/new             │
│                                                     │
│ На экране:                                          │
│ ✅ Форма добавления:                                │
│                                                     │
│ Личные данные:                                      │
│ • ФИО: "Николай Камчатский"                        │
│ • Телефон: +7-914-555-55-55                        │
│ • Email: nikolay@example.com                       │
│ • Telegram: @nikolay_driver                        │
│                                                     │
│ Документы:                                          │
│ • Водительское удостоверение: 1234567890           │
│ • Категории: B, C, D                               │
│ • Стаж вождения: 12 лет                            │
│                                                     │
│ Языки:                                              │
│ • [✅] Русский                                      │
│ • [✅] Английский                                   │
│ • [ ] Китайский                                    │
│ • [ ] Японский                                     │
│                                                     │
│ График работы:                                      │
│ • Начало: 06:00                                    │
│ • Конец: 22:00                                     │
│ • Выходные: Понедельник                            │
│                                                     │
│ Интеграция:                                         │
│ • Telegram Chat ID: (автоопределение)              │
│   → Бот отправит сообщение для подтверждения       │
│                                                     │
│ Действия:                                           │
│ • Заполнение всех полей                            │
│ • Клик "Добавить водителя"                         │
│                                                     │
│ API:                                                │
│ POST /api/transfer/drivers                          │
│ {                                                   │
│   name: "Николай Камчатский",                       │
│   phone: "+7-914-555-55-55",                        │
│   email: "nikolay@example.com",                     │
│   licenseNumber: "1234567890",                      │
│   languages: ["ru", "en"],                          │
│   workingHours: {                                   │
│     start: "06:00",                                 │
│     end: "22:00"                                    │
│   },                                                │
│   telegramUsername: "@nikolay_driver"               │
│ }                                                   │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 4: TELEGRAM ИНТЕГРАЦИЯ
┌─────────────────────────────────────────────────────┐
│ 4. Telegram бот отправляет сообщение                │
│                                                     │
│ Telegram → @nikolay_driver:                         │
│ ┌─────────────────────────────────────────┐        │
│ │ 🤖 KamHub Driver Bot                     │        │
│ │                                          │        │
│ │ Добро пожаловать, Николай!               │        │
│ │                                          │        │
│ │ Вы добавлены в систему как водитель.     │        │
│ │ Теперь вы будете получать уведомления    │        │
│ │ о новых заявках здесь.                   │        │
│ │                                          │        │
│ │ [Подтвердить]                            │        │
│ └─────────────────────────────────────────┘        │
│                                                     │
│ После клика "Подтвердить":                          │
│ • Сохранение chat_id в БД                          │
│ • Активация уведомлений                            │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЭТАП 5: ВОДИТЕЛЬ ДОБАВЛЕН
┌─────────────────────────────────────────────────────┐
│ 5. Успешное добавление                              │
│    → /hub/transfer-operator/drivers                 │
│                                                     │
│ На экране:                                          │
│ ✅ ✅ Водитель успешно добавлен!                    │
│ ✅ Telegram интеграция подключена                   │
│                                                     │
│ Обновлённая таблица:                                │
│ ┌────┬────────────┬────────┬────────┬──────┐       │
│ │ ID │ Имя        │ Рейтинг│ Поездки│Статус│       │
│ ├────┼────────────┼────────┼────────┼──────┤       │
│ │ ... (предыдущие водители)               │       │
│ │ 6  │ Николай К. │ 0.0 ⭐ │ 0      │ ✅   │       │
│ └────┴────────────┴────────┴────────┴──────┘       │
│                                                     │
│ Следующие шаги:                                     │
│ • Назначить транспорт водителю                     │
│ • Создать расписание рейсов                        │
│ • Активировать для заявок                          │
└─────────────────────────────────────────────────────┘
```

---

# 🔄 ТИПОВЫЕ ПЕРЕХОДЫ МЕЖДУ СТРАНИЦАМИ

## **1. Главная → Каталог туров → Детали → Бронирование**

```
/
  ↓ [Клик на карточку тура]
/hub/tours/[tour_id]
  ↓ [Клик "Забронировать"]
/auth/login (если не авторизован)
  ↓ [Успешный вход]
/hub/booking/new?tour_id=[tour_id]
  ↓ [Заполнение формы]
/hub/payment/[booking_id]
  ↓ [Оплата]
/hub/booking/[booking_id]/success
  ↓ [Вернуться в профиль]
/hub/tourist
```

---

## **2. Hub туриста → Поиск трансфера → AI сопоставление → Бронирование**

```
/hub/tourist
  ↓ [Клик "Трансферы"]
/hub/transfers/search
  ↓ [Заполнение формы поиска]
  ↓ [POST /api/transfers/search]
  ↓ [AI Matching Engine работает]
/hub/transfers/search/results
  ↓ [Топ-5 водителей показаны]
  ↓ [Выбор водителя]
/hub/transfers/booking/confirm
  ↓ [Оплата]
/hub/transfers/booking/[booking_id]/success
  ↓
/hub/tourist
```

---

## **3. Оператор → Создание тура → Модерация → Публикация**

```
/hub/operator
  ↓ [Клик "Создать тур"]
/hub/operator/tours/new
  ↓ [Заполнение формы (6 шагов)]
  ↓ [POST /api/tours]
/hub/operator
  ↓ [Тур создан, статус: pending_moderation]
  ↓ [Ожидание модерации администратором]
  ↓
/hub/admin (Администратор)
  ↓ [Модерация тура]
  ↓ [PUT /api/admin/tours/:id/moderate]
  ↓ [Статус: approved]
  ↓ [Уведомление оператору]
/hub/operator
  ↓ [Тур опубликован! Виден туристам]
/hub/tours
```

---

## **4. Гид → Расписание → Детали тура → Чат с группой**

```
/hub/guide
  ↓ [Просмотр календаря]
  ↓ [Клик на тур]
/hub/guide/tour/[tour_id]
  ↓ [Просмотр группы]
  ↓ [Клик "Написать сообщение"]
/hub/guide/tour/[tour_id]/chat
  ↓ [Отправка сообщений]
  ↓ [Уведомления туристам (Telegram/SMS)]
```

---

## **5. Admin → Модерация → Управление пользователями**

```
/hub/admin
  ↓ [Вкладка "Модерация"]
/hub/admin/moderation
  ↓ [Список туров на модерации]
  ↓ [Клик на тур]
/hub/admin/tours/[tour_id]/moderate
  ↓ [Просмотр деталей]
  ↓ [Одобрение/отклонение]
  ↓ [PUT /api/admin/tours/:id/moderate]
/hub/admin
  ↓ [Вкладка "Пользователи"]
/hub/admin/users
  ↓ [Поиск пользователя]
  ↓ [Изменение роли]
  ↓ [PUT /api/admin/users/:id]
```

---

# 📱 МОБИЛЬНЫЕ СЦЕНАРИИ

## **Водитель принимает заявку (Driver App)**

```
PUSH УВЕДОМЛЕНИЕ
┌─────────────────────────────────────────────────────┐
│ 📲 Новая заявка на трансфер!                        │
│ Откуда: Аэропорт Елизово                           │
│ Куда: Гостиница Авача                              │
│ Время: 16.02.2024 14:00                            │
│ Пассажиры: 3                                       │
│ Доход: 3,645₽                                      │
│                                                     │
│ [Открыть] [Игнорировать]                           │
└─────────────────────────────────────────────────────┘
                        │
                        ▼ [Клик "Открыть"]
DRIVER APP - ДЕТАЛИ ЗАЯВКИ
┌─────────────────────────────────────────────────────┐
│ 📱 KamHub Driver App                                │
│                                                     │
│ 🚕 НОВАЯ ЗАЯВКА #KT8F2X                             │
│                                                     │
│ Маршрут:                                            │
│ 📍 Аэропорт Елизово (53.17, 158.65)                │
│ ↓ 12 км, ~20 мин                                   │
│ 📍 Гостиница Авача (53.05, 158.65)                 │
│                                                     │
│ Время: 16.02.2024 14:00                            │
│ Пассажиры: 3                                       │
│                                                     │
│ Пассажир:                                           │
│ • Иван Турист                                      │
│ • +7-914-123-45-67                                 │
│                                                     │
│ Требования:                                         │
│ • WiFi ✅                                           │
│ • Детское кресло ✅                                 │
│                                                     │
│ Ваш доход: 3,645₽ (75%)                            │
│                                                     │
│ Действия:                                           │
│ • [Принять заявку] (зелёная кнопка)                │
│ • [Отклонить] (красная кнопка)                     │
│                                                     │
│ Клик "Принять заявку"                              │
│                                                     │
│ API:                                                │
│ PUT /api/transfers/bookings/:id/accept              │
│ { driverId: "driver_1", action: "accept" }          │
└─────────────────────────────────────────────────────┘
                        │
                        ▼
ЗАЯВКА ПРИНЯТА
┌─────────────────────────────────────────────────────┐
│ ✅ Заявка принята!                                  │
│                                                     │
│ Статус: Подтверждено                               │
│                                                     │
│ Навигация:                                          │
│ [Показать маршрут на карте]                        │
│ ↓                                                   │
│ Yandex Maps:                                        │
│ • Ваше местоположение (real-time GPS)              │
│ • Точка подачи: Аэропорт Елизово                   │
│ • Маршрут до точки                                 │
│ • ETA: 20 минут                                    │
│                                                     │
│ Уведомление пассажиру (автоматически):              │
│ 📱 SMS: "Водитель принял заявку! Прибудет через 20 мин"│
│ 📧 Email: "Трансфер подтверждён"                    │
│                                                     │
│ Действия водителя:                                  │
│ • [Начать навигацию]                               │
│ • [Позвонить пассажиру]                            │
│ • [Написать в Telegram]                            │
└─────────────────────────────────────────────────────┘
```

---

# 📊 МАТРИЦА ДЕЙСТВИЙ ПО СУЩНОСТЯМ

## **Сущность: Tour (Тур)**

| Действие | Турист | Оператор | Гид | Transfer | Агент | Admin |
|----------|--------|----------|-----|----------|-------|-------|
| **CREATE** (Создать тур) | ❌ | ✅ (свой) | ❌ | ❌ | ❌ | ✅ (любой) |
| **READ** (Просмотр) | ✅ (активные) | ✅ (все) | ✅ (назначенные) | ✅ (активные) | ✅ (все) | ✅ (все) |
| **UPDATE** (Редактировать) | ❌ | ✅ (свой) | ❌ | ❌ | ❌ | ✅ (любой) |
| **DELETE** (Удалить) | ❌ | ✅ (свой) | ❌ | ❌ | ❌ | ✅ (любой) |
| **MODERATE** (Модерация) | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ |

**Страницы:**
- Просмотр всех: `/hub/tours`
- Детали: `/hub/tours/[tour_id]`
- Создание: `/hub/operator/tours/new` (Оператор)
- Редактирование: `/hub/operator/tours/[tour_id]/edit` (Оператор)
- Модерация: `/hub/admin/tours/[tour_id]/moderate` (Admin)

---

## **Сущность: Booking (Бронирование тура)**

| Действие | Турист | Оператор | Гид | Transfer | Агент | Admin |
|----------|--------|----------|-----|----------|-------|-------|
| **CREATE** (Создать) | ✅ | ❌ | ❌ | ❌ | ✅ (группы) | ✅ |
| **READ** (Просмотр) | ✅ (свои) | ✅ (своих туров) | ✅ (своих туров) | ❌ | ✅ (свои) | ✅ (все) |
| **UPDATE** (Изменить) | ✅ (свои) | ✅ (подтв./отмена) | ❌ | ❌ | ✅ (свои) | ✅ (все) |
| **DELETE** (Отменить) | ✅ (свои) | ✅ (своих туров) | ❌ | ❌ | ✅ (свои) | ✅ (все) |

**Страницы:**
- Создание: `/hub/booking/new?tour_id=[id]` (Турист)
- Мои бронирования: `/hub/tourist` → вкладка "Бронирования" (Турист)
- Детали: `/hub/booking/[booking_id]` (Турист, Оператор)
- Управление: `/hub/operator` → вкладка "Бронирования" (Оператор)

---

## **Сущность: TransferBooking (Бронирование трансфера)**

| Действие | Турист | Оператор | Гид | Transfer | Агент | Admin |
|----------|--------|----------|-----|----------|-------|-------|
| **CREATE** (Создать) | ✅ | ❌ | ❌ | ❌ | ✅ | ✅ |
| **READ** (Просмотр) | ✅ (свои) | ❌ | ❌ | ✅ (своих водителей) | ✅ (свои) | ✅ (все) |
| **UPDATE** (Подтвердить/отменить) | ❌ | ❌ | ❌ | ✅ | ❌ | ✅ |
| **DELETE** (Отменить) | ✅ (свои) | ❌ | ❌ | ✅ | ✅ (свои) | ✅ |

**Страницы:**
- Поиск: `/hub/transfers/search` (Турист)
- Результаты: `/hub/transfers/search/results` (Турист)
- Бронирование: `/hub/transfers/booking/new` (Турист)
- Управление: `/hub/transfer-operator` → вкладка "Заявки" (Transfer)

---

## **Сущность: TransferDriver (Водитель)**

| Действие | Турист | Оператор | Гид | Transfer | Агент | Admin |
|----------|--------|----------|-----|----------|-------|-------|
| **CREATE** (Добавить) | ❌ | ❌ | ❌ | ✅ | ❌ | ✅ |
| **READ** (Просмотр) | ✅ (при поиске) | ❌ | ❌ | ✅ (своих) | ❌ | ✅ (все) |
| **UPDATE** (Редактировать) | ❌ | ❌ | ❌ | ✅ (своих) | ❌ | ✅ (все) |
| **DELETE** (Удалить) | ❌ | ❌ | ❌ | ✅ (своих) | ❌ | ✅ (все) |

**Страницы:**
- Список: `/hub/transfer-operator/drivers` (Transfer)
- Добавление: `/hub/transfer-operator/drivers/new` (Transfer)
- Редактирование: `/hub/transfer-operator/drivers/[driver_id]/edit` (Transfer)
- Просмотр профиля: `/hub/transfers/driver/[driver_id]` (Турист при выборе)

---

## **Сущность: Review (Отзыв)**

| Действие | Турист | Оператор | Гид | Transfer | Агент | Admin |
|----------|--------|----------|-----|----------|-------|-------|
| **CREATE** (Оставить) | ✅ (после тура) | ❌ | ❌ | ❌ | ❌ | ❌ |
| **READ** (Просмотр) | ✅ (все) | ✅ (своих туров) | ✅ (о себе) | ✅ (своих водителей) | ✅ (все) | ✅ (все) |
| **UPDATE** (Редактировать) | ✅ (свой) | ❌ | ❌ | ❌ | ❌ | ✅ |
| **DELETE** (Удалить) | ❌ | ❌ | ❌ | ❌ | ❌ | ✅ (нарушающие) |
| **RESPOND** (Ответить) | ❌ | ✅ (на отзывы своих туров) | ✅ (на отзывы о себе) | ✅ (на отзывы водителей) | ❌ | ❌ |

**Страницы:**
- Просмотр всех: `/hub/tours/[tour_id]` → секция "Отзывы"
- Оставить отзыв: `/hub/booking/[booking_id]/review` (Турист, после завершения)
- Управление: `/hub/operator` → вкладка "Отзывы" (Оператор)
- Управление: `/hub/guide` → вкладка "Отзывы" (Гид)

---

# 🎯 ПОЛНАЯ ТАБЛИЦА НАВИГАЦИИ

| Страница | URL | Роли с доступом | Основные сущности | Ключевые действия |
|----------|-----|-----------------|-------------------|-------------------|
| **Главная** | `/` | Все | Tour, Partner, Weather, EcoPoint | Просмотр, Поиск |
| **Демо** | `/demo` | Все | Все (тестовые) | Тестирование функционала |
| **Вход** | `/auth/login` | Неавториз. | User, UserSession | Аутентификация |
| **404** | `/not-found` | Все | - | Сообщение об ошибке |
| **Hub Турист** | `/hub/tourist` | Tourist, Admin | User, Booking, LoyaltyTransaction | Dashboard, Бронирования |
| **Hub Оператор** | `/hub/operator` | Operator, Admin | Tour, Booking, Guide, OperatorStats | CRM, Управление турами |
| **Hub Гид** | `/hub/guide` | Guide, Admin | Tour, Booking, GuideEarnings, Review | Расписание, Группы, Доходы |
| **Hub Трансфер** | `/hub/transfer` | Transfer, Admin | TransferRoute, TransferVehicle, TransferDriver | CRUD транспорта |
| **Hub Трансфер Оператор** | `/hub/transfer-operator` | Transfer, Admin | TransferBooking, TransferStats | Аналитика, AI Matching |
| **Hub Агент** | `/hub/agent` | Agent, Admin | GroupTour, Voucher, AgentCommission | Групповые туры, B2B |
| **Hub Админ** | `/hub/admin` | Admin | ВСЁ | Модерация, Управление |
| **Каталог туров** | `/hub/tours` | Авториз. | Tour, Review | Поиск, Фильтрация |
| **Аренда авто** | `/hub/cars` | Авториз. | Car, CarBooking | Поиск авто, Бронирование |
| **Прокат снаряжения** | `/hub/gear` | Авториз. | Gear, GearBooking | Поиск снаряжения |
| **Проживание** | `/hub/stay` | Авториз. | Stay, StayBooking | Поиск жилья |
| **Сувениры** | `/hub/souvenirs` | Авториз. | Souvenir, SouvenirOrder | Покупка сувениров |
| **Безопасность** | `/hub/safety` | Авториз. | Weather, SafetyAlert | SOS, МЧС, Карта |

---

**ДОКУМЕНТ ЗАВЕРШЁН!** 🗺️  
**Полная диаграмма навигации и сценарии готовы!** ✅  
**Всего страниц: 16** | **Сущностей: 20+** | **Сценариев: 6+**
