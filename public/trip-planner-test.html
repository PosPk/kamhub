<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–µ—Å—Ç –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –ö–∞–º—á–∞—Ç–∫–∏</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    
    .container {
      background: white;
      border-radius: 16px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #1a202c;
      margin-bottom: 10px;
      font-size: 2em;
    }
    
    .subtitle {
      color: #718096;
      margin-bottom: 30px;
      font-size: 1.1em;
    }
    
    label {
      display: block;
      margin: 20px 0 8px;
      color: #2d3748;
      font-weight: 600;
    }
    
    textarea, input {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 16px;
      font-family: inherit;
      transition: border-color 0.2s;
    }
    
    textarea {
      height: 120px;
      resize: vertical;
    }
    
    textarea:focus, input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    button {
      width: 100%;
      padding: 16px;
      margin-top: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .result {
      margin-top: 30px;
      padding: 20px;
      background: #f7fafc;
      border-radius: 12px;
      border: 2px solid #e2e8f0;
    }
    
    .loading {
      color: #667eea;
      text-align: center;
      font-size: 18px;
      padding: 40px;
    }
    
    .loading::before {
      content: '‚è≥';
      display: block;
      font-size: 48px;
      margin-bottom: 20px;
      animation: spin 2s linear infinite;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    .error {
      color: #e53e3e;
      background: #fff5f5;
      padding: 20px;
      border-radius: 8px;
      border: 2px solid #feb2b2;
    }
    
    .success {
      color: #38a169;
      background: #f0fff4;
      padding: 12px 20px;
      border-radius: 8px;
      border: 2px solid #9ae6b4;
      margin-bottom: 20px;
      font-weight: 600;
    }
    
    .plan-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin: 20px 0;
    }
    
    .plan-stat {
      background: white;
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      text-align: center;
    }
    
    .plan-stat-label {
      color: #718096;
      font-size: 14px;
      margin-bottom: 5px;
    }
    
    .plan-stat-value {
      color: #1a202c;
      font-size: 24px;
      font-weight: 700;
    }
    
    .day-card {
      background: white;
      margin: 15px 0;
      padding: 20px;
      border-radius: 10px;
      border: 2px solid #e2e8f0;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .day-card h4 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.3em;
    }
    
    .activity {
      padding: 12px 0;
      border-bottom: 1px solid #e2e8f0;
    }
    
    .activity:last-child {
      border-bottom: none;
    }
    
    .activity-time {
      color: #667eea;
      font-weight: 600;
      font-size: 14px;
    }
    
    .activity-title {
      color: #2d3748;
      font-weight: 600;
      margin: 5px 0;
    }
    
    .logistics {
      color: #718096;
      font-size: 14px;
      margin-left: 20px;
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .logistics span {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .accommodation {
      margin-top: 15px;
      padding: 12px;
      background: #f7fafc;
      border-radius: 6px;
      border-left: 4px solid #667eea;
    }
    
    h3 {
      color: #2d3748;
      margin: 25px 0 15px;
      padding-bottom: 10px;
      border-bottom: 2px solid #e2e8f0;
    }
    
    ul {
      list-style: none;
      padding: 0;
    }
    
    li {
      padding: 8px 0;
      padding-left: 25px;
      position: relative;
    }
    
    li::before {
      content: '‚úì';
      position: absolute;
      left: 0;
      color: #667eea;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üó∫Ô∏è –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –ü–æ–µ–∑–¥–æ–∫ –Ω–∞ –ö–∞–º—á–∞—Ç–∫—É</h1>
    <p class="subtitle">–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å AI-–≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –º–∞—Ä—à—Ä—É—Ç–æ–≤</p>
    
    <form id="planForm">
      <label for="query">üìù –û–ø–∏—à–∏—Ç–µ –≤–∞—à—É –ø–æ–µ–∑–¥–∫—É:</label>
      <textarea 
        id="query" 
        placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –Ø –ø–ª–∞–Ω–∏—Ä—É—é –ø–æ–µ–∑–¥–∫—É –Ω–∞ 5 –¥–Ω–µ–π. –•–æ—á—É —É–≤–∏–¥–µ—Ç—å –≤—É–ª–∫–∞–Ω—ã, –º–µ–¥–≤–µ–¥–µ–π –∏ —Ç–µ—Ä–º–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏. –ü–æ–¥–±–µ—Ä–∏ —Ç—É—Ä—ã, –º–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –∏ –ª–æ–≥–∏—Å—Ç–∏–∫—É –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏."
        required
      >–Ø –ø–ª–∞–Ω–∏—Ä—É—é –ø–æ–µ–∑–¥–∫—É –Ω–∞ –ö–ê–ú–ß–ê–¢–ö–£ –Ω–∞ 5 –¥–Ω–µ–π. –•–æ—á—É —É–≤–∏–¥–µ—Ç—å –≤—É–ª–∫–∞–Ω—ã, –º–µ–¥–≤–µ–¥–µ–π –∏ —Ç–µ—Ä–º–∞–ª—å–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏. –ü–æ–¥–±–µ—Ä–∏ —Ç—É—Ä—ã, –º–µ—Å—Ç–æ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è –∏ –ª–æ–≥–∏—Å—Ç–∏–∫—É –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏.</textarea>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div>
          <label for="days">üìÖ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π:</label>
          <input type="number" id="days" min="1" max="30" value="5" required>
        </div>
        
        <div>
          <label for="budget">üí∞ –ë—é–¥–∂–µ—Ç (‚ÇΩ):</label>
          <input type="number" id="budget" placeholder="60000">
        </div>
      </div>
      
      <button type="submit" id="submitBtn">üöÄ –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–µ–∑–¥–∫—É</button>
    </form>
    
    <div id="result" style="display: none;"></div>
  </div>
  
  <script>
    const form = document.getElementById('planForm');
    const result = document.getElementById('result');
    const submitBtn = document.getElementById('submitBtn');
    
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω –∏–ª–∏ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —è–≤–Ω–æ
    const API_BASE = window.location.hostname === 'localhost' 
      ? 'http://localhost:3002'
      : 'https://pospk-kamhub-70c4.twc1.net';
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const query = document.getElementById('query').value;
      const days = parseInt(document.getElementById('days').value);
      const budget = document.getElementById('budget').value;
      
      if (!query || !days) {
        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π');
        return;
      }
      
      result.style.display = 'block';
      result.innerHTML = '<div class="loading">–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤–∞—à –∏–¥–µ–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –ø–æ–µ–∑–¥–∫–∏...<br><small>–≠—Ç–æ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 5-15 —Å–µ–∫—É–Ω–¥</small></div>';
      submitBtn.disabled = true;
      submitBtn.textContent = '‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–ª–∞–Ω...';
      
      try {
        const startTime = Date.now();
        
        const response = await fetch(`${API_BASE}/api/trip/plan`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            query,
            days,
            budget: budget ? parseInt(budget) : undefined,
            interests: ['hiking', 'wildlife', 'nature', 'photography']
          })
        });
        
        const data = await response.json();
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(1);
        
        if (data.success) {
          const plan = data.data;
          
          let html = `
            <div class="success">
              ‚úÖ –ü–ª–∞–Ω —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω –∑–∞ ${elapsed} —Å–µ–∫—É–Ω–¥!
            </div>
            
            <div class="plan-summary">
              <div class="plan-stat">
                <div class="plan-stat-label">–î–Ω–µ–π</div>
                <div class="plan-stat-value">${plan.summary.total_days}</div>
              </div>
              <div class="plan-stat">
                <div class="plan-stat-label">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
                <div class="plan-stat-value">${plan.summary.total_cost.toLocaleString()} ‚ÇΩ</div>
              </div>
              <div class="plan-stat">
                <div class="plan-stat-label">–°–ª–æ–∂–Ω–æ—Å—Ç—å</div>
                <div class="plan-stat-value">${plan.summary.difficulty_level}</div>
              </div>
            </div>
            
            <h3>üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –ø–æ–µ–∑–¥–∫–∏</h3>
            <ul>${plan.summary.highlights.map(h => `<li>${h}</li>`).join('')}</ul>
            
            <h3>üìÖ –î–µ—Ç–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç</h3>
          `;
          
          plan.days.forEach(day => {
            html += `
              <div class="day-card">
                <h4>–î–µ–Ω—å ${day.day}${day.date ? ` (${day.date})` : ''} ‚Äî ${day.total_cost.toLocaleString()} ‚ÇΩ</h4>
            `;
            
            day.activities.forEach(act => {
              html += `
                <div class="activity">
                  <div class="activity-time">${act.time}</div>
                  <div class="activity-title">${act.title}</div>
              `;
              
              if (act.description) {
                html += `<p style="color: #718096; margin: 5px 0;">${act.description}</p>`;
              }
              
              if (act.logistics) {
                const icons = {
                  walk: 'üö∂',
                  car: 'üöó',
                  bus: 'üöå',
                  taxi: 'üöï',
                  transfer: 'üöê',
                  helicopter: 'üöÅ'
                };
                
                html += `
                  <div class="logistics">
                    <span>${icons[act.logistics.transport] || 'üöó'} ${act.logistics.transport}</span>
                    <span>‚è±Ô∏è ${act.logistics.duration_minutes} –º–∏–Ω</span>
                    <span>üìç ${act.logistics.distance_km} –∫–º</span>
                    ${act.logistics.notes ? `<span style="font-style: italic;">üí° ${act.logistics.notes}</span>` : ''}
                  </div>
                `;
              }
              
              html += `</div>`;
            });
            
            if (day.accommodation) {
              html += `
                <div class="accommodation">
                  <strong>üè® –ù–æ—á–ª–µ–≥:</strong> ${day.accommodation.name || '–†–∞–∑–º–µ—â–µ–Ω–∏–µ'} 
                  (${day.accommodation.price_per_night ? day.accommodation.price_per_night.toLocaleString() + ' ‚ÇΩ/–Ω–æ—á—å' : ''})
                </div>
              `;
            }
            
            html += `</div>`;
          });
          
          if (plan.recommendations && plan.recommendations.length > 0) {
            html += `<h3>üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</h3><ul>`;
            plan.recommendations.forEach(r => {
              html += `<li>${r}</li>`;
            });
            html += `</ul>`;
          }
          
          if (plan.important_notes && plan.important_notes.length > 0) {
            html += `<h3>‚ö†Ô∏è –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å</h3><ul>`;
            plan.important_notes.forEach(n => {
              html += `<li>${n}</li>`;
            });
            html += `</ul>`;
          }
          
          result.innerHTML = html;
          
        } else {
          result.innerHTML = `
            <div class="error">
              <strong>‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–ª–∞–Ω–∞</strong><br><br>
              ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}<br>
              ${data.message ? `<small>${data.message}</small>` : ''}
            </div>
          `;
        }
        
      } catch (error) {
        result.innerHTML = `
          <div class="error">
            <strong>‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</strong><br><br>
            ${error.message}<br><br>
            <small>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: ${API_BASE}</small>
          </div>
        `;
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üöÄ –°–ø–ª–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ–µ–∑–¥–∫—É';
      }
    });
  </script>
</body>
</html>
