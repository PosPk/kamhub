"use strict";(()=>{var e={};e.id=236,e.ids=[236],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},6005:e=>{e.exports=require("node:crypto")},8398:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>c,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>m,staticGenerationAsyncStorage:()=>l});var s=r(3278),n=r(5002),o=r(4877),i=r(6272),u=e([i]);i=(u.then?(await u)():u)[0];let p=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/import/asset/route",pathname:"/api/import/asset",filename:"route",bundlePath:"app/api/import/asset/route"},resolvedPagePath:"/workspace/app/api/import/asset/route.ts",nextConfigOutput:"standalone",userland:i}),{requestAsyncStorage:d,staticGenerationAsyncStorage:l,serverHooks:m}=p,y="/api/import/asset/route";function c(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:l})}a()}catch(e){a(e)}})},6272:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{POST:()=>p,runtime:()=>d});var s=r(1309),n=r(8678),o=r(6005),i=r.n(o),u=e([n]);n=(u.then?(await u)():u)[0];let d="nodejs";async function c(e){let t=await fetch(e,{cache:"no-store"});if(!t.ok)return null;let r=t.headers.get("content-type")||"application/octet-stream",a=await t.arrayBuffer();return{bytes:Buffer.from(a),mime:r}}async function p(e){try{let t=await e.json().catch(()=>({})),r=String(t?.url||"").trim(),a=String(t?.key||"").trim()||"kamchatka_button";if(!r)return s.NextResponse.json({error:"NO_URL"},{status:400});let o=process.env.DATABASE_URL;if(!o)return s.NextResponse.json({error:"NO_DATABASE_URL"},{status:500});let u=await c(r);if(!u)return s.NextResponse.json({error:"FETCH_FAILED"},{status:400});let p=i().createHash("sha256").update(u.bytes).digest("hex"),d=new n.Client({connectionString:o,ssl:{rejectUnauthorized:!1}});return await d.connect(),await d.query(`create table if not exists assets (
      id uuid primary key default gen_random_uuid(),
      key text unique not null,
      bytes bytea not null,
      mime text,
      sha256 text,
      source_url text,
      created_at timestamptz default now()
    );`),await d.query(`insert into assets(key, bytes, mime, sha256, source_url)
       values ($1,$2,$3,$4,$5)
       on conflict (key) do update set bytes=excluded.bytes, mime=excluded.mime, sha256=excluded.sha256, source_url=excluded.source_url, created_at=now()`,[a,u.bytes,u.mime,p,r]),await d.end(),s.NextResponse.json({ok:!0,key:a,sha256:p,mime:u.mime,bytes:u.bytes.length})}catch(e){return s.NextResponse.json({error:"IMPORT_FAILED",message:e?.message||String(e)},{status:500})}}a()}catch(e){a(e)}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[379,833],()=>r(8398));module.exports=a})();